"use strict";(self.webpackChunk_minimal_kit_cra_js=self.webpackChunk_minimal_kit_cra_js||[]).push([[81260],{38974:(e,i,n)=>{n.d(i,{d:()=>l});var t=n(65043);function l(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;const[n,l]=(0,t.useState)(e);return(0,t.useEffect)((()=>{const n=setTimeout((()=>{l(e)}),i);return()=>{clearTimeout(n)}}),[e,i]),n}},81260:(e,i,n)=>{n.r(i),n.d(i,{default:()=>F});var t=n(80899),l=n(46987),o=n(65043),r=n(18403),d=n(24858),s=n(84284),a=n(49633),c=n(94496),u=n(83462),v=n(4219),m=n(35316),p=n(45376),_=n(67784),x=n(1273),h=n(39336),y=n(29347),j=n(48407),g=n(67132),f=n(59229),b=n(38974),A=n(31673),D=n(75139),C=n(60778),S=n(7625),w=n(35151),k=n(59699),E=n(70579);function F(e){var i,n,F,$,Y,N,I,M;let{Entrance:T}=e;const{user:q}=(0,D.Z)(),P=(0,g.rd)(),{prescriptionData:W,refetch:O}=(0,S.AY1)(null===T||void 0===T?void 0:T._id),R=(0,f.C)(),[V,Z]=(0,o.useState)(),z=(0,b.d)(V),{medicinesData:L}=(0,S.N_9)({select:"trade_name concentration",search:z}),{t:B}=(0,C.WD)(),{currentLang:U}=(0,C.jc)(),G="ar"===U.value,[H,J]=(0,o.useState)(null),[K,Q]=(0,o.useState)([{id:0}]),X=()=>{J(null)},ee=()=>{var e,i;const n={id:K.length,employee:(null===q||void 0===q||null===(e=q.employee)||void 0===e?void 0:e._id)||"",patient:(null===T||void 0===T||null===(i=T.patient)||void 0===i?void 0:i._id)||"",unit_service_patient:null===T||void 0===T?void 0:T.unit_service_patient,entrance_mangament:(null===T||void 0===T?void 0:T._id)||"",Start_time:new Date,End_time:new Date,Frequency_per_day:"",Num_days:0,Doctor_Comments:""};Q((e=>[...e,n])),se(`prescriptions[${K.length}]`,n)},ie=t.Ik().shape({employee:t.Yj(),patient:t.Yj(),medicines:t.Yj(),Start_time:t.gl(),End_time:t.gl(),Frequency_per_day:t.Yj(),entrance_mangament:t.Yj(),Doctor_Comments:t.Yj(),chronic:t.zM(),Drugs_report:t.Yj(),medical_report:t.Yj()}),ne={prescriptions:[{employee:(null===q||void 0===q||null===(i=q.employee)||void 0===i?void 0:i._id)||"",patient:(null===T||void 0===T||null===(n=T.patient)||void 0===n?void 0:n._id)||"",unit_service:null===q||void 0===q||null===(F=q.employee)||void 0===F||null===($=F.employee_engagements)||void 0===$||null===(Y=$[q.employee.selected_engagement])||void 0===Y||null===(N=Y.unit_service)||void 0===N?void 0:N._id,unit_service_patient:null===T||void 0===T?void 0:T.unit_service_patient,entrance_mangament:(null===T||void 0===T?void 0:T._id)||"",Start_time:new Date,End_time:new Date,Frequency_per_day:"",Num_days:0,medicines:null,Doctor_Comments:""}]},te=(0,d.mN)({mode:"all",resolver:(0,r.t)(ie),defaultValues:ne}),{reset:le,handleSubmit:oe,control:re,watch:de,setValue:se,formState:{isSubmitting:ae}}=te,ce=null===(I=de("prescriptions"))||void 0===I?void 0:I.map(((e,i)=>de(`prescriptions[${i}].Start_time`))),ue=null===(M=de("prescriptions"))||void 0===M?void 0:M.map(((e,i)=>de(`prescriptions[${i}].End_time`)));(0,o.useEffect)((()=>{ce.forEach(((e,i)=>{const n=ue[i];if(e&&n){const t=new Date(e),l=new Date(n),o=Math.ceil((l-t)/864e5);se(`prescriptions[${i}].Num_days`,o>0?o:0)}}))}),[ce,ue,se]);return(0,o.useEffect)((()=>{var e,i,n,t,l,o;le({prescriptions:[{employee:(null===q||void 0===q||null===(e=q.employee)||void 0===e?void 0:e._id)||"",patient:(null===T||void 0===T||null===(i=T.patient)||void 0===i?void 0:i._id)||"",unit_service:null===q||void 0===q||null===(n=q.employee)||void 0===n||null===(t=n.employee_engagements)||void 0===t||null===(l=t[q.employee.selected_engagement])||void 0===l||null===(o=l.unit_service)||void 0===o?void 0:o._id,unit_service_patient:null===T||void 0===T?void 0:T.unit_service_patient,entrance_mangament:(null===T||void 0===T?void 0:T._id)||"",Start_time:new Date,End_time:new Date,Frequency_per_day:"",Num_days:0,medicines:null,Doctor_Comments:""}]})}),[q,T,le]),(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(a.A,{variant:"outlined",color:"success",onClick:R.onTrue,sx:{m:2},children:[B("Add prescription"),(0,E.jsx)(w.A,{icon:"mingcute:add-line"})]}),null===W||void 0===W?void 0:W.map(((e,i)=>{var n;return(0,E.jsxs)(c.A,{variant:"h6",sx:{bgcolor:"#fff",m:2,border:2,borderRadius:2,borderColor:"#EDEFF2",p:2},children:[null===e||void 0===e||null===(n=e.medicines)||void 0===n?void 0:n.map(((e,i)=>{var n;return(0,E.jsx)("ul",{style:{listStyleType:"none",display:"flex",flexDirection:"column"},children:(0,E.jsx)("li",{children:null===e||void 0===e||null===(n=e.medicines)||void 0===n?void 0:n.trade_name},i)})})),(0,E.jsx)("br",{}),(0,E.jsxs)(a.A,{onMouseOver:()=>{return i=null===e||void 0===e?void 0:e._id,void J(i);var i},onMouseOut:X,onClick:()=>{return i=null===e||void 0===e?void 0:e._id,void P.push(j.f.employee.prescription(i));var i},sx:{m:1},children:[B("View")," \xa0"," ",(0,E.jsx)(w.A,{icon:H===(null===e||void 0===e?void 0:e._id)?"emojione:eye":"tabler:eye-closed"})]}),(0,E.jsxs)(a.A,{onClick:()=>(async e=>{await A.Ay.delete(A.vZ.prescription.one(e)),(0,l.M8)(B("Field removed successfully"),{variant:"success"}),O(),le()})(null===e||void 0===e?void 0:e._id),children:[B("Remove")," \xa0 ",(0,E.jsx)(w.A,{icon:"flat-color-icons:delete-database"})]})]},i)})),(0,E.jsx)(u.A,{open:R.value,onClose:R.onFalse,children:(0,E.jsxs)(k.Ay,{methods:te,onSubmit:oe((async e=>{try{const r=e.prescriptions.map((e=>({...e})));var i,n,t,o;if(R.value)await A.Ay.post(A.vZ.history.all,{patient:null===T||void 0===T||null===(i=T.patient)||void 0===i?void 0:i._id,unit_service_patient:null===T||void 0===T?void 0:T.unit_service_patient,name_english:"a prescription has been added",name_arabic:"\u062a\u0645 \u0627\u0631\u0641\u0627\u0642 \u0648\u0635\u0641\u0629 \u0637\u0628\u064a\u0629",sub_english:`prescription from ${null===T||void 0===T||null===(n=T.service_unit)||void 0===n?void 0:n.name_english}`,sub_arabic:`\u0648\u0635\u0641\u0629 \u0637\u0628\u064a\u0629 \u0645\u0646 ${null===T||void 0===T||null===(t=T.service_unit)||void 0===t?void 0:t.name_arabic}`,actual_date:null===T||void 0===T?void 0:T.created_at,title:"prescription",service_unit:null===T||void 0===T||null===(o=T.service_unit)||void 0===o?void 0:o._id}),await A.Ay.post("/api/drugs",r),await A.Ay.patch(`/api/entrance/${null===T||void 0===T?void 0:T._id}`,{Drugs_report_status:!0}),(0,l.M8)(B("Prescription uploaded successfully"),{variant:"success"}),R.onFalse(),O(),le(),Q([{id:0}])}catch(r){console.error(r.message),(0,l.M8)("Error uploading data",{variant:"error"})}})),children:[(0,E.jsx)(v.A,{sx:{color:"success.main",position:"relative",top:"10px"},children:G?"\u0627\u0636\u0627\u0641\u0629 \u0648\u0635\u0641\u0629 \u0637\u0628\u064a\u0629":"add prescription"}),(0,E.jsxs)(m.A,{children:[null===K||void 0===K?void 0:K.map(((e,i)=>(0,E.jsxs)("div",{children:[(0,E.jsx)(p.A,{sx:{minWidth:300,flex:1,my:2},options:L,onBlur:()=>Z(),onChange:(e,n)=>se(`prescriptions[${i}].medicines`,null===n||void 0===n?void 0:n._id),getOptionLabel:e=>e.trade_name+" "+e.concentration||"",onInputChange:(e,i)=>{Z(i)},renderInput:e=>(0,E.jsx)(_.A,{...e,label:B("medicine"),variant:"outlined"})}),(0,E.jsx)(k.o3,{name:`prescriptions[${i}].Frequency_per_day`,label:B("Frequency per day"),sx:{mb:2}}),(0,E.jsx)(k.o3,{name:`prescriptions[${i}].Num_days`,label:B("Number of days"),sx:{mb:2}}),(0,E.jsx)(d.xI,{name:`prescriptions[${i}].Start_time`,control:re,render:e=>{let{field:i,fieldState:{error:n}}=e;return(0,E.jsx)(s.l,{...i,label:B("Start time"),sx:{mb:2},slotProps:{textField:{fullWidth:!0,error:!!n,helperText:null===n||void 0===n?void 0:n.message}}})}}),(0,E.jsx)(d.xI,{name:`prescriptions[${i}].End_time`,control:re,render:e=>{let{field:n,fieldState:{error:t}}=e;return(0,E.jsx)(s.l,{...n,label:B("End time"),sx:{mb:2},shouldDisableDate:e=>{const n=de(`prescriptions[${i}].Start_time`);return n&&e<new Date(n)},slotProps:{textField:{fullWidth:!0,error:!!t,helperText:null===t||void 0===t?void 0:t.message}}})}}),(0,E.jsx)(d.xI,{name:`prescriptions[${i}].Doctor_Comments`,control:re,render:e=>{let{field:i,fieldState:{error:n}}=e;return(0,E.jsx)(k.o3,{...i,label:B("doctor comment"),multiline:!0,sx:{mb:2},error:!!n,helperText:null===n||void 0===n?void 0:n.message})}}),(0,E.jsx)(d.xI,{name:`prescriptions[${i}].chronic`,control:re,render:e=>{let{field:i}=e;return(0,E.jsx)(x.A,{...i,checked:i.value,onChange:e=>i.onChange(e.target.checked)})}}),(0,E.jsx)(c.A,{sx:{color:"text.secondary",mt:{md:-3,xs:-2.3},ml:{md:8,xs:4},typography:"caption",fontSize:{md:15,xs:10}},children:B("chronic")}),(0,E.jsx)(a.A,{onClick:()=>{return i=e.id,Q((e=>e.filter((e=>e.id!==i)))),void se("prescriptions",K.filter((e=>e.id!==i)));var i},sx:{mt:2,mb:2},variant:"outlined",disabled:1===K.length,children:B("Remove Prescription")}),i===K.length-1&&(0,E.jsx)(a.A,{onClick:ee,sx:{ml:2,bgcolor:"success.main",display:"inline"},variant:"contained",children:B("Add more")})]},e.id))),(0,E.jsx)(h.A,{})]}),(0,E.jsxs)(y.A,{children:[(0,E.jsx)(a.A,{variant:"outlined",color:"inherit",onClick:R.onFalse,children:B("Cancel")}),(0,E.jsx)(a.A,{type:"submit",loading:ae,variant:"contained",children:B("Upload")})]})]})})]})}}}]);
//# sourceMappingURL=81260.d5a9a640.chunk.js.map