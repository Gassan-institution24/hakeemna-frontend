"use strict";(self.webpackChunk_minimal_kit_cra_js=self.webpackChunk_minimal_kit_cra_js||[]).push([[5401],{85401:(e,n,l)=>{l.d(n,{Z:()=>B});var t=l(8007),i=l(61134),a=l(6165),s=l.n(a),o=l(72791),d=l(44695),r=l(57621),c=l(53767),u=l(10266),m=l(12258),p=l(63515),v=l(4567),x=l(16029),_=l(13239),h=l(38072),g=l(19208),y=l(22459),f=l(66664),j=l(8976),b=l(93011),w=l(81164),Z=l(85563),k=l(32869),T=l(77008),C=l(39454),S=l(94721),D=l(82626),z=l(63466),I=l(17003),F=l(93971),q=l(9145),P=l(40268),M=l(80184);function W(e){var n,l;let{appointmentConfigData:t,setAppointTime:a}=e;const{t:s}=(0,w.qM)(),{currentLang:o}=(0,w.nt)(),d="ar"===o.value,{id:r}=(0,g.UO)(),u=[{value:"saturday",label:s("Saturday")},{value:"sunday",label:s("Sunday")},{value:"monday",label:s("Monday")},{value:"tuesday",label:s("Tuesday")},{value:"wednesday",label:s("Wednesday")},{value:"thursday",label:s("Thursday")},{value:"friday",label:s("Friday")}],{control:m,watch:p,trigger:_}=(0,i.Gc)(),y=p(),{myunitTime:f}=(0,q.lf)(),{user:k}=(0,j.E)(),{handleAddNew:T}=(0,F.A)(),{workGroupsData:W}=(0,b.Sue)(r),{workShiftsData:A}=(0,b.mxf)(null===k||void 0===k||null===(n=k.employee)||void 0===n||null===(l=n.employee_engagements[null===k||void 0===k?void 0:k.employee.selected_engagement])||void 0===l?void 0:l.unit_service._id);return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(S.Z,{flexItem:!0,sx:{borderStyle:"solid"}}),(0,M.jsxs)(c.Z,{sx:{p:3},children:[(0,M.jsxs)(c.Z,{spacing:2,direction:{xs:"column",sm:"row"},sx:{p:3,width:{xs:"100%",md:"auto"}},children:[(0,M.jsx)(i.Qr,{name:"start_date",control:m,render:e=>{let{field:n,fieldState:{error:l}}=e;return(0,M.jsx)(I.M,{label:"".concat(s("start date")," *"),value:f(y.start_date),onChange:e=>{var l,t,i,a;const s=(0,C.Z)(e,(null===k||void 0===k||null===(l=k.employee)||void 0===l||null===(t=l.employee_engagements[null===k||void 0===k?void 0:k.employee.selected_engagement])||void 0===t||null===(i=t.unit_service)||void 0===i||null===(a=i.country)||void 0===a?void 0:a.time_zone)||Intl.DateTimeFormat().resolvedOptions().timeZone);n.onChange(s)},slotProps:{textField:{fullWidth:!0,error:!!l,helperText:null===l||void 0===l?void 0:l.message}}})}}),(0,M.jsx)(i.Qr,{name:"end_date",control:m,render:e=>{let{field:n,fieldState:{error:l}}=e;return(0,M.jsx)(I.M,{label:s("end date"),value:f(y.end_date),onChange:e=>{var l,t,i,a;const s=(0,C.Z)(e,(null===k||void 0===k||null===(l=k.employee)||void 0===l||null===(t=l.employee_engagements[null===k||void 0===k?void 0:k.employee.selected_engagement])||void 0===t||null===(i=t.unit_service)||void 0===i||null===(a=i.country)||void 0===a?void 0:a.time_zone)||Intl.DateTimeFormat().resolvedOptions().timeZone);n.onChange(s)},slotProps:{textField:{fullWidth:!0,error:!!l,helperText:null===l||void 0===l?void 0:l.message}}})}})]}),(0,M.jsxs)(c.Z,{spacing:2,direction:{xs:"column",sm:"row"},sx:{px:3,pb:3,width:{xs:"100%",md:"auto"}},children:[(0,M.jsxs)(Z.Cc,{size:"small",name:"work_shift",label:"".concat(s("work shift")," *"),InputLabelProps:{shrink:!0},PaperPropsSx:{textTransform:"capitalize"},disabled:Boolean(t),children:[A.map(((e,n)=>(0,M.jsx)(D.Z,{lang:"ar",value:e._id,children:d?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english},n))),(0,M.jsx)(S.Z,{}),(0,M.jsxs)(D.Z,{lang:"ar",sx:{display:"flex",justifyContent:"flex-end",gap:1,fontWeight:600},onClick:()=>T(h.H.unitservice.tables.workshifts.new),children:[(0,M.jsx)(v.Z,{variant:"body2",sx:{color:"info.main"},children:s("Add new")}),(0,M.jsx)(P.Z,{icon:"material-symbols:new-window-sharp"})]})]}),(0,M.jsxs)(Z.Cc,{size:"small",name:"work_group",label:"".concat(s("work group")," *"),InputLabelProps:{shrink:!0},PaperPropsSx:{textTransform:"capitalize"},disabled:Boolean(t),children:[W&&(null===W||void 0===W?void 0:W.map(((e,n)=>(0,M.jsx)(D.Z,{lang:"ar",value:e._id,children:d?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english},n)))),(0,M.jsx)(S.Z,{}),(0,M.jsxs)(D.Z,{lang:"ar",sx:{display:"flex",justifyContent:"flex-end",gap:1,fontWeight:600},onClick:()=>T(h.H.unitservice.tables.workgroups.new),children:[(0,M.jsx)(v.Z,{variant:"body2",sx:{color:"info.main"},children:s("Add new")}),(0,M.jsx)(P.Z,{icon:"material-symbols:new-window-sharp"})]})]}),(0,M.jsx)(Z.au,{fullWidth:!0,step:"5",name:"appointment_time",label:s("appointment duration time"),type:"number",onBlur:e=>{a(e.target.value),_("appointment_time")},size:"small",InputLabelProps:{shrink:!0},InputProps:{endAdornment:(0,M.jsx)(z.Z,{position:"end",children:(0,M.jsx)(x.Z,{sx:{fontSize:"0.8rem"},children:s("min")})})}}),(0,M.jsx)(Z.au,{size:"small",InputProps:{startAdornment:(0,M.jsx)(z.Z,{position:"start",children:(0,M.jsx)(x.Z,{sx:{fontSize:"0.8rem"},children:d?"\u0644\u0628\u0639\u062f":"for the next"})}),endAdornment:(0,M.jsx)(z.Z,{position:"end",children:(0,M.jsx)(x.Z,{sx:{fontSize:"0.8rem"},children:d?"\u0623\u064a\u0627\u0645":"days"})})},name:"config_frequency",label:s("configuration frequency"),type:"number",inputProps:{min:0,max:30,textAlign:"center"},InputLabelProps:{shrink:!0}})]}),(0,M.jsxs)(v.Z,{variant:"p",sx:{color:"text.secondary",mb:3,fontWeight:"700",textTransform:"capitalize"},children:[d?"\u0627\u0644\u0639\u0637\u0644 \u0627\u0644\u0623\u0633\u0628\u0648\u0639\u064a\u0629":"Weekly Days Off",":"]}),(0,M.jsx)(c.Z,{spacing:2,direction:{xs:"column",sm:"row"},sx:{p:3},children:(0,M.jsx)(Z.s2,{size:"small",name:"weekend",options:u,sx:{display:"grid",gridTemplateColumns:{md:"repeat(7, 1fr)",sm:"repeat(4, 1fr)",xs:"repeat(2, 1fr)"}}})})]})]})}var A=l(13838),L=l(13400);function E(){const{t:e}=(0,w.qM)(),{currentLang:n}=(0,w.nt)(),l="ar"===n.value,{myunitTime:t}=(0,q.lf)(),{user:a}=(0,j.E)(),{control:s,watch:o}=(0,i.Gc)(),{fields:d,append:r,remove:u}=(0,i.Dq)({control:s,name:"holidays"}),m=o();return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(S.Z,{flexItem:!0,sx:{borderStyle:"solid"}}),(0,M.jsxs)(x.Z,{sx:{p:3},children:[(0,M.jsxs)(v.Z,{variant:"p",sx:{color:"text.secondary",mb:3,fontWeight:"700",textTransform:"capitalize"},children:[l?"\u0627\u0644\u0639\u0637\u0644":"Holidays",":"]}),(0,M.jsx)(c.Z,{sx:{mt:3},divider:(0,M.jsx)(S.Z,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:2,children:d.map(((n,l,o)=>(0,M.jsx)(c.Z,{alignItems:"flex-start",spacing:1.5,sx:{width:{xs:"100%",md:"auto"}},children:(0,M.jsxs)(c.Z,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:{xs:"100%",md:"auto"}},children:[(0,M.jsx)(Z.au,{size:"small",name:"holidays[".concat(l,"].description"),label:e("description")}),(0,M.jsx)(i.Qr,{name:"holidays[".concat(l,"].date"),control:s,render:n=>{let{field:i,fieldState:{error:s}}=n;return(0,M.jsx)(I.M,{label:e("date"),value:t(m.holidays[l].date),onChange:e=>{var n,l,t,s;const o=(0,C.Z)(e,(null===a||void 0===a||null===(n=a.employee)||void 0===n||null===(l=n.employee_engagements[null===a||void 0===a?void 0:a.employee.selected_engagement])||void 0===l||null===(t=l.unit_service)||void 0===t||null===(s=t.country)||void 0===s?void 0:s.time_zone)||Intl.DateTimeFormat().resolvedOptions().timeZone);i.onChange(o)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!s,helperText:null===s||void 0===s?void 0:s.message}}})}}),(0,M.jsx)(L.Z,{sx:{justifySelf:"flex-end",alignSelf:"flex-end",width:35},size:"small",color:"error",onClick:()=>(e=>{u(e)})(l),children:(0,M.jsx)(P.Z,{icon:"solar:trash-bin-trash-bold"})})]})},o)))}),(0,M.jsx)(S.Z,{sx:{mt:3,mb:1,borderStyle:"dashed"}}),(0,M.jsx)(c.Z,{spacing:3,direction:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"},children:(0,M.jsx)(A.Z,{size:"small",color:"primary",startIcon:(0,M.jsx)(P.Z,{icon:"tdesign:plus"}),sx:{padding:1},onClick:()=>{r({date:null,description:""})},children:l?"\u0625\u0636\u0627\u0641\u0629 \u0623\u064a\u0627\u0645 \u0639\u0637\u0644":"add holiday"})})]})]})}var H=l(58406),O=l(13034),Q=l(62861),R=l(68096),X=l(47071),N=l(56125);function G(e){var n,l,t,a;let{ParentIndex:s,open:o,appointmenttypesData:d,serviceTypesData:r,setAppointmentsNum:u}=e;const{t:m}=(0,w.qM)(),{currentLang:p}=(0,w.nt)(),_="ar"===p.value,{control:h,watch:g}=(0,i.Gc)(),{fields:y,append:f,remove:j}=(0,i.Dq)({control:h,name:"days_details[".concat(s,"].appointments")}),b=g(),k=e=>{const n=null===r||void 0===r?void 0:r.filter((n=>null===e||void 0===e?void 0:e.includes(n._id)));return null===n||void 0===n?void 0:n.map((e=>_?e.name_arabic:e.name_english)).join(", ")};return(0,M.jsx)(N.Z,{in:o,timeout:"auto",unmountOnExit:!0,sx:{bgcolor:"background.neutral"},children:(0,M.jsxs)(x.Z,{sx:{px:2,pb:0},children:[(null===(n=b.days_details[s])||void 0===n||null===(l=n.appointments)||void 0===l?void 0:l.length)>0&&(0,M.jsxs)(v.Z,{variant:"p",sx:{color:"text.disabled",mb:3,fontSize:14},children:[m("appointments"),":"]}),(0,M.jsx)(c.Z,{sx:{mt:3},divider:(0,M.jsx)(S.Z,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:3,alignItems:"flex-end",children:y.map(((e,n)=>(0,M.jsx)(c.Z,{alignItems:"center",flexWrap:"wrap",spacing:1.5,sx:{width:"80%"},children:(0,M.jsxs)(c.Z,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:"100%"},children:[(0,M.jsx)(Z.Cc,{size:"small",InputLabelProps:{shrink:!0},name:"days_details[".concat(s,"].appointments[").concat(n,"].appointment_type"),label:"".concat(m("appointment type")," *"),children:null===d||void 0===d?void 0:d.map(((e,n)=>(0,M.jsx)(D.Z,{lang:"ar",value:e._id,children:_?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english})))}),(0,M.jsx)(Z.Cm,{name:"days_details[".concat(s,"].appointments[").concat(n,"].start_time"),label:m("start time"),slotProps:{textField:{size:"small",fullWidth:!0}}}),(0,M.jsx)(i.Qr,{name:"days_details[".concat(s,"].appointments[").concat(n,"].service_types"),control:h,render:e=>{let{field:l,fieldState:{error:t}}=e;return(0,M.jsxs)(R.Z,{error:!!t,size:"small",sx:{width:"100%",shrink:!0},children:[(0,M.jsxs)(Q.Z,{shrink:!0,children:[" ",m("service types")," "]}),(0,M.jsx)(H.Z,{...l,multiple:!0,id:"multiple-days_details[".concat(s,"].appointments[").concat(n,"].service_types"),label:m("service types"),renderValue:k,children:null===r||void 0===r?void 0:r.map(((e,n)=>{var t;const i=null===l||void 0===l||null===(t=l.value)||void 0===t?void 0:t.includes(e._id);return(0,M.jsxs)(D.Z,{lang:"ar",value:e._id,children:[(0,M.jsx)(O.Z,{size:"small",disableRipple:!0,checked:i}),_?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english]},n)}))}),!!t&&(0,M.jsx)(X.Z,{error:!!t,children:null===t||void 0===t?void 0:t.message})]})}}),(0,M.jsx)(Z.jb,{size:"small",InputLabelProps:{shrink:!0},name:"days_details[".concat(s,"].appointments[").concat(n,"].online_available"),label:(0,M.jsx)(v.Z,{sx:{fontSize:12},children:m("online avaliable")})}),(0,M.jsx)(L.Z,{size:"small",color:"error",sx:{justifySelf:{xs:"flex-end"},alignSelf:{xs:"flex-end"},width:35},onClick:()=>(e=>{j(e),u((e=>({...e,[s]:e[s]-1})))})(n),children:(0,M.jsx)(P.Z,{icon:"solar:trash-bin-trash-bold"})})]})},n)))}),(0,M.jsx)(S.Z,{sx:{mt:(null===(t=b.days_details[s])||void 0===t||null===(a=t.appointments)||void 0===a?void 0:a.length)>0?3:0,mb:1,borderStyle:"dashed"}}),(0,M.jsx)(c.Z,{spacing:3,direction:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"},children:(0,M.jsx)(A.Z,{size:"small",color:"primary",startIcon:(0,M.jsx)(P.Z,{icon:"tdesign:plus"}),sx:{padding:1},onClick:()=>{const e=b.days_details[s].appointments?b.days_details[s].appointments[b.days_details[s].appointments.length-1]:null,n=new Date(e?null===e||void 0===e?void 0:e.start_time:b.days_details[s].work_start_time);e&&n.setMinutes(n.getMinutes()+b.appointment_time);const l={appointment_type:null,start_time:null,price:null,online_available:!0,service_types:[],...e,start_time:n};f(l),u((e=>({...e,[s]:e[s]+1})))},children:_?"\u0625\u0636\u0627\u0641\u0629 \u0645\u0648\u0627\u0639\u064a\u062f \u0628\u0627\u0644\u062a\u0641\u0635\u064a\u0644":"Add Detailed Appointment"})})]})})}function V(e){var n,l;let{setErrorMsg:t,appointTime:a}=e;const{t:s}=(0,w.qM)(),{currentLang:d}=(0,w.nt)(),r="ar"===d.value,[u,m]=(0,o.useState)(!0),{handleAddNew:p}=(0,F.A)(),{enqueueSnackbar:_}=(0,k.Ds)(),g=[{value:"saturday",label:s("Saturday")},{value:"sunday",label:s("Sunday")},{value:"monday",label:s("Monday")},{value:"tuesday",label:s("Tuesday")},{value:"wednesday",label:s("Wednesday")},{value:"thursday",label:s("Thursday")},{value:"friday",label:s("Friday")}],{control:f,setValue:T,watch:C,clearErrors:z}=(0,i.Gc)(),{fields:I,append:q,remove:W}=(0,i.Dq)({control:f,name:"days_details"}),E=C(),{user:N}=(0,j.E)(),[V,Y]=(0,o.useState)({}),[B,U]=(0,o.useState)({}),{appointmenttypesData:J}=(0,b.o5E)(),{serviceTypesData:K}=(0,b.UL2)(null===N||void 0===N||null===(n=N.employee)||void 0===n||null===(l=n.employee_engagements[null===N||void 0===N?void 0:N.employee.selected_engagement])||void 0===l?void 0:l.unit_service._id),$=(0,y.k)(),ee=(0,o.useCallback)((e=>{try{if(Y({}),$.onTrue(),z(),!E.appointment_time)return T("days_details[".concat(e,"].appointments"),[]),void $.onFalse();if(!E.days_details[e].work_start_time)return T("days_details[".concat(e,"].appointments"),[]),void $.onFalse();if(!E.days_details[e].work_end_time)return T("days_details[".concat(e,"].appointments"),[]),void $.onFalse();const n=[],l=new Date,t=60*E.appointment_time*1e3,i=E.days_details[e],a=new Date(l.getFullYear(),l.getMonth(),l.getDate(),new Date(i.work_start_time).getHours(),new Date(i.work_start_time).getMinutes()).getTime();let s=new Date(l.getFullYear(),l.getMonth(),l.getDate(),new Date(i.work_end_time).getHours(),new Date(i.work_end_time).getMinutes()).getTime(),o=i.break_start_time?new Date(l.getFullYear(),l.getMonth(),l.getDate(),new Date(i.break_start_time).getHours(),new Date(i.break_start_time).getMinutes()).getTime():null,d=i.break_end_time?new Date(l.getFullYear(),l.getMonth(),l.getDate(),new Date(i.break_end_time).getHours(),new Date(i.break_end_time).getMinutes()).getTime():null;a>=s&&(s+=864e5),o&&a>o&&(o+=864e5),o&&d&&o>d&&(d+=864e5);let r=a;for(;r+t<=s;)!o||!d||r+t<=o||r>=d?(n.push({appointment_type:i.appointment_type,start_time:r,online_available:i.online_available,service_types:i.service_types}),r+=t):r=d;T("days_details[".concat(e,"].appointments"),n),$.onFalse()}catch(n){console.error(n),$.onFalse(),_(n.message,{variant:"error"})}}),[E.appointment_time,E.days_details]),ne=e=>{const n=null===K||void 0===K?void 0:K.filter((n=>null===e||void 0===e?void 0:e.includes(null===n||void 0===n?void 0:n._id)));return null===n||void 0===n?void 0:n.map((e=>r?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english)).join(", ")};function le(e){const n=E.days_details[e];if(null!==n&&void 0!==n&&n.appointments.length)return null===n||void 0===n?void 0:n.appointments.length;const l=60*E.appointment_time*1e3,t=new Date(n.work_start_time).getTime();let i=new Date(n.work_end_time).getTime(),a=new Date(n.break_start_time).getTime(),s=new Date(n.break_end_time).getTime();return t>i&&(i+=864e5),t>a&&(a+=864e5),t>s&&(s+=864e5),t<s&&t<=a&&i>=s&&i>a?Math.floor((i-t-(s-a))/l)||0:t<s&&t<=a&&i<=s&&i>a?Math.floor((i-t-(i-a))/l)||0:Math.floor((i-t)/l)||0}return(0,o.useEffect)((()=>{if(a)for(let e=0;e<E.days_details.length;e++)ee(e)}),[a]),(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(S.Z,{flexItem:!0,sx:{borderStyle:"solid"}}),u&&(0,M.jsxs)(x.Z,{sx:{p:3},children:[(0,M.jsxs)(v.Z,{variant:"p",sx:{color:"text.secondary",mb:3,fontWeight:"700",textTransform:"capitalize"},children:[r?"\u062a\u0641\u0627\u0635\u064a\u0644 \u0627\u0644\u064a\u0648\u0645":"Days Details",":"]}),(0,M.jsx)(c.Z,{sx:{mt:3},divider:(0,M.jsx)(S.Z,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:3,children:I.map(((e,n)=>{var l,t;return(0,M.jsxs)(c.Z,{spacing:1.5,sx:{width:"100%"},children:[(0,M.jsxs)(c.Z,{direction:{xs:"column",md:"column"},spacing:2,sx:{width:"100%",mt:2},children:[(0,M.jsxs)(c.Z,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:"100%",mt:2},children:[(0,M.jsx)(Z.Cc,{disabled:!(null!==E&&void 0!==E&&null!==(l=E.weekend)&&void 0!==l&&l.includes(null===(t=E.days_details[n])||void 0===t?void 0:t.day)),InputLabelProps:{shrink:!0},size:"small",name:"days_details[".concat(n,"].day"),label:s("day"),children:g.filter((e=>!E.weekend.includes(e.value)&&!E.days_details.some((l=>{var t;return l.day===e.value&&(null===(t=E.days_details[n])||void 0===t?void 0:t.day)!==e.value})))).map(((e,n)=>(0,M.jsx)(D.Z,{lang:"ar",value:e.value,children:e.label})))}),(0,M.jsx)(Z.Cc,{size:"small",InputLabelProps:{shrink:!0},name:"days_details[".concat(n,"].appointment_type"),onChange:e=>{T("days_details[".concat(n,"].appointment_type"),e.target.value),ee(n)},label:"".concat(s("appointment type")," *"),children:null===J||void 0===J?void 0:J.map(((e,n)=>(0,M.jsx)(D.Z,{lang:"ar",value:e._id,children:r?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english})))}),(0,M.jsx)(i.Qr,{name:"days_details[".concat(n,"].service_types"),control:f,render:e=>{let{field:l,fieldState:{error:t}}=e;return(0,M.jsxs)(R.Z,{error:!!t,size:"small",sx:{width:"100%",shrink:!0},children:[(0,M.jsxs)(Q.Z,{shrink:!0,children:[" ",s("service types")," "]}),(0,M.jsxs)(H.Z,{...l,multiple:!0,id:"multiple-days_details[".concat(n,"].service_types"),label:s("service types"),onChange:e=>{T("days_details[".concat(n,"].service_types"),e.target.value),ee(n)},renderValue:ne,children:[null===K||void 0===K?void 0:K.map(((e,n)=>{var t;const i=null===l||void 0===l||null===(t=l.value)||void 0===t?void 0:t.includes(e._id);return(0,M.jsxs)(D.Z,{lang:"ar",value:e._id,children:[(0,M.jsx)(O.Z,{size:"small",disableRipple:!0,checked:i}),r?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english]},n)})),(0,M.jsx)(S.Z,{}),(0,M.jsxs)(D.Z,{lang:"ar",sx:{display:"flex",justifyContent:"flex-end",gap:1,fontWeight:600},onClick:()=>p(h.H.unitservice.tables.services.new),children:[(0,M.jsx)(v.Z,{variant:"body2",sx:{color:"info.main"},children:s("Add new")}),(0,M.jsx)(P.Z,{icon:"material-symbols:new-window-sharp"})]})]}),!!t&&(0,M.jsx)(X.Z,{error:!!t,children:null===t||void 0===t?void 0:t.message})]})}}),(0,M.jsx)(Z.au,{disabled:!0,size:"small",name:"days_details[".concat(n,"].appointment_number"),label:s("appointments number"),InputLabelProps:{shrink:!0},value:B[n]||le(n)})]}),(0,M.jsxs)(c.Z,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:"100%",mt:2},children:[(0,M.jsx)(Z.Cm,{name:"days_details[".concat(n,"].work_start_time"),label:s("work start time"),slotProps:{textField:{size:"small",fullWidth:!0}},onChange:()=>{T("days_details[".concat(n,"].work_end_time"),null),ee(n)}}),(0,M.jsx)(Z.Cm,{name:"days_details[".concat(n,"].work_end_time"),label:s("work end time"),slotProps:{textField:{size:"small",fullWidth:!0}},onChange:()=>{ee(n)}}),(0,M.jsx)(Z.Cm,{name:"days_details[".concat(n,"].break_start_time"),label:s("break start time"),slotProps:{textField:{size:"small",fullWidth:!0}},onChange:()=>{T("days_details[".concat(n,"].work_end_time"),null),ee(n)}}),(0,M.jsx)(Z.Cm,{name:"days_details[".concat(n,"].break_end_time"),label:s("break end time"),slotProps:{textField:{size:"small",fullWidth:!0}},onChange:()=>{ee(n)}})]}),(0,M.jsx)(c.Z,{display:"flex",alignItems:"flex-end",children:(0,M.jsx)(Z.jb,{size:"small",InputLabelProps:{shrink:!0},name:"days_details[".concat(n,"].online_available"),onChange:e=>{T("days_details[".concat(n,"].online_available"),!E.days_details[n].online_available),ee(n)},label:(0,M.jsx)(v.Z,{sx:{fontSize:12},children:s("online avaliable")})})}),(0,M.jsxs)(c.Z,{direction:{xs:"column",md:"row"},spacing:.2,sx:{justifySelf:{xs:"flex-end"},alignSelf:{xs:"flex-end"}},children:[(0,M.jsx)(L.Z,{size:"small",color:"error",onClick:()=>(e=>{W(e),m(!1),setTimeout((()=>{m(!0)}),100)})(n),children:(0,M.jsx)(P.Z,{icon:"solar:trash-bin-trash-bold"})}),(0,M.jsx)(L.Z,{size:"small",onClick:()=>ee(n),children:(0,M.jsx)(P.Z,{icon:"zondicons:refresh"})}),(0,M.jsx)(L.Z,{size:"small",onClick:()=>Y({[n]:!V[n]}),children:(0,M.jsx)(P.Z,{icon:V[n]?"eva:arrow-ios-upward-fill":"eva:arrow-ios-downward-fill"})})]})]}),(0,M.jsx)(G,{setAppointmentsNum:U,serviceTypesData:K,appointmenttypesData:J,open:V[n],ParentIndex:n,unmountOnExit:!0})]},n)}))}),(0,M.jsx)(S.Z,{sx:{mt:3,mb:1,borderStyle:"dashed"}}),(0,M.jsx)(c.Z,{spacing:3,direction:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"},children:(0,M.jsx)(A.Z,{size:"small",color:"primary",startIcon:(0,M.jsx)(P.Z,{icon:"tdesign:plus"}),sx:{padding:1},onClick:()=>{try{var e;const n=null===(e=g.filter((e=>!E.weekend.includes(e.value)&&!E.days_details.some((n=>n.day===e.value))))[0])||void 0===e?void 0:e.value;if(!n)throw Error("No valid date to create");const l={day:"",work_start_time:null,work_end_time:null,break_start_time:null,break_end_time:null,appointments:[],service_types:[],appointment_type:null,online_available:null},t=E.days_details?E.days_details[E.days_details.length-1]:[],i={...l,...t,day:n};q(i)}catch(n){console.error(n),_(n.message,{variant:"error"})}},children:r?"\u0625\u0636\u0627\u0641\u0629 \u064a\u0648\u0645 \u062c\u062f\u064a\u062f":"add new day"})})]})]})}function Y(){const{t:e}=(0,w.qM)(),{currentLang:n}=(0,w.nt)(),l="ar"===n.value,{myunitTime:t}=(0,q.lf)(),{user:a}=(0,j.E)(),{control:s,watch:o,setValue:d}=(0,i.Gc)(),{fields:r,append:u,remove:m}=(0,i.Dq)({control:s,name:"long_holidays"}),p=o();return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(S.Z,{flexItem:!0,sx:{borderStyle:"solid"}}),(0,M.jsxs)(x.Z,{sx:{p:3},children:[(0,M.jsxs)(v.Z,{variant:"p",sx:{color:"text.secondary",mb:3,fontWeight:"700",textTransform:"capitalize"},children:[l?"\u0639\u0637\u0644 \u0637\u0648\u064a\u0644\u0629":"Long Holidays",":"]}),(0,M.jsx)(c.Z,{sx:{mt:3},divider:(0,M.jsx)(S.Z,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:3,children:r.map(((n,l,o)=>(0,M.jsx)(c.Z,{alignItems:"flex-start",spacing:1.5,sx:{width:{xs:"100%",md:"auto"}},children:(0,M.jsxs)(c.Z,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:{xs:"100%",md:"auto"}},children:[(0,M.jsx)(Z.au,{size:"small",name:"long_holidays[".concat(l,"].description"),label:e("description")}),(0,M.jsx)(i.Qr,{name:"long_holidays[".concat(l,"].start_date"),control:s,render:n=>{let{field:i,fieldState:{error:s}}=n;return(0,M.jsx)(I.M,{label:e("start date"),value:t(p.long_holidays[l].start_date),onChange:e=>{var n,t,s,o;const r=(0,C.Z)(e,(null===a||void 0===a||null===(n=a.employee)||void 0===n||null===(t=n.employee_engagements[null===a||void 0===a?void 0:a.employee.selected_engagement])||void 0===t||null===(s=t.unit_service)||void 0===s||null===(o=s.country)||void 0===o?void 0:o.time_zone)||Intl.DateTimeFormat().resolvedOptions().timeZone);d("long_holidays[".concat(l,"].end_date"),r),i.onChange(r)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!s,helperText:null===s||void 0===s?void 0:s.message}}})}}),(0,M.jsx)(i.Qr,{name:"long_holidays[".concat(l,"].end_date"),control:s,render:n=>{let{field:i,fieldState:{error:s}}=n;return(0,M.jsx)(I.M,{label:e("end date"),value:t(p.long_holidays[l].end_date),onChange:e=>{var n,l,t,s;const o=(0,C.Z)(e,(null===a||void 0===a||null===(n=a.employee)||void 0===n||null===(l=n.employee_engagements[null===a||void 0===a?void 0:a.employee.selected_engagement])||void 0===l||null===(t=l.unit_service)||void 0===t||null===(s=t.country)||void 0===s?void 0:s.time_zone)||Intl.DateTimeFormat().resolvedOptions().timeZone);i.onChange(o)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!s,helperText:null===s||void 0===s?void 0:s.message}}})}}),(0,M.jsx)(L.Z,{size:"small",color:"error",sx:{justifySelf:"flex-end",alignSelf:"flex-end",width:35},onClick:()=>(e=>{m(e)})(l),children:(0,M.jsx)(P.Z,{icon:"solar:trash-bin-trash-bold"})})]})},o)))}),(0,M.jsx)(S.Z,{sx:{mt:3,mb:1,borderStyle:"dashed"}}),(0,M.jsx)(c.Z,{spacing:1,direction:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"},children:(0,M.jsx)(A.Z,{size:"small",color:"primary",startIcon:(0,M.jsx)(P.Z,{icon:"tdesign:plus"}),sx:{padding:1},onClick:()=>{u({start_date:null,end_date:null,description:""})},children:l?"\u0625\u0636\u0627\u0641\u0629 \u0639\u0637\u0644 \u0637\u0648\u064a\u0644\u0629":"add long holiday"})})]})]})}function B(e){let{appointmentConfigData:n,refetch:l,loading:a}=e;const C=(0,g.tv)(),{t:S}=(0,w.qM)(),{currentLang:D}=(0,w.nt)(),z="ar"===D.value,{id:I}=(0,g.UO)(),{user:F}=(0,j.E)(),q=(0,b.X79)(I).data,[P,A]=(0,o.useState)(0),[L,H]=(0,o.useState)(),[O,Q]=(0,o.useState)([]),{enqueueSnackbar:R}=(0,k.Ds)(),X=(0,y.k)(!1),N=(0,y.k)(!1),G=(0,y.k)(),B=(0,y.k)(),U=t.Ry().shape({weekend:t.IX(),start_date:t.hT().nullable(),end_date:t.hT().nullable(),appointment_time:t.Rx().required(S("required field")).min(5,"Appointment Time must be at least 5").max(180,"Appointment Time must be at most 180"),config_frequency:t.Rx().required(S("required field")).min(1,"must be at least 1").max(360,"must be at most 360"),holidays:t.IX(),long_holidays:t.IX().of(t.Ry().shape({start_date:t.hT().nullable(),end_date:t.hT().nullable(),description:t.Z_().nullable()})),work_group:t.Z_().required(S("required field")),work_shift:t.Z_().required(S("required field")),days_details:t.IX().of(t.Ry().shape({day:t.Z_().required(S("required field")),work_start_time:t.hT().nullable().required(S("required field")),work_end_time:t.hT().nullable().required(S("required field")),appointments:t.IX(),service_types:t.IX(),appointment_type:t.Z_().nullable(),online_available:t.O7()}))}),J=(0,o.useMemo)((()=>{var e,l,t,i,a;return{unit_service:(null===n||void 0===n?void 0:n.unit_service._id)||(null===F||void 0===F||null===(e=F.employee)||void 0===e||null===(l=e.employee_engagements[null===F||void 0===F?void 0:F.employee.selected_engagement])||void 0===l?void 0:l.unit_service._id),department:(null===q||void 0===q||null===(t=q.department)||void 0===t?void 0:t._id)||null,start_date:(null===n||void 0===n?void 0:n.start_date)||null,end_date:(null===n||void 0===n?void 0:n.end_date)||null,weekend:(null===n||void 0===n?void 0:n.weekend)||[],appointment_time:(null===n||void 0===n?void 0:n.appointment_time)||null,config_frequency:(null===n||void 0===n?void 0:n.config_frequency)||null,holidays:(null===n||void 0===n?void 0:n.holidays)||[{description:"",date:null}],long_holidays:(null===n||void 0===n?void 0:n.long_holidays)||[{description:"",start_date:null,end_date:null}],work_group:(null===n||void 0===n||null===(i=n.work_group)||void 0===i?void 0:i._id)||null,work_shift:(null===n||void 0===n||null===(a=n.work_shift)||void 0===a?void 0:a._id)||null,online_available:(null===n||void 0===n?void 0:n.online_available)||!0,days_details:(null===n||void 0===n?void 0:n.days_details)||[{day:"saturday",work_start_time:null,work_end_time:null,break_start_time:null,break_end_time:null,appointments:[],service_types:[],appointment_type:null,online_available:!0}]}}),[n,null===F||void 0===F?void 0:F.employee,null===q||void 0===q?void 0:q.department]),K=(0,i.cI)({mode:"onTouched",resolver:(0,d.X)(U),defaultValues:J}),{handleSubmit:$,formState:{isSubmitting:ee,errors:ne}}=K,le=$((async e=>{B.onTrue();const l=new Date,t=new Date(l.getTime()+24*e.config_frequency*60*60*1e3);try{n?!e.start_date&&!e.end_date||new Date(e.end_date)>l&&(new Date(e.start_date)<=l||new Date(e.start_date)<t)?(Q(e),G.onTrue()):(await f.ZP.patch("".concat(f.Hv.appointment_configs.all,"/").concat(null===n||void 0===n?void 0:n._id),e),C.push(h.H.unitservice.employees.appointmentconfig.root(I))):(N.onTrue(),await f.ZP.post(f.Hv.appointment_configs.all,e),N.onFalse(),R(S("added successfully!")),C.push(h.H.unitservice.employees.appointmentconfig.root(I))),B.onFalse(),console.info("DATA",JSON.stringify(e,null,2))}catch(i){N.onFalse(),B.onFalse(),R(z&&"".concat(i.arabic_message)||"".concat(i.message),{variant:"error"}),console.error(i)}}));return(0,o.useEffect)((()=>{Object.keys(ne).length&&Object.keys(ne).forEach(((e,n)=>{var l;return R("".concat(e,": ").concat((null===ne||void 0===ne||null===(l=ne[e])||void 0===l?void 0:l.message)||"error"),{variant:"error"})}))}),[ne,R]),(0,o.useEffect)((()=>{var e,l,t,i,a,s,o;n&&K.reset({unit_service:(null===n||void 0===n?void 0:n.unit_service)||(null===F||void 0===F||null===(e=F.employee)||void 0===e||null===(l=e.employee_engagements[null===F||void 0===F?void 0:F.employee.selected_engagement])||void 0===l?void 0:l.unit_service._id),department:(null===q||void 0===q||null===(t=q.department)||void 0===t?void 0:t._id)||(null===F||void 0===F||null===(i=F.employee.employee_engagements[null===F||void 0===F?void 0:F.employee.selected_engagement])||void 0===i||null===(a=i.department)||void 0===a?void 0:a._id),start_date:(null===n||void 0===n?void 0:n.start_date)||null,end_date:(null===n||void 0===n?void 0:n.end_date)||null,weekend:(null===n||void 0===n?void 0:n.weekend)||[],appointment_time:(null===n||void 0===n?void 0:n.appointment_time)||null,config_frequency:(null===n||void 0===n?void 0:n.config_frequency)||null,holidays:(null===n||void 0===n?void 0:n.holidays)||[{description:"",date:null}],long_holidays:(null===n||void 0===n?void 0:n.long_holidays)||[{description:"",start_date:null,end_date:null}],work_group:(null===(s=n.work_group)||void 0===s?void 0:s._id)||null,work_shift:(null===(o=n.work_shift)||void 0===o?void 0:o._id)||null,days_details:n.days_details||[{day:"",work_start_time:null,work_end_time:null,break_start_time:null,break_end_time:null,appointments:[]}]})}),[n,F,null===q||void 0===q?void 0:q.department]),(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(u.Z,{maxWidth:"lg",children:(0,M.jsxs)(Z.ZP,{methods:K,children:[!a&&(0,M.jsxs)(r.Z,{children:[!!L&&(0,M.jsx)(p.Z,{sx:{borderRadius:0},severity:"error",children:(0,M.jsx)("div",{dangerouslySetInnerHTML:{__html:L}})}),(0,M.jsx)(W,{setAppointTime:A,appointmentConfigData:n}),(0,M.jsx)(V,{setErrorMsg:H,appointTime:P}),(0,M.jsx)(E,{}),(0,M.jsx)(Y,{})]}),(0,M.jsx)(c.Z,{justifyContent:"flex-end",direction:"row",spacing:2,sx:{mt:3},children:(0,M.jsx)(m.Z,{variant:"contained",loading:ee||X.value||N.value,onClick:le,children:S("save")})})]})}),(0,M.jsx)(T.Q,{disabled:N.value,open:N.value||G.value,onClose:G.onFalse,title:N.value?"Creating appointments...":"Do you want to change your existance appointments?",content:N.value?(0,M.jsx)(M.Fragment,{children:(0,M.jsx)(s(),{options:{strings:["It might take several minutes..","We are getting appointments ready..","We are almost done.."],autoStart:!0,loop:!0,deleteSpeed:5,cursor:"",delay:20}})}):(0,M.jsxs)(M.Fragment,{children:[z?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)(v.Z,{variant:"body2",component:"p",sx:{mt:1,color:"text.disabled"},children:["\u0627\u0636\u063a\u0637 ",(0,M.jsx)("strong",{children:" \u0646\u0639\u0645 "})," \u0644\u062a\u063a\u064a\u064a\u0631 \u0627\u0644\u0645\u0648\u0627\u0639\u064a\u062f \u0627\u0644\u0645\u0646\u0634\u0623\u0629"]}),(0,M.jsxs)(v.Z,{variant:"body2",component:"p",sx:{color:"info.dark"},children:[(0,M.jsx)("strong",{children:" \u0645\u0644\u0627\u062d\u0638\u0629: "})," \u0644\u0646 \u064a\u062a\u0645 \u0627\u0644\u062a\u0639\u062f\u064a\u0644 \u0639\u0644\u0649 \u0623\u064a \u0645\u0646 \u0627\u0644\u0645\u0648\u0627\u0639\u064a\u062f \u0627\u0644\u0645\u062d\u062c\u0648\u0632\u0629"]})]}):(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)(v.Z,{variant:"body2",component:"p",sx:{mt:1,color:"text.disabled"},children:["press",(0,M.jsx)("strong",{children:" yes"})," to change existance appointments"]}),(0,M.jsxs)(v.Z,{variant:"body2",component:"p",sx:{color:"info.dark"},children:[(0,M.jsx)("strong",{children:" note:"})," booked appointment will not change"]})]}),z?(0,M.jsxs)(v.Z,{variant:"body2",component:"p",sx:{mt:1,color:"text.disabled"},children:["\u0627\u0636\u063a\u0637 ",(0,M.jsx)("strong",{children:" \u0644\u0627 "})," \u0644\u062d\u0641\u0638 \u0627\u0644\u0627\u0639\u062f\u0627\u062f\u0627\u062a \u0644\u0644\u0628\u062f\u0621 \u0645\u0646 \u0627\u0644\u0645\u0648\u0627\u0639\u064a\u062f \u0627\u0644\u062a\u064a \u064a\u0631\u0627\u062f \u0625\u0646\u0634\u0627\u0626\u0647\u0627"]}):(0,M.jsxs)(v.Z,{variant:"body2",component:"p",sx:{mt:1,color:"text.disabled"},children:["press",(0,M.jsx)("strong",{children:" No"})," to start changing when creating new appointments"]})]}),action:(0,M.jsxs)(M.Fragment,{children:[N.value&&(0,M.jsx)(x.Z,{height:"40",sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,M.jsx)(_.Z,{size:24,color:"primary"})}),!N.value&&(0,M.jsx)(m.Z,{variant:"contained",loading:N.value,color:"warning",onClick:async()=>{N.onTrue();try{await f.ZP.patch("".concat(f.Hv.appointment_configs.all,"/").concat(null===n||void 0===n?void 0:n._id),{...O,ImmediateEdit:!0}),N.onFalse(),G.onFalse(),R(S("updated successfully!")),C.push(h.H.unitservice.employees.appointmentconfig.root(I))}catch(e){N.onFalse(),G.onFalse(),R(z&&"".concat(e.arabic_message)||"".concat(e.message),{variant:"error"}),console.error(e)}},children:S("yes")}),!N.value&&(0,M.jsx)(m.Z,{disabled:N.value,loading:X.value,variant:"contained",color:"success",onClick:async()=>{X.onTrue();try{await f.ZP.patch("".concat(f.Hv.appointment_configs.all,"/").concat(null===n||void 0===n?void 0:n._id),{...O,ImmediateEdit:!1}),R(S("updated successfully!")),X.onFalse(),G.onFalse(),C.push(h.H.unitservice.employees.appointmentconfig.root(I))}catch(e){X.onFalse(),G.onFalse(),R(z&&"".concat(e.arabic_message)||"".concat(e.message),{variant:"error"}),console.error(e)}},children:S("no")})]})})]})}}}]);
//# sourceMappingURL=5401.6af52a27.chunk.js.map