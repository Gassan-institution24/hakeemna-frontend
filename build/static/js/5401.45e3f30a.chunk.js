"use strict";(self.webpackChunk_minimal_kit_cra_js=self.webpackChunk_minimal_kit_cra_js||[]).push([[5401],{85401:(e,t,n)=>{n.d(t,{Z:()=>B});var i=n(8007),l=n(72791),a=n(61134),s=n(44695),o=n(57621),r=n(36314),d=n(4567),c=n(12258),m=n(89164),u=n(6165),p=n.n(u),_=n(38072),x=n(19208),v=n(8976),h=n(22459),g=n(25279),y=n(99116),f=n(89731),j=n(29028),b=n(32869),w=n(76932),k=n(79572),Z=n(77008),S=(n(87151),n(68870)),C=n(13838),T=n(94721),z=n(13400),D=n(41985),I=(n(17070),n(40268)),P=n(80184);function F(){const{t:e}=(0,w.qM)(),{currentLang:t}=(0,w.nt)(),n="ar"===t.value,{control:i,setValue:l,watch:s,resetField:o,getValues:c}=(0,a.Gc)(),{fields:m,append:u,remove:p}=(0,a.Dq)({control:i,name:"holidays"}),_=c();return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(T.Z,{flexItem:!0,sx:{borderStyle:"solid"}}),(0,P.jsxs)(S.Z,{sx:{p:3},children:[(0,P.jsxs)(d.Z,{variant:"p",sx:{color:"text.secondary",mb:3,fontWeight:"700",textTransform:"capitalize"},children:[n?"\u0627\u0644\u0639\u0637\u0644":"Holidays",":"]}),(0,P.jsx)(r.Z,{sx:{mt:3},divider:(0,P.jsx)(T.Z,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:2,children:m.map(((t,n)=>(0,P.jsx)(r.Z,{alignItems:"flex-start",spacing:1.5,sx:{width:{xs:"100%",md:"auto"}},children:(0,P.jsxs)(r.Z,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:{xs:"100%",md:"auto"}},children:[(0,P.jsx)(j.au,{lang:"ar",size:"small",name:"holidays[".concat(n,"].description"),label:e("description")}),(0,P.jsx)(a.Qr,{name:"holidays[".concat(n,"].date"),control:i,render:t=>{let{field:i,fieldState:{error:l}}=t;return(0,P.jsx)(D.M,{label:e("date"),value:new Date(_.holidays[n].date?_.holidays[n].date:""),onChange:e=>{i.onChange(e)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!l,helperText:null===l||void 0===l?void 0:l.message}}})}}),(0,P.jsx)(z.Z,{sx:{justifySelf:"flex-end",alignSelf:"flex-end",width:35},size:"small",color:"error",onClick:()=>(e=>{p(e)})(n),children:(0,P.jsx)(I.Z,{icon:"solar:trash-bin-trash-bold"})})]})},t.id)))}),(0,P.jsx)(T.Z,{sx:{mt:3,mb:1,borderStyle:"dashed"}}),(0,P.jsx)(r.Z,{spacing:3,direction:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"},children:(0,P.jsx)(C.Z,{size:"small",color:"primary",startIcon:(0,P.jsx)(I.Z,{icon:"tdesign:plus"}),sx:{padding:1},onClick:()=>{u({date:null,description:""})},children:n?"\u0625\u0636\u0627\u0641\u0629 \u0623\u064a\u0627\u0645 \u0639\u0637\u0644":"add holiday"})})]})]})}function W(){const{t:e}=(0,w.qM)(),{currentLang:t}=(0,w.nt)(),n="ar"===t.value,{control:i,setValue:l,watch:s,resetField:o,getValues:c}=(0,a.Gc)(),{fields:m,append:u,remove:p}=(0,a.Dq)({control:i,name:"long_holidays"}),_=c();return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(T.Z,{flexItem:!0,sx:{borderStyle:"solid"}}),(0,P.jsxs)(S.Z,{sx:{p:3},children:[(0,P.jsxs)(d.Z,{variant:"p",sx:{color:"text.secondary",mb:3,fontWeight:"700",textTransform:"capitalize"},children:[n?"\u0639\u0637\u0644 \u0637\u0648\u064a\u0644\u0629":"Long Holidays",":"]}),(0,P.jsx)(r.Z,{sx:{mt:3},divider:(0,P.jsx)(T.Z,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:3,children:m.map(((t,n)=>(0,P.jsx)(r.Z,{alignItems:"flex-start",spacing:1.5,sx:{width:{xs:"100%",md:"auto"}},children:(0,P.jsxs)(r.Z,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:{xs:"100%",md:"auto"}},children:[(0,P.jsx)(j.au,{lang:"ar",size:"small",name:"long_holidays[".concat(n,"].description"),label:e("description")}),(0,P.jsx)(a.Qr,{name:"long_holidays[".concat(n,"].start_date"),control:i,render:t=>{let{field:i,fieldState:{error:l}}=t;return(0,P.jsx)(D.M,{label:e("start date"),value:new Date(_.long_holidays[n].start_date?_.long_holidays[n].start_date:""),onChange:e=>{i.onChange(e)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!l,helperText:null===l||void 0===l?void 0:l.message}}})}}),(0,P.jsx)(a.Qr,{name:"long_holidays[".concat(n,"].end_date"),control:i,render:t=>{let{field:i,fieldState:{error:l}}=t;return(0,P.jsx)(D.M,{label:e("end date"),value:new Date(_.long_holidays[n].end_date?_.long_holidays[n].end_date:""),onChange:e=>{i.onChange(e)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!l,helperText:null===l||void 0===l?void 0:l.message}}})}}),(0,P.jsx)(z.Z,{size:"small",color:"error",sx:{justifySelf:"flex-end",alignSelf:"flex-end",width:35},onClick:()=>(e=>{p(e)})(n),children:(0,P.jsx)(I.Z,{icon:"solar:trash-bin-trash-bold"})})]})},t.id)))}),(0,P.jsx)(T.Z,{sx:{mt:3,mb:1,borderStyle:"dashed"}}),(0,P.jsx)(r.Z,{spacing:1,direction:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"},children:(0,P.jsx)(C.Z,{size:"small",color:"primary",startIcon:(0,P.jsx)(I.Z,{icon:"tdesign:plus"}),sx:{padding:1},onClick:()=>{u({start_date:null,end_date:null,description:""})},children:n?"\u0625\u0636\u0627\u0641\u0629 \u0639\u0637\u0644 \u0637\u0648\u064a\u0644\u0629":"add long holiday"})})]})]})}var q=n(58406),M=n(82626),L=n(13034),A=n(62861),H=n(68096),Q=n(47071),V=n(86778),X=n(56125);function E(e){let{ParentIndex:t,open:n,appointmenttypesData:i,serviceTypesData:l,setAppointmentsNum:s}=e;const{t:o}=(0,w.qM)(),{currentLang:c}=(0,w.nt)(),m="ar"===c.value,{control:u,setValue:p,watch:_,resetField:x,getValues:v}=(0,a.Gc)(),{fields:h,append:g,remove:y}=(0,a.Dq)({control:u,name:"days_details[".concat(t,"].appointments")}),f=v(),b=e=>{const t=null===l||void 0===l?void 0:l.filter((t=>null===e||void 0===e?void 0:e.includes(t._id)));return null===t||void 0===t?void 0:t.map((e=>m?e.name_arabic:e.name_english)).join(", ")};return(0,P.jsx)(X.Z,{in:n,sx:{bgcolor:"background.neutral"},children:(0,P.jsxs)(S.Z,{sx:{px:2,pb:0},children:[f.days_details[t].appointments&&f.days_details[t].appointments.length>0&&(0,P.jsxs)(d.Z,{variant:"p",lang:"ar",sx:{color:"text.disabled",mb:3,fontSize:14},children:[o("appointments"),":"]}),(0,P.jsx)(r.Z,{sx:{mt:3},divider:(0,P.jsx)(T.Z,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:3,alignItems:"flex-end",children:h.map(((e,n)=>(0,P.jsx)(r.Z,{alignItems:"center",flexWrap:"wrap",spacing:1.5,sx:{width:"80%"},children:(0,P.jsxs)(r.Z,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:"100%"},children:[(0,P.jsx)(j.Cc,{size:"small",InputLabelProps:{shrink:!0},name:"days_details[".concat(t,"].appointments[").concat(n,"].appointment_type"),label:"".concat(o("appointment type")," *"),children:null===i||void 0===i?void 0:i.map((e=>(0,P.jsx)(M.Z,{value:e._id,children:m?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english})))}),(0,P.jsx)(a.Qr,{name:"days_details[".concat(t,"].appointments[").concat(n,"].start_time"),control:u,render:e=>{let{field:i,fieldState:{error:l}}=e;return(0,P.jsx)(V.d,{lang:"ar",minutesStep:"5",label:o("start time"),value:f.days_details[t].appointments[n].start_time?new Date(f.days_details[t].appointments[n].start_time):new Date,onChange:e=>{i.onChange(e)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!l,helperText:null===l||void 0===l?void 0:l.message}}})}}),(0,P.jsx)(a.Qr,{name:"days_details[".concat(t,"].appointments[").concat(n,"].service_types"),control:u,render:e=>{let{field:i,fieldState:{error:a}}=e;return(0,P.jsxs)(H.Z,{error:!!a,size:"small",sx:{width:"100%",shrink:!0},children:[(0,P.jsxs)(A.Z,{shrink:!0,children:[" ",o("service types")," "]}),(0,P.jsx)(q.Z,{...i,multiple:!0,id:"multiple-days_details[".concat(t,"].appointments[").concat(n,"].service_types"),label:o("service types"),renderValue:b,children:null===l||void 0===l?void 0:l.map((e=>{var t;const n=null===i||void 0===i||null===(t=i.value)||void 0===t?void 0:t.includes(e._id);return(0,P.jsxs)(M.Z,{value:e._id,children:[(0,P.jsx)(L.Z,{size:"small",disableRipple:!0,checked:n}),m?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english]},e._id)}))}),!!a&&(0,P.jsx)(Q.Z,{error:!!a,children:null===a||void 0===a?void 0:a.message})]})}}),(0,P.jsx)(j.jb,{size:"small",InputLabelProps:{shrink:!0},name:"days_details[".concat(t,"].appointments[").concat(n,"].online_available"),label:(0,P.jsx)(d.Z,{lang:"ar",sx:{fontSize:12},children:o("online avaliable")})}),(0,P.jsx)(z.Z,{size:"small",color:"error",sx:{justifySelf:{xs:"flex-end"},alignSelf:{xs:"flex-end"},width:35},onClick:()=>(e=>{y(e),s((e=>({...e,[t]:e[t]-1})))})(n),children:(0,P.jsx)(I.Z,{icon:"solar:trash-bin-trash-bold"})})]})},e.id)))}),(0,P.jsx)(T.Z,{sx:{mt:f.days_details[t].appointments&&f.days_details[t].appointments.length>0?3:0,mb:1,borderStyle:"dashed"}}),(0,P.jsx)(r.Z,{spacing:3,direction:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"},children:(0,P.jsx)(C.Z,{size:"small",color:"primary",startIcon:(0,P.jsx)(I.Z,{icon:"tdesign:plus"}),sx:{padding:1},onClick:()=>{const e=f.days_details[t].appointments?f.days_details[t].appointments[f.days_details[t].appointments.length-1]:null,n=new Date(e?e.start_time:f.days_details[t].work_start_time);e&&n.setMinutes(n.getMinutes()+f.appointment_time);const i={appointment_type:null,start_time:null,price:null,online_available:!0,service_types:[],...e,start_time:n};g(i),s((e=>({...e,[t]:e[t]+1})))},children:m?"\u0625\u0636\u0627\u0641\u0629 \u0645\u0648\u0627\u0639\u064a\u062f \u0628\u0627\u0644\u062a\u0641\u0635\u064a\u0644":"Add Detailed Appointment"})})]})})}function G(e){var t,n;let{appointTime:i}=e;const{t:s}=(0,w.qM)(),{currentLang:o}=(0,w.nt)(),c="ar"===o.value,m=[{value:"saturday",label:s("Saturday")},{value:"sunday",label:s("Sunday")},{value:"Monday",label:s("Monday")},{value:"tuesday",label:s("Tuesday")},{value:"wednesday",label:s("Wednesday")},{value:"thursday",label:s("Thursday")},{value:"friday",label:s("Friday")}],{control:u,setValue:p,watch:_,resetField:x,getValues:h}=(0,a.Gc)(),{fields:g,append:y,remove:f}=(0,a.Dq)({control:u,name:"days_details"}),{user:b}=(0,v.E)(),[Z,D]=(0,l.useState)({}),[F,W]=(0,l.useState)({}),{appointmenttypesData:X}=(0,k.o5)(),{serviceTypesData:G}=(0,k.fO)(null===b||void 0===b||null===(t=b.employee)||void 0===t||null===(n=t.employee_engagements[null===b||void 0===b?void 0:b.employee.selected_engagement])||void 0===n?void 0:n.unit_service._id),R=h();function N(e,t){const n=new Date(e),i=new Date(t),l=Math.abs(i-n);return Math.floor(l/6e4)}const O=e=>{const t=null===G||void 0===G?void 0:G.filter((t=>null===e||void 0===e?void 0:e.includes(t._id)));return null===t||void 0===t?void 0:t.map((e=>e.name_english)).join(", ")};function U(e){const t=R.days_details[e];if(t.appointments.length)return t.appointments.length;if(t.break_start_time&&t.break_end_time){return Math.floor(N(t.work_start_time,t.break_start_time)/R.appointment_time)+Math.floor(N(t.break_end_time,t.work_end_time)/R.appointment_time)||0}return Math.floor(N(t.work_start_time,t.work_end_time)/R.appointment_time)||0}return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(T.Z,{flexItem:!0,sx:{borderStyle:"solid"}}),(0,P.jsxs)(S.Z,{sx:{p:3},children:[(0,P.jsxs)(d.Z,{variant:"p",sx:{color:"text.secondary",mb:3,fontWeight:"700",textTransform:"capitalize"},children:[c?"\u062a\u0641\u0627\u0635\u064a\u0644 \u0627\u0644\u064a\u0648\u0645":"Days Details",":"]}),(0,P.jsx)(r.Z,{sx:{mt:3},divider:(0,P.jsx)(T.Z,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:3,children:g.map(((e,t)=>(0,P.jsxs)(r.Z,{spacing:1.5,sx:{width:"100%"},children:[(0,P.jsxs)(r.Z,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:"100%",mt:2},children:[(0,P.jsxs)(r.Z,{direction:{xs:"column",md:"column"},spacing:2,sx:{width:"100%",mt:2},children:[(0,P.jsx)(j.Cc,{InputLabelProps:{shrink:!0},size:"small",name:"days_details[".concat(t,"].day"),label:s("day"),children:m.filter((e=>!R.weekend.includes(e.value)&&!R.days_details.some((n=>{var i;return n.day===e.value&&(null===(i=R.days_details[t])||void 0===i?void 0:i.day)!==e.value})))).map((e=>(0,P.jsx)(M.Z,{value:e.value,children:e.label})))}),(0,P.jsx)(j.au,{lang:"ar",disabled:!0,size:"small",name:"days_details[".concat(t,"].appointment_number"),label:s("appointments number"),InputLabelProps:{shrink:!0},value:F[t]||U(t)})]}),(0,P.jsxs)(r.Z,{direction:{xs:"column",md:"column"},spacing:2,sx:{width:"100%",mt:2},children:[(0,P.jsx)(a.Qr,{name:"days_details[".concat(t,"].work_start_time"),control:u,render:e=>{let{field:n,fieldState:{error:i}}=e;return(0,P.jsx)(V.d,{lang:"ar",minutesStep:"5",label:s("work start time"),value:R.days_details[t].work_start_time?new Date(R.days_details[t].work_start_time):null,onChange:e=>{n.onChange(e)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!i,helperText:null===i||void 0===i?void 0:i.message}}})}}),(0,P.jsx)(a.Qr,{name:"days_details[".concat(t,"].break_start_time"),control:u,render:e=>{let{field:n,fieldState:{error:i}}=e;return(0,P.jsx)(V.d,{lang:"ar",minutesStep:"5",label:s("break start time"),value:R.days_details[t].break_start_time?new Date(R.days_details[t].break_start_time):null,onChange:e=>{n.onChange(e)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!i,helperText:null===i||void 0===i?void 0:i.message}}})}})]}),(0,P.jsxs)(r.Z,{direction:{xs:"column",md:"column"},spacing:2,sx:{width:"100%",mt:2},children:[(0,P.jsx)(a.Qr,{name:"days_details[".concat(t,"].work_end_time"),control:u,render:e=>{let{field:n,fieldState:{error:i}}=e;return(0,P.jsx)(V.d,{lang:"ar",minutesStep:"5",label:s("work end time"),value:R.days_details[t].work_end_time?new Date(R.days_details[t].work_end_time):null,onChange:e=>{n.onChange(e)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!i,helperText:null===i||void 0===i?void 0:i.message}}})}}),(0,P.jsx)(a.Qr,{name:"days_details[".concat(t,"].break_end_time"),control:u,render:e=>{let{field:n,fieldState:{error:i}}=e;return(0,P.jsx)(V.d,{lang:"ar",minutesStep:"5",label:s("break end time"),value:R.days_details[t].break_end_time?new Date(R.days_details[t].break_end_time):null,onChange:e=>{n.onChange(e)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!i,helperText:null===i||void 0===i?void 0:i.message}}})}})]}),(0,P.jsxs)(r.Z,{direction:{xs:"column",md:"column"},spacing:2,sx:{width:"100%",mt:2},children:[(0,P.jsx)(j.Cc,{size:"small",InputLabelProps:{shrink:!0},name:"days_details[".concat(t,"].appointment_type"),label:"".concat(s("appointment type")," *"),children:null===X||void 0===X?void 0:X.map((e=>(0,P.jsx)(M.Z,{value:e._id,children:c?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english})))}),(0,P.jsx)(a.Qr,{name:"days_details[".concat(t,"].service_types"),control:u,render:e=>{let{field:n,fieldState:{error:i}}=e;return(0,P.jsxs)(H.Z,{error:!!i,size:"small",sx:{width:"100%",shrink:!0},children:[(0,P.jsxs)(A.Z,{shrink:!0,children:[" ",s("service types")," "]}),(0,P.jsx)(q.Z,{...n,multiple:!0,id:"multiple-days_details[".concat(t,"].service_types"),label:s("service types"),renderValue:O,children:null===G||void 0===G?void 0:G.map((e=>{var t;const i=null===n||void 0===n||null===(t=n.value)||void 0===t?void 0:t.includes(e._id);return(0,P.jsxs)(M.Z,{value:e._id,children:[(0,P.jsx)(L.Z,{size:"small",disableRipple:!0,checked:i}),c?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english]},e._id)}))}),!!i&&(0,P.jsx)(Q.Z,{error:!!i,children:null===i||void 0===i?void 0:i.message})]})}})]}),(0,P.jsxs)(r.Z,{direction:{xs:"column",md:"column"},spacing:.2,sx:{justifySelf:{xs:"flex-end"},alignSelf:{xs:"flex-end"}},children:[(0,P.jsx)(z.Z,{size:"small",color:"error",onClick:()=>(e=>{f(e)})(t),children:(0,P.jsx)(I.Z,{icon:"solar:trash-bin-trash-bold"})}),(0,P.jsx)(z.Z,{size:"small",onClick:()=>async function(e){const t=[];if(!i&&!R.appointment_time)return;const n=e=>{const t=new Date(e);return 60*t.getHours()+t.getMinutes()},l=(e,t)=>{const n=new Date(e);return new Date(n.getTime()-6e4*t)},a=R.days_details[e];let s=N(a.work_start_time,a.work_end_time),o=N(a.work_start_time,a.break_start_time),r=N(a.break_end_time,a.work_end_time);const d=()=>{if(s>=R.appointment_time){const i=l(a.work_end_time,s),o=a.appointments.filter((e=>n(i)===n(e.start_time)))[0];return o?t.push(o):t.push({appointment_type:a.appointment_type||null,start_time:i,price:null,service_types:a.service_types||[]}),s-=R.appointment_time,new Promise((t=>{setTimeout((()=>{t(d(a,e,s))}),0)}))}return Promise.resolve()},c=()=>{if(o>=R.appointment_time){const i=l(a.break_start_time,o),s=a.appointments.filter((e=>n(i)===n(e.start_time)))[0];return s?t.push(s):t.push({appointment_type:a.appointment_type||null,start_time:i,price:null,service_types:a.service_types||[]}),o-=R.appointment_time,new Promise((t=>{setTimeout((()=>{t(c(a,e,o))}),0)}))}return Promise.resolve()},m=()=>{if(r>=R.appointment_time){const i=l(a.work_end_time,r),s=a.appointments.filter((e=>n(i)===n(e.start_time)))[0];return s?t.push(s):t.push({appointment_type:a.appointment_type||null,start_time:i,price:null,service_types:a.service_types||[]}),r-=R.appointment_time,new Promise((t=>{setTimeout((()=>{t(m(a,e,r))}),0)}))}return Promise.resolve()};a.break_start_time&&a.break_end_time?(await c(),await m()):await d(),W({...F,[e]:t.length}),p("days_details[".concat(e,"].appointments"),t)}(t),children:(0,P.jsx)(I.Z,{icon:"zondicons:refresh"})}),(0,P.jsx)(z.Z,{size:"small",onClick:()=>D({...Z,[t]:!Z[t]}),children:(0,P.jsx)(I.Z,{icon:"tabler:list-details"})})]})]}),(0,P.jsx)(E,{setAppointmentsNum:W,serviceTypesData:G,appointmenttypesData:X,open:Z[t],ParentIndex:t})]},e.id)))}),(0,P.jsx)(T.Z,{sx:{mt:3,mb:1,borderStyle:"dashed"}}),(0,P.jsx)(r.Z,{spacing:3,direction:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"},children:(0,P.jsx)(C.Z,{size:"small",color:"primary",startIcon:(0,P.jsx)(I.Z,{icon:"tdesign:plus"}),sx:{padding:1},onClick:()=>{const e={day:"",work_start_time:null,work_end_time:null,break_start_time:null,break_end_time:null,appointments:[],service_types:[],appointment_type:null,...R.days_details?R.days_details[R.days_details.length-1]:"",day:"",appointments:[]};y(e)},children:c?"\u0625\u0636\u0627\u0641\u0629 \u064a\u0648\u0645 \u062c\u062f\u064a\u062f":"add new day"})})]})]})}var R=n(57689),N=n(63466),O=n(48550);function U(e){var t,n;let{appointmentConfigData:i,setAppointTime:l}=e;const{t:s}=(0,w.qM)(),{currentLang:o}=(0,w.nt)(),c="ar"===o.value,m=[{value:"saturday",label:s("Saturday")},{value:"sunday",label:s("Sunday")},{value:"Monday",label:s("Monday")},{value:"tuesday",label:s("Tuesday")},{value:"wednesday",label:s("Wednesday")},{value:"thursday",label:s("Thursday")},{value:"friday",label:s("Friday")}],{control:u,watch:p,getValues:_,setValue:x}=(0,a.Gc)(),h=_(),{user:g}=(0,v.E)(),{id:y}=(0,R.UO)(),{workGroupsData:f}=(0,k.nj)(y),{workShiftsData:b}=(0,k.lL)(null===g||void 0===g||null===(t=g.employee)||void 0===t||null===(n=t.employee_engagements[null===g||void 0===g?void 0:g.employee.selected_engagement])||void 0===n?void 0:n.unit_service._id);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(T.Z,{flexItem:!0,sx:{borderStyle:"solid"}}),(0,P.jsxs)(r.Z,{sx:{p:3},children:[(0,P.jsxs)(r.Z,{spacing:2,direction:{xs:"column",sm:"row"},sx:{p:3,width:{xs:"100%",md:"auto"}},children:[(0,P.jsx)(a.Qr,{name:"start_date",control:u,render:e=>{let{field:t,fieldState:{error:n}}=e;return(0,P.jsx)(D.M,{label:"".concat(s("start date")," *"),value:new Date(h.start_date||""),onChange:e=>{t.onChange(e)},slotProps:{textField:{fullWidth:!0,error:!!n,helperText:null===n||void 0===n?void 0:n.message}}})}}),(0,P.jsx)(a.Qr,{name:"end_date",control:u,render:e=>{let{field:t,fieldState:{error:n}}=e;return(0,P.jsx)(D.M,{label:s("end date"),value:new Date(h.end_date||""),onChange:e=>{t.onChange(e)},slotProps:{textField:{fullWidth:!0,error:!!n,helperText:null===n||void 0===n?void 0:n.message}}})}})]}),(0,P.jsxs)(r.Z,{spacing:2,direction:{xs:"column",sm:"row"},sx:{px:3,pb:3,width:{xs:"100%",md:"auto"}},children:[(0,P.jsx)(j.Cc,{size:"small",name:"work_shift",label:"".concat(s("work shift")," *"),InputLabelProps:{shrink:!0},PaperPropsSx:{textTransform:"capitalize"},disabled:Boolean(i),children:b.map((e=>(0,P.jsx)(M.Z,{value:e._id,children:c?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english},e._id)))}),(0,P.jsx)(j.Cc,{size:"small",name:"work_group",label:"".concat(s("work group")," *"),InputLabelProps:{shrink:!0},PaperPropsSx:{textTransform:"capitalize"},disabled:Boolean(i),children:f&&(null===f||void 0===f?void 0:f.map((e=>(0,P.jsx)(M.Z,{value:e._id,children:c?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english},e._id))))}),(0,P.jsx)(a.Qr,{name:"appointment_time",control:u,render:e=>{let{field:t,fieldState:{error:n}}=e;return(0,P.jsx)(O.Z,{fullWidth:!0,label:s("appointment time"),type:"number",lang:"ar",value:0===t.value?"":t.value,onChange:e=>{t.onChange(Number(e.target.value)),l(e.target.value)},error:!!n,size:"small",InputLabelProps:{shrink:!0},InputProps:{endAdornment:(0,P.jsx)(N.Z,{position:"end",children:(0,P.jsx)(S.Z,{lang:"ar",sx:{fontSize:"0.8rem"},children:s("min")})})}})}}),(0,P.jsx)(j.au,{lang:"ar",size:"small",InputProps:{startAdornment:(0,P.jsx)(N.Z,{position:"start",children:(0,P.jsx)(S.Z,{sx:{fontSize:"0.8rem"},children:c?"\u0644\u0628\u0639\u062f":"for the next"})}),endAdornment:(0,P.jsx)(N.Z,{position:"end",children:(0,P.jsx)(S.Z,{sx:{fontSize:"0.8rem"},children:c?"\u0623\u064a\u0627\u0645":"days"})})},name:"config_frequency",label:s("configuration frequency"),type:"number",inputProps:{min:0,max:30,textAlign:"center"},InputLabelProps:{shrink:!0}})]}),(0,P.jsxs)(d.Z,{variant:"p",sx:{color:"text.secondary",mb:3,fontWeight:"700",textTransform:"capitalize"},children:[c?"\u0627\u0644\u0639\u0637\u0644 \u0627\u0644\u0623\u0633\u0628\u0648\u0639\u064a\u0629":"Weekly Days Off",":"]}),(0,P.jsx)(r.Z,{spacing:2,direction:{xs:"column",sm:"row"},sx:{p:3},children:(0,P.jsx)(j.s2,{size:"small",name:"weekend",options:m,sx:{display:"grid",gridTemplateColumns:{md:"repeat(7, 1fr)",sm:"repeat(4, 1fr)",xs:"repeat(2, 1fr)"}}})})]})]})}function B(e){let{appointmentConfigData:t,refetch:n,loading:u}=e;const S=(0,x.tv)(),{t:C}=(0,w.qM)(),{currentLang:T}=(0,w.nt)(),z="ar"===T.value,{id:D}=(0,x.UO)(),{user:I}=(0,v.E)(),q=(0,k.X7)(D).data,[M,L]=(0,l.useState)(0),[A,H]=(0,l.useState)([]),{enqueueSnackbar:Q}=(0,b.Ds)(),V=((0,g.K$)(),(0,h.k)(!1)),X=(0,h.k)(!1),E=(0,h.k)(),R=(0,h.k)(),N=i.Ry().shape({weekend:i.IX(),start_date:i.hT().nullable(),end_date:i.hT().nullable(),appointment_time:i.Rx().required("Appointment Time is required").min(5,"Appointment Time must be at least 5").max(180,"Appointment Time must be at most 180"),config_frequency:i.Rx().required("Configuration Frequency is required").min(1,"must be at least 1").max(360,"must be at most 360"),holidays:i.IX(),long_holidays:i.IX(),work_group:i.Z_().required("Work Group is required"),work_shift:i.Z_().required("Work Shift is required"),days_details:i.IX().of(i.Ry().shape({day:i.Z_().required("Day is required"),work_start_time:i.hT(),work_end_time:i.hT().when("work_start_time",((e,t)=>e&&t.min(e,"Work End Time must be after Work Start Time"))),appointments:i.IX(),service_types:i.IX(),appointment_type:i.Z_().nullable()}))}),O=(0,l.useMemo)((()=>{var e,n,i,l,a,s,o,r;return{unit_service:(null===t||void 0===t?void 0:t.unit_service._id)||(null===I||void 0===I||null===(e=I.employee)||void 0===e||null===(n=e.employee_engagements[null===I||void 0===I?void 0:I.employee.selected_engagement])||void 0===n?void 0:n.unit_service._id),department:(null===q||void 0===q||null===(i=q.department)||void 0===i?void 0:i._id)||(null===I||void 0===I||null===(l=I.employee)||void 0===l||null===(a=l.employee_engagements[null===I||void 0===I?void 0:I.employee.selected_engagement])||void 0===a||null===(s=a.department)||void 0===s?void 0:s._id),start_date:(null===t||void 0===t?void 0:t.start_date)||null,end_date:(null===t||void 0===t?void 0:t.end_date)||null,weekend:(null===t||void 0===t?void 0:t.weekend)||[],appointment_time:(null===t||void 0===t?void 0:t.appointment_time)||null,config_frequency:(null===t||void 0===t?void 0:t.config_frequency)||null,holidays:(null===t||void 0===t?void 0:t.holidays)||[{description:"",date:null}],long_holidays:(null===t||void 0===t?void 0:t.long_holidays)||[{description:"",start_date:null,end_date:null}],work_group:(null===t||void 0===t||null===(o=t.work_group)||void 0===o?void 0:o._id)||null,work_shift:(null===t||void 0===t||null===(r=t.work_shift)||void 0===r?void 0:r._id)||null,days_details:(null===t||void 0===t?void 0:t.days_details)||[]}}),[t,null===I||void 0===I?void 0:I.employee,null===q||void 0===q?void 0:q.department]),B=(0,a.cI)({resolver:(0,s.X)(N),defaultValues:O}),{reset:J,handleSubmit:K,formState:{isSubmitting:$}}=B,Y=K((async e=>{R.onTrue();const n=new Date,i=new Date(n.getTime()+24*e.config_frequency*60*60*1e3);try{t?!e.start_date&&!e.end_date||new Date(e.end_date)>n&&(new Date(e.start_date)<=n||new Date(e.start_date)<i)?(H(e),E.onTrue()):(await f.ZP.patch("".concat(f.Hv.tables.appointmentconfigs,"/").concat(null===t||void 0===t?void 0:t._id),e),y.W.emit("updated",{data:e,user:I,link:_.H.unitservice.employees.appointmentconfig.root(D),msg:"updated an appointment configuration ".concat(t.code)}),S.push(_.H.unitservice.employees.appointmentconfig.root(D))):(X.onTrue(),await f.ZP.post(f.Hv.tables.appointmentconfigs,e),y.W.emit("created",{data:e,user:I,link:_.H.unitservice.employees.appointmentconfig.root(D),msg:"created an appointment config <strong>".concat(e.name_english,"</strong>")}),X.onFalse(),Q(C("added successfully!")),S.push(_.H.unitservice.employees.appointmentconfig.root(D))),R.onFalse(),console.info("DATA",JSON.stringify(e,null,2))}catch(l){y.W.emit("error",{error:l,user:I,location:window.location.href}),Q(C("failed to add!"),{variant:"error"}),console.error(l),R.onFalse()}}));return(0,l.useEffect)((()=>{var e,n,i,l,a,s,o;t&&B.reset({unit_service:(null===t||void 0===t?void 0:t.unit_service)||(null===I||void 0===I||null===(e=I.employee)||void 0===e||null===(n=e.employee_engagements[null===I||void 0===I?void 0:I.employee.selected_engagement])||void 0===n?void 0:n.unit_service._id),department:(null===q||void 0===q||null===(i=q.department)||void 0===i?void 0:i._id)||(null===I||void 0===I||null===(l=I.employee.employee_engagements[null===I||void 0===I?void 0:I.employee.selected_engagement])||void 0===l||null===(a=l.department)||void 0===a?void 0:a._id),start_date:(null===t||void 0===t?void 0:t.start_date)||null,end_date:(null===t||void 0===t?void 0:t.end_date)||null,weekend:(null===t||void 0===t?void 0:t.weekend)||[],appointment_time:(null===t||void 0===t?void 0:t.appointment_time)||null,config_frequency:(null===t||void 0===t?void 0:t.config_frequency)||null,holidays:(null===t||void 0===t?void 0:t.holidays)||[{description:"",date:null}],long_holidays:(null===t||void 0===t?void 0:t.long_holidays)||[{description:"",start_date:null,end_date:null}],work_group:(null===(s=t.work_group)||void 0===s?void 0:s._id)||null,work_shift:(null===(o=t.work_shift)||void 0===o?void 0:o._id)||null,days_details:t.days_details||[{day:"",work_start_time:null,work_end_time:null,break_start_time:null,break_end_time:null,appointments:[]}]})}),[t,B,I,null===q||void 0===q?void 0:q.department]),(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(m.Z,{maxWidth:"lg",children:(0,P.jsxs)(j.ZP,{methods:B,children:[!u&&(0,P.jsxs)(o.Z,{children:[(0,P.jsx)(U,{setAppointTime:L,appointmentConfigData:t}),(0,P.jsx)(G,{appointTime:M}),(0,P.jsx)(F,{}),(0,P.jsx)(W,{})]}),(0,P.jsx)(r.Z,{justifyContent:"flex-end",direction:"row",spacing:2,sx:{mt:3},children:(0,P.jsx)(c.Z,{variant:"contained",loading:$||V.value||X.value,onClick:Y,children:C("save")})})]})}),(0,P.jsx)(Z.Q,{disabled:X.value,open:X.value||E.value,onClose:E.onFalse,title:X.value?"Creating appointments...":"Save changes",content:X.value?(0,P.jsx)(P.Fragment,{children:(0,P.jsx)(p(),{options:{strings:["It might take several minutes..","We are getting appointments ready..","We are almost done.."],autoStart:!0,loop:!0,deleteSpeed:5,cursor:"",delay:20}})}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(d.Z,{variant:"body1",component:"h6",sx:{mt:1},children:z?"\u0647\u0644 \u062a\u0631\u064a\u062f \u062a\u063a\u064a\u064a\u0631 \u0627\u0644\u0645\u0648\u0627\u0639\u064a\u062f \u0627\u0644\u0645\u0646\u0634\u0623\u0629 \u0645\u0633\u0628\u0642\u0627\u061f":"Do you want to change your existance appointments?"}),z?(0,P.jsxs)(d.Z,{variant:"body2",component:"p",sx:{mt:1,color:"text.disabled"},children:["\u0627\u0636\u063a\u0637 ",(0,P.jsx)("strong",{children:" \u0646\u0639\u0645 "})," \u0644\u062a\u063a\u064a\u064a\u0631 \u0627\u0644\u0645\u0648\u0627\u0639\u064a\u062f \u0627\u0644\u0645\u0646\u0634\u0623\u0629"]}):(0,P.jsxs)(d.Z,{variant:"body2",component:"p",sx:{mt:1,color:"text.disabled"},children:["press",(0,P.jsx)("strong",{children:" yes"})," to change existance appointments"]}),z?(0,P.jsxs)(d.Z,{variant:"body2",component:"p",sx:{mt:1,color:"text.disabled"},children:["\u0627\u0636\u063a\u0637 ",(0,P.jsx)("strong",{children:" \u0644\u0627 "})," \u0644\u062d\u0641\u0638 \u0627\u0644\u0627\u0639\u062f\u0627\u062f\u0627\u062a \u0644\u0644\u0628\u062f\u0621 \u0645\u0646 \u0627\u0644\u0645\u0648\u0627\u0639\u064a\u062f \u0627\u0644\u062a\u064a \u064a\u0631\u0627\u062f \u0625\u0646\u0634\u0627\u0626\u0647\u0627"]}):(0,P.jsxs)(d.Z,{variant:"body2",component:"p",sx:{mt:1,color:"text.disabled"},children:["press",(0,P.jsx)("strong",{children:" No"})," to start changing when creating new appointments"]})]}),action:(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(c.Z,{variant:"contained",loading:X.value,color:"warning",onClick:async()=>{X.onTrue();try{await f.ZP.patch("".concat(f.Hv.tables.appointmentconfigs,"/").concat(null===t||void 0===t?void 0:t._id),{...A,ImmediateEdit:!0}),y.W.emit("updated",{user:I,link:_.H.unitservice.employees.appointmentconfig.root(D),msg:"updated an appointment configuration <strong>[ ".concat(t.code," ]</strong>")}),X.onFalse(),E.onFalse(),Q(C("Updated successfully!")),S.push(_.H.unitservice.employees.appointmentconfig.root(D))}catch(e){y.W.emit("error",{error:e,user:I,location:window.location.href}),X.onFalse(),E.onFalse(),Q(C("Failed to update!"),{variant:"error"})}},children:C("yes")}),(0,P.jsx)(c.Z,{disabled:X.value,loading:V.value,variant:"contained",color:"success",onClick:async()=>{V.onTrue();try{await f.ZP.patch("".concat(f.Hv.tables.appointmentconfigs,"/").concat(null===t||void 0===t?void 0:t._id),{...A,ImmediateEdit:!1}),y.W.emit("updated",{user:I,link:_.H.unitservice.employees.appointmentconfig.root(D),msg:"updated an appointment configuration <strong>[ ".concat(t.code," ]</strong>")}),Q(C("updated successfully!")),V.onFalse(),E.onFalse(),S.push(_.H.unitservice.employees.appointmentconfig.root(D))}catch(e){y.W.emit("error",{error:e,user:I,location:window.location.href}),V.onFalse(),Q(C("failed to update!"),{variant:"error"})}},children:C("no")})]})})]})}}}]);
//# sourceMappingURL=5401.45e3f30a.chunk.js.map