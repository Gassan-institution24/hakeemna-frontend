"use strict";(self.webpackChunk_minimal_kit_cra_js=self.webpackChunk_minimal_kit_cra_js||[]).push([[5401],{85401:(e,n,t)=>{t.d(n,{Z:()=>K});var i=t(8007),l=t(61134),a=t(6165),s=t.n(a),o=t(72791),r=t(44695),d=t(57621),c=t(36314),u=t(89164),m=t(12258),p=t(63515),v=t(4567),_=t(68870),x=t(13239),h=t(38072),g=t(19208),y=t(22459),f=t(89731),j=t(99116),b=t(8976),w=t(66833),k=t(76932),Z=t(81688),S=t(32869),T=t(25279),C=t(77008),z=t(57689),D=t(94721),I=t(82626),P=t(48550),F=t(63466),q=t(41985),M=t(80184);function W(e){var n,t;let{appointmentConfigData:i,setAppointTime:a}=e;const{t:s}=(0,k.qM)(),{currentLang:o}=(0,k.nt)(),r="ar"===o.value,d=[{value:"saturday",label:s("Saturday")},{value:"sunday",label:s("Sunday")},{value:"Monday",label:s("Monday")},{value:"tuesday",label:s("Tuesday")},{value:"wednesday",label:s("Wednesday")},{value:"thursday",label:s("Thursday")},{value:"friday",label:s("Friday")}],{control:u,watch:m,getValues:p,setValue:x}=(0,l.Gc)(),h=p(),{user:g}=(0,b.E)(),{id:y}=(0,z.UO)(),{workGroupsData:f}=(0,w.nj)(y),{workShiftsData:j}=(0,w.lL)(null===g||void 0===g||null===(n=g.employee)||void 0===n||null===(t=n.employee_engagements[null===g||void 0===g?void 0:g.employee.selected_engagement])||void 0===t?void 0:t.unit_service._id);return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(D.Z,{flexItem:!0,sx:{borderStyle:"solid"}}),(0,M.jsxs)(c.Z,{sx:{p:3},children:[(0,M.jsxs)(c.Z,{spacing:2,direction:{xs:"column",sm:"row"},sx:{p:3,width:{xs:"100%",md:"auto"}},children:[(0,M.jsx)(l.Qr,{name:"start_date",control:u,render:e=>{let{field:n,fieldState:{error:t}}=e;return(0,M.jsx)(q.M,{label:"".concat(s("start date")," *"),value:new Date(h.start_date||""),onChange:e=>{n.onChange(e)},slotProps:{textField:{fullWidth:!0,error:!!t,helperText:null===t||void 0===t?void 0:t.message}}})}}),(0,M.jsx)(l.Qr,{name:"end_date",control:u,render:e=>{let{field:n,fieldState:{error:t}}=e;return(0,M.jsx)(q.M,{label:s("end date"),value:new Date(h.end_date||""),onChange:e=>{n.onChange(e)},slotProps:{textField:{fullWidth:!0,error:!!t,helperText:null===t||void 0===t?void 0:t.message}}})}})]}),(0,M.jsxs)(c.Z,{spacing:2,direction:{xs:"column",sm:"row"},sx:{px:3,pb:3,width:{xs:"100%",md:"auto"}},children:[(0,M.jsx)(Z.Cc,{size:"small",name:"work_shift",label:"".concat(s("work shift")," *"),InputLabelProps:{shrink:!0},PaperPropsSx:{textTransform:"capitalize"},disabled:Boolean(i),children:j.map((e=>(0,M.jsx)(I.Z,{value:e._id,children:r?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english},e._id)))}),(0,M.jsx)(Z.Cc,{size:"small",name:"work_group",label:"".concat(s("work group")," *"),InputLabelProps:{shrink:!0},PaperPropsSx:{textTransform:"capitalize"},disabled:Boolean(i),children:f&&(null===f||void 0===f?void 0:f.map((e=>(0,M.jsx)(I.Z,{value:e._id,children:r?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english},e._id))))}),(0,M.jsx)(l.Qr,{name:"appointment_time",control:u,render:e=>{let{field:n,fieldState:{error:t}}=e;return(0,M.jsx)(P.Z,{fullWidth:!0,label:s("appointment duration time"),type:"number",lang:"ar",value:0===n.value?"":n.value,onChange:e=>{n.onChange(Number(e.target.value)),a(e.target.value)},error:!!t,size:"small",InputLabelProps:{shrink:!0},InputProps:{endAdornment:(0,M.jsx)(F.Z,{position:"end",children:(0,M.jsx)(_.Z,{lang:"ar",sx:{fontSize:"0.8rem"},children:s("min")})})}})}}),(0,M.jsx)(Z.au,{lang:"ar",size:"small",InputProps:{startAdornment:(0,M.jsx)(F.Z,{position:"start",children:(0,M.jsx)(_.Z,{sx:{fontSize:"0.8rem"},children:r?"\u0644\u0628\u0639\u062f":"for the next"})}),endAdornment:(0,M.jsx)(F.Z,{position:"end",children:(0,M.jsx)(_.Z,{sx:{fontSize:"0.8rem"},children:r?"\u0623\u064a\u0627\u0645":"days"})})},name:"config_frequency",label:s("configuration frequency"),type:"number",inputProps:{min:0,max:30,textalign:"center"},InputLabelProps:{shrink:!0}})]}),(0,M.jsxs)(v.Z,{variant:"p",sx:{color:"text.secondary",mb:3,fontWeight:"700",textTransform:"capitalize"},children:[r?"\u0627\u0644\u0639\u0637\u0644 \u0627\u0644\u0623\u0633\u0628\u0648\u0639\u064a\u0629":"Weekly Days Off",":"]}),(0,M.jsx)(c.Z,{spacing:2,direction:{xs:"column",sm:"row"},sx:{p:3},children:(0,M.jsx)(Z.s2,{size:"small",name:"weekend",options:d,sx:{display:"grid",gridTemplateColumns:{md:"repeat(7, 1fr)",sm:"repeat(4, 1fr)",xs:"repeat(2, 1fr)"}}})})]})]})}var L=t(13838),H=t(13400),A=t(40268);function Q(){const{t:e}=(0,k.qM)(),{currentLang:n}=(0,k.nt)(),t="ar"===n.value,{control:i,setValue:a,watch:s,resetField:o,getValues:r}=(0,l.Gc)(),{fields:d,append:u,remove:m}=(0,l.Dq)({control:i,name:"holidays"}),p=r();return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(D.Z,{flexItem:!0,sx:{borderStyle:"solid"}}),(0,M.jsxs)(_.Z,{sx:{p:3},children:[(0,M.jsxs)(v.Z,{variant:"p",sx:{color:"text.secondary",mb:3,fontWeight:"700",textTransform:"capitalize"},children:[t?"\u0627\u0644\u0639\u0637\u0644":"Holidays",":"]}),(0,M.jsx)(c.Z,{sx:{mt:3},divider:(0,M.jsx)(D.Z,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:2,children:d.map(((n,t)=>(0,M.jsx)(c.Z,{alignItems:"flex-start",spacing:1.5,sx:{width:{xs:"100%",md:"auto"}},children:(0,M.jsxs)(c.Z,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:{xs:"100%",md:"auto"}},children:[(0,M.jsx)(Z.au,{lang:"ar",size:"small",name:"holidays[".concat(t,"].description"),label:e("description")}),(0,M.jsx)(l.Qr,{name:"holidays[".concat(t,"].date"),control:i,render:n=>{let{field:i,fieldState:{error:l}}=n;return(0,M.jsx)(q.M,{label:e("date"),value:new Date(p.holidays[t].date?p.holidays[t].date:""),onChange:e=>{i.onChange(e)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!l,helperText:null===l||void 0===l?void 0:l.message}}})}}),(0,M.jsx)(H.Z,{sx:{justifySelf:"flex-end",alignSelf:"flex-end",width:35},size:"small",color:"error",onClick:()=>(e=>{m(e)})(t),children:(0,M.jsx)(A.Z,{icon:"solar:trash-bin-trash-bold"})})]})},n.id)))}),(0,M.jsx)(D.Z,{sx:{mt:3,mb:1,borderStyle:"dashed"}}),(0,M.jsx)(c.Z,{spacing:3,direction:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"},children:(0,M.jsx)(L.Z,{size:"small",color:"primary",startIcon:(0,M.jsx)(A.Z,{icon:"tdesign:plus"}),sx:{padding:1},onClick:()=>{u({date:null,description:""})},children:t?"\u0625\u0636\u0627\u0641\u0629 \u0623\u064a\u0627\u0645 \u0639\u0637\u0644":"add holiday"})})]})]})}var V=t(58406),E=t(13034),X=t(62861),G=t(68096),O=t(47071),R=t(86778),N=t(56125);function U(e){let{ParentIndex:n,open:t,appointmenttypesData:i,serviceTypesData:a,setAppointmentsNum:s}=e;const{t:o}=(0,k.qM)(),{currentLang:r}=(0,k.nt)(),d="ar"===r.value,{control:u,setValue:m,watch:p,resetField:x,getValues:h}=(0,l.Gc)(),{fields:g,append:y,remove:f}=(0,l.Dq)({control:u,name:"days_details[".concat(n,"].appointments")}),j=h(),b=e=>{const n=null===a||void 0===a?void 0:a.filter((n=>null===e||void 0===e?void 0:e.includes(n._id)));return null===n||void 0===n?void 0:n.map((e=>d?e.name_arabic:e.name_english)).join(", ")};return(0,M.jsx)(N.Z,{in:t,sx:{bgcolor:"background.neutral"},children:(0,M.jsxs)(_.Z,{sx:{px:2,pb:0},children:[j.days_details[n].appointments&&j.days_details[n].appointments.length>0&&(0,M.jsxs)(v.Z,{variant:"p",lang:"ar",sx:{color:"text.disabled",mb:3,fontSize:14},children:[o("appointments"),":"]}),(0,M.jsx)(c.Z,{sx:{mt:3},divider:(0,M.jsx)(D.Z,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:3,alignItems:"flex-end",children:g.map(((e,t)=>(0,M.jsx)(c.Z,{alignItems:"center",flexWrap:"wrap",spacing:1.5,sx:{width:"80%"},children:(0,M.jsxs)(c.Z,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:"100%"},children:[(0,M.jsx)(Z.Cc,{size:"small",InputLabelProps:{shrink:!0},name:"days_details[".concat(n,"].appointments[").concat(t,"].appointment_type"),label:"".concat(o("appointment type")," *"),children:null===i||void 0===i?void 0:i.map((e=>(0,M.jsx)(I.Z,{value:e._id,children:d?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english})))}),(0,M.jsx)(l.Qr,{name:"days_details[".concat(n,"].appointments[").concat(t,"].start_time"),control:u,render:e=>{let{field:i,fieldState:{error:l}}=e;return(0,M.jsx)(R.d,{lang:"ar",minutesStep:"5",label:o("start time"),value:j.days_details[n].appointments[t].start_time?new Date(j.days_details[n].appointments[t].start_time):new Date,onChange:e=>{i.onChange(e)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!l,helperText:null===l||void 0===l?void 0:l.message}}})}}),(0,M.jsx)(l.Qr,{name:"days_details[".concat(n,"].appointments[").concat(t,"].service_types"),control:u,render:e=>{let{field:i,fieldState:{error:l}}=e;return(0,M.jsxs)(G.Z,{error:!!l,size:"small",sx:{width:"100%",shrink:!0},children:[(0,M.jsxs)(X.Z,{shrink:!0,children:[" ",o("service types")," "]}),(0,M.jsx)(V.Z,{...i,multiple:!0,id:"multiple-days_details[".concat(n,"].appointments[").concat(t,"].service_types"),label:o("service types"),renderValue:b,children:null===a||void 0===a?void 0:a.map((e=>{var n;const t=null===i||void 0===i||null===(n=i.value)||void 0===n?void 0:n.includes(e._id);return(0,M.jsxs)(I.Z,{value:e._id,children:[(0,M.jsx)(E.Z,{size:"small",disableRipple:!0,checked:t}),d?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english]},e._id)}))}),!!l&&(0,M.jsx)(O.Z,{error:!!l,children:null===l||void 0===l?void 0:l.message})]})}}),(0,M.jsx)(Z.jb,{size:"small",InputLabelProps:{shrink:!0},name:"days_details[".concat(n,"].appointments[").concat(t,"].online_available"),label:(0,M.jsx)(v.Z,{lang:"ar",sx:{fontSize:12},children:o("online avaliable")})}),(0,M.jsx)(H.Z,{size:"small",color:"error",sx:{justifySelf:{xs:"flex-end"},alignSelf:{xs:"flex-end"},width:35},onClick:()=>(e=>{f(e),s((e=>({...e,[n]:e[n]-1})))})(t),children:(0,M.jsx)(A.Z,{icon:"solar:trash-bin-trash-bold"})})]})},e.id)))}),(0,M.jsx)(D.Z,{sx:{mt:j.days_details[n].appointments&&j.days_details[n].appointments.length>0?3:0,mb:1,borderStyle:"dashed"}}),(0,M.jsx)(c.Z,{spacing:3,direction:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"},children:(0,M.jsx)(L.Z,{size:"small",color:"primary",startIcon:(0,M.jsx)(A.Z,{icon:"tdesign:plus"}),sx:{padding:1},onClick:()=>{const e=j.days_details[n].appointments?j.days_details[n].appointments[j.days_details[n].appointments.length-1]:null,t=new Date(e?e.start_time:j.days_details[n].work_start_time);e&&t.setMinutes(t.getMinutes()+j.appointment_time);const i={appointment_type:null,start_time:null,price:null,online_available:!0,service_types:[],...e,start_time:t};y(i),s((e=>({...e,[n]:e[n]+1})))},children:d?"\u0625\u0636\u0627\u0641\u0629 \u0645\u0648\u0627\u0639\u064a\u062f \u0628\u0627\u0644\u062a\u0641\u0635\u064a\u0644":"Add Detailed Appointment"})})]})})}function B(e){var n,t;let{setErrorMsg:i,appointTime:a}=e;const{t:s}=(0,k.qM)(),{currentLang:r}=(0,k.nt)(),d="ar"===r.value,u=[{value:"saturday",label:s("Saturday")},{value:"sunday",label:s("Sunday")},{value:"Monday",label:s("Monday")},{value:"tuesday",label:s("Tuesday")},{value:"wednesday",label:s("Wednesday")},{value:"thursday",label:s("Thursday")},{value:"friday",label:s("Friday")}],{control:m,setValue:p,watch:x,resetField:h,getValues:g}=(0,l.Gc)(),[y,f]=(0,o.useState)(g());(0,o.useEffect)((()=>(x((()=>{const e=g();f(e)})),()=>{x()})),[x,g]);const{fields:j,append:S,remove:T}=(0,l.Dq)({control:m,name:"days_details"}),{user:C}=(0,b.E)(),[z,P]=(0,o.useState)({}),[F,q]=(0,o.useState)({}),{appointmenttypesData:W}=(0,w.o5)(),{serviceTypesData:Q}=(0,w.fO)(null===C||void 0===C||null===(n=C.employee)||void 0===n||null===(t=n.employee_engagements[null===C||void 0===C?void 0:C.employee.selected_engagement])||void 0===t?void 0:t.unit_service._id);function N(e,n){const t=new Date(e),i=new Date(n),l=Math.abs(i-t);return Math.floor(l/6e4)}const B=e=>{const n=null===Q||void 0===Q?void 0:Q.filter((n=>null===e||void 0===e?void 0:e.includes(null===n||void 0===n?void 0:n._id)));return null===n||void 0===n?void 0:n.map((e=>null===e||void 0===e?void 0:e.name_english)).join(", ")};function J(e){const n=y.days_details[e];if(null!==n&&void 0!==n&&n.appointments.length)return null===n||void 0===n?void 0:n.appointments.length;if(null!==n&&void 0!==n&&n.break_start_time&&null!==n&&void 0!==n&&n.break_end_time){return Math.floor(N(null===n||void 0===n?void 0:n.work_start_time,null===n||void 0===n?void 0:n.break_start_time)/y.appointment_time)+Math.floor(N(null===n||void 0===n?void 0:n.break_end_time,null===n||void 0===n?void 0:n.work_end_time)/y.appointment_time)||0}return Math.floor(N(null===n||void 0===n?void 0:n.work_start_time,null===n||void 0===n?void 0:n.work_end_time)/y.appointment_time)||0}return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(D.Z,{flexItem:!0,sx:{borderStyle:"solid"}}),(0,M.jsxs)(_.Z,{sx:{p:3},children:[(0,M.jsxs)(v.Z,{variant:"p",sx:{color:"text.secondary",mb:3,fontWeight:"700",textTransform:"capitalize"},children:[d?"\u062a\u0641\u0627\u0635\u064a\u0644 \u0627\u0644\u064a\u0648\u0645":"Days Details",":"]}),(0,M.jsx)(c.Z,{sx:{mt:3},divider:(0,M.jsx)(D.Z,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:3,children:j.map(((e,n)=>{var t,i;return(0,M.jsxs)(c.Z,{spacing:1.5,sx:{width:"100%"},children:[(0,M.jsxs)(c.Z,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:"100%",mt:2},children:[(0,M.jsxs)(c.Z,{direction:{xs:"column",md:"column"},spacing:2,sx:{width:"100%",mt:2},children:[(0,M.jsx)(Z.Cc,{disabled:!(null!==y&&void 0!==y&&null!==(t=y.weekend)&&void 0!==t&&t.includes(null===(i=y.days_details[n])||void 0===i?void 0:i.day)),InputLabelProps:{shrink:!0},size:"small",name:"days_details[".concat(n,"].day"),label:s("day"),children:u.filter((e=>{var t,i;return!(null!==y&&void 0!==y&&null!==(t=y.weekend)&&void 0!==t&&t.includes(e.value))&&!(null!==y&&void 0!==y&&null!==(i=y.days_details)&&void 0!==i&&i.some((t=>{var i;return t.day===e.value&&(null===(i=y.days_details[n])||void 0===i?void 0:i.day)!==e.value})))})).map((e=>(0,M.jsx)(I.Z,{value:e.value,children:e.label})))}),(0,M.jsx)(Z.au,{lang:"ar",disabled:!0,size:"small",name:"days_details[".concat(n,"].appointment_number"),label:s("appointments number"),InputLabelProps:{shrink:!0},value:F[n]||J(n)})]}),(0,M.jsxs)(c.Z,{direction:{xs:"column",md:"column"},spacing:2,sx:{width:"100%",mt:2},children:[(0,M.jsx)(l.Qr,{name:"days_details[".concat(n,"].work_start_time"),control:m,render:e=>{var t,i;let{field:l,fieldState:{error:a}}=e;return(0,M.jsx)(R.d,{lang:"ar",minutesStep:"5",label:s("work start time"),value:null!==(t=y.days_details[n])&&void 0!==t&&t.work_start_time?new Date(null===(i=y.days_details[n])||void 0===i?void 0:i.work_start_time):null,onChange:e=>{l.onChange(e)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!a,helperText:null===a||void 0===a?void 0:a.message}}})}}),(0,M.jsx)(l.Qr,{name:"days_details[".concat(n,"].break_start_time"),control:m,render:e=>{let{field:t,fieldState:{error:i}}=e;return(0,M.jsx)(R.d,{lang:"ar",minutesStep:"5",label:s("break start time"),value:y.days_details[n].break_start_time?new Date(y.days_details[n].break_start_time):null,onChange:e=>{t.onChange(e)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!i,helperText:null===i||void 0===i?void 0:i.message}}})}})]}),(0,M.jsxs)(c.Z,{direction:{xs:"column",md:"column"},spacing:2,sx:{width:"100%",mt:2},children:[(0,M.jsx)(l.Qr,{name:"days_details[".concat(n,"].work_end_time"),control:m,render:e=>{let{field:t,fieldState:{error:i}}=e;return(0,M.jsx)(R.d,{lang:"ar",minutesStep:"5",label:s("work end time"),value:y.days_details[n].work_end_time?new Date(y.days_details[n].work_end_time):null,onChange:e=>{t.onChange(e)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!i,helperText:null===i||void 0===i?void 0:i.message}}})}}),(0,M.jsx)(l.Qr,{name:"days_details[".concat(n,"].break_end_time"),control:m,render:e=>{let{field:t,fieldState:{error:i}}=e;return(0,M.jsx)(R.d,{lang:"ar",minutesStep:"5",label:s("break end time"),value:y.days_details[n].break_end_time?new Date(y.days_details[n].break_end_time):null,onChange:e=>{t.onChange(e)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!i,helperText:null===i||void 0===i?void 0:i.message}}})}})]}),(0,M.jsxs)(c.Z,{direction:{xs:"column",md:"column"},spacing:2,sx:{width:"100%",mt:2},children:[(0,M.jsx)(Z.Cc,{size:"small",InputLabelProps:{shrink:!0},name:"days_details[".concat(n,"].appointment_type"),label:"".concat(s("appointment type")," *"),children:null===W||void 0===W?void 0:W.map((e=>(0,M.jsx)(I.Z,{value:e._id,children:d?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english})))}),(0,M.jsx)(l.Qr,{name:"days_details[".concat(n,"].service_types"),control:m,render:e=>{let{field:t,fieldState:{error:i}}=e;return(0,M.jsxs)(G.Z,{error:!!i,size:"small",sx:{width:"100%",shrink:!0},children:[(0,M.jsxs)(X.Z,{shrink:!0,children:[" ",s("service types")," "]}),(0,M.jsx)(V.Z,{...t,multiple:!0,id:"multiple-days_details[".concat(n,"].service_types"),label:s("service types"),renderValue:B,children:null===Q||void 0===Q?void 0:Q.map((e=>{var n;const i=null===t||void 0===t||null===(n=t.value)||void 0===n?void 0:n.includes(null===e||void 0===e?void 0:e._id);return(0,M.jsxs)(I.Z,{value:e._id,children:[(0,M.jsx)(E.Z,{size:"small",disableRipple:!0,checked:i}),d?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english]},e._id)}))}),!!i&&(0,M.jsx)(O.Z,{error:!!i,children:null===i||void 0===i?void 0:i.message})]})}})]}),(0,M.jsxs)(c.Z,{direction:{xs:"column",md:"column"},spacing:.2,sx:{justifySelf:{xs:"flex-end"},alignSelf:{xs:"flex-end"}},children:[(0,M.jsx)(H.Z,{size:"small",color:"error",onClick:()=>(e=>{T(e)})(n),children:(0,M.jsx)(A.Z,{icon:"solar:trash-bin-trash-bold"})}),(0,M.jsx)(H.Z,{size:"small",onClick:()=>async function(e){const n=[];if(!a&&!y.appointment_time)return;const t=e=>{const n=new Date(e);return 60*n.getHours()+n.getMinutes()},i=(e,n)=>{const t=new Date(e);return new Date(t.getTime()-6e4*n)},l=y.days_details[e];let s=N(null===l||void 0===l?void 0:l.work_start_time,null===l||void 0===l?void 0:l.work_end_time),o=N(null===l||void 0===l?void 0:l.work_start_time,null===l||void 0===l?void 0:l.break_start_time),r=N(null===l||void 0===l?void 0:l.break_end_time,null===l||void 0===l?void 0:l.work_end_time);const d=()=>{if(s>=y.appointment_time){const a=i(null===l||void 0===l?void 0:l.work_end_time,s),o=null===l||void 0===l?void 0:l.appointments.filter((e=>t(a)===t(e.start_time)))[0];return o?n.push(o):n.push({appointment_type:(null===l||void 0===l?void 0:l.appointment_type)||null,start_time:a,price:null,online_available:!0,service_types:(null===l||void 0===l?void 0:l.service_types)||[]}),s-=y.appointment_time,new Promise((n=>{setTimeout((()=>{n(d(l,e,s))}),0)}))}return Promise.resolve()},c=()=>{if(o>=y.appointment_time){const a=i(null===l||void 0===l?void 0:l.break_start_time,o),s=null===l||void 0===l?void 0:l.appointments.filter((e=>t(a)===t(e.start_time)))[0];return s?n.push(s):n.push({appointment_type:(null===l||void 0===l?void 0:l.appointment_type)||null,start_time:a,price:null,online_available:!0,service_types:(null===l||void 0===l?void 0:l.service_types)||[]}),o-=y.appointment_time,new Promise((n=>{setTimeout((()=>{n(c(l,e,o))}),0)}))}return Promise.resolve()},u=()=>{if(r>=y.appointment_time){const a=i(null===l||void 0===l?void 0:l.work_end_time,r),s=null===l||void 0===l?void 0:l.appointments.filter((e=>t(a)===t(e.start_time)))[0];return s?n.push(s):n.push({appointment_type:(null===l||void 0===l?void 0:l.appointment_type)||null,start_time:a,price:null,online_available:!0,service_types:(null===l||void 0===l?void 0:l.service_types)||[]}),r-=y.appointment_time,new Promise((n=>{setTimeout((()=>{n(u(l,e,r))}),0)}))}return Promise.resolve()};null!==l&&void 0!==l&&l.break_start_time&&null!==l&&void 0!==l&&l.break_end_time?(await c(),await u()):await d(),q({...F,[e]:n.length}),p("days_details[".concat(e,"].appointments"),n)}(n),children:(0,M.jsx)(A.Z,{icon:"zondicons:refresh"})}),(0,M.jsx)(H.Z,{size:"small",onClick:()=>P({...z,[n]:!z[n]}),children:(0,M.jsx)(A.Z,{icon:"tabler:list-details"})})]})]}),(0,M.jsx)(U,{setAppointmentsNum:q,serviceTypesData:Q,appointmenttypesData:W,open:z[n],ParentIndex:n})]},null===e||void 0===e?void 0:e.id)}))}),(0,M.jsx)(D.Z,{sx:{mt:3,mb:1,borderStyle:"dashed"}}),(0,M.jsx)(c.Z,{spacing:3,direction:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"},children:(0,M.jsx)(L.Z,{size:"small",color:"primary",startIcon:(0,M.jsx)(A.Z,{icon:"tdesign:plus"}),sx:{padding:1},onClick:()=>{try{var e;const n=null===(e=u.filter((e=>{var n;return!(null!==y&&void 0!==y&&null!==(n=y.weekend)&&void 0!==n&&n.includes(e.value))&&!y.days_details.some((n=>n.day===e.value))}))[0])||void 0===e?void 0:e.value;if(!n)throw Error("No valid date to create");const t={day:"",work_start_time:null,work_end_time:null,break_start_time:null,break_end_time:null,appointments:[],service_types:[],appointment_type:null},i=y.days_details?y.days_details[y.days_details.length-1]:"",l={...t,...i,day:n,appointments:[]};S(l)}catch(n){i(n.message),window.scrollTo({top:0,behavior:"smooth"})}},children:d?"\u0625\u0636\u0627\u0641\u0629 \u064a\u0648\u0645 \u062c\u062f\u064a\u062f":"add new day"})})]})]})}function J(){const{t:e}=(0,k.qM)(),{currentLang:n}=(0,k.nt)(),t="ar"===n.value,{control:i,setValue:a,watch:s,resetField:o,getValues:r}=(0,l.Gc)(),{fields:d,append:u,remove:m}=(0,l.Dq)({control:i,name:"long_holidays"}),p=r();return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(D.Z,{flexItem:!0,sx:{borderStyle:"solid"}}),(0,M.jsxs)(_.Z,{sx:{p:3},children:[(0,M.jsxs)(v.Z,{variant:"p",sx:{color:"text.secondary",mb:3,fontWeight:"700",textTransform:"capitalize"},children:[t?"\u0639\u0637\u0644 \u0637\u0648\u064a\u0644\u0629":"Long Holidays",":"]}),(0,M.jsx)(c.Z,{sx:{mt:3},divider:(0,M.jsx)(D.Z,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:3,children:d.map(((n,t)=>(0,M.jsx)(c.Z,{alignItems:"flex-start",spacing:1.5,sx:{width:{xs:"100%",md:"auto"}},children:(0,M.jsxs)(c.Z,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:{xs:"100%",md:"auto"}},children:[(0,M.jsx)(Z.au,{lang:"ar",size:"small",name:"long_holidays[".concat(t,"].description"),label:e("description")}),(0,M.jsx)(l.Qr,{name:"long_holidays[".concat(t,"].start_date"),control:i,render:n=>{let{field:i,fieldState:{error:l}}=n;return(0,M.jsx)(q.M,{label:e("start date"),value:new Date(p.long_holidays[t].start_date?p.long_holidays[t].start_date:""),onChange:e=>{i.onChange(e)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!l,helperText:null===l||void 0===l?void 0:l.message}}})}}),(0,M.jsx)(l.Qr,{name:"long_holidays[".concat(t,"].end_date"),control:i,render:n=>{let{field:i,fieldState:{error:l}}=n;return(0,M.jsx)(q.M,{label:e("end date"),value:new Date(p.long_holidays[t].end_date?p.long_holidays[t].end_date:""),onChange:e=>{i.onChange(e)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!l,helperText:null===l||void 0===l?void 0:l.message}}})}}),(0,M.jsx)(H.Z,{size:"small",color:"error",sx:{justifySelf:"flex-end",alignSelf:"flex-end",width:35},onClick:()=>(e=>{m(e)})(t),children:(0,M.jsx)(A.Z,{icon:"solar:trash-bin-trash-bold"})})]})},n.id)))}),(0,M.jsx)(D.Z,{sx:{mt:3,mb:1,borderStyle:"dashed"}}),(0,M.jsx)(c.Z,{spacing:1,direction:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"},children:(0,M.jsx)(L.Z,{size:"small",color:"primary",startIcon:(0,M.jsx)(A.Z,{icon:"tdesign:plus"}),sx:{padding:1},onClick:()=>{u({start_date:null,end_date:null,description:""})},children:t?"\u0625\u0636\u0627\u0641\u0629 \u0639\u0637\u0644 \u0637\u0648\u064a\u0644\u0629":"add long holiday"})})]})]})}function K(e){let{appointmentConfigData:n,refetch:t,loading:a}=e;const z=(0,g.tv)(),{t:D}=(0,k.qM)(),{currentLang:I}=(0,k.nt)(),P="ar"===I.value,{id:F}=(0,g.UO)(),{user:q}=(0,b.E)(),L=(0,w.X7)(F).data,[H,A]=(0,o.useState)(0),[V,E]=(0,o.useState)(),[X,G]=(0,o.useState)([]),{enqueueSnackbar:O}=(0,S.Ds)(),R=((0,T.K$)(),(0,y.k)(!1)),N=(0,y.k)(!1),U=(0,y.k)(),K=(0,y.k)(),$=i.Ry().shape({weekend:i.IX(),start_date:i.hT().nullable(),end_date:i.hT().nullable(),appointment_time:i.Rx().required("Appointment Time is required").min(5,"Appointment Time must be at least 5").max(180,"Appointment Time must be at most 180"),config_frequency:i.Rx().required("Configuration Frequency is required").min(1,"must be at least 1").max(360,"must be at most 360"),holidays:i.IX(),long_holidays:i.IX(),work_group:i.Z_().required("Work Group is required"),work_shift:i.Z_().required("Work Shift is required"),days_details:i.IX().of(i.Ry().shape({day:i.Z_().required("Day is required"),work_start_time:i.hT().required("work start time is required"),work_end_time:i.hT().required("work end time is required").when("work_start_time",((e,n)=>e&&n.min(e,"Work End Time must be after Work Start Time"))),appointments:i.IX(),service_types:i.IX(),appointment_type:i.Z_().nullable()}))}),Y=(0,o.useMemo)((()=>{var e,t,i,l,a,s,o,r;return{unit_service:(null===n||void 0===n?void 0:n.unit_service._id)||(null===q||void 0===q||null===(e=q.employee)||void 0===e||null===(t=e.employee_engagements[null===q||void 0===q?void 0:q.employee.selected_engagement])||void 0===t?void 0:t.unit_service._id),department:(null===L||void 0===L||null===(i=L.department)||void 0===i?void 0:i._id)||(null===q||void 0===q||null===(l=q.employee)||void 0===l||null===(a=l.employee_engagements[null===q||void 0===q?void 0:q.employee.selected_engagement])||void 0===a||null===(s=a.department)||void 0===s?void 0:s._id),start_date:(null===n||void 0===n?void 0:n.start_date)||null,end_date:(null===n||void 0===n?void 0:n.end_date)||null,weekend:(null===n||void 0===n?void 0:n.weekend)||[],appointment_time:(null===n||void 0===n?void 0:n.appointment_time)||null,config_frequency:(null===n||void 0===n?void 0:n.config_frequency)||null,holidays:(null===n||void 0===n?void 0:n.holidays)||[{description:"",date:null}],long_holidays:(null===n||void 0===n?void 0:n.long_holidays)||[{description:"",start_date:null,end_date:null}],work_group:(null===n||void 0===n||null===(o=n.work_group)||void 0===o?void 0:o._id)||null,work_shift:(null===n||void 0===n||null===(r=n.work_shift)||void 0===r?void 0:r._id)||null,days_details:(null===n||void 0===n?void 0:n.days_details)||[]}}),[n,null===q||void 0===q?void 0:q.employee,null===L||void 0===L?void 0:L.department]),ee=(0,l.cI)({mode:"onTouched",resolver:(0,r.X)($),defaultValues:Y}),{reset:ne,handleSubmit:te,formState:{isSubmitting:ie,errors:le}}=ee,ae=te((async e=>{K.onTrue();const t=new Date,i=new Date(t.getTime()+24*e.config_frequency*60*60*1e3);try{n?!e.start_date&&!e.end_date||new Date(e.end_date)>t&&(new Date(e.start_date)<=t||new Date(e.start_date)<i)?(G(e),U.onTrue()):(await f.ZP.patch("".concat(f.Hv.tables.appointmentconfigs,"/").concat(null===n||void 0===n?void 0:n._id),e),j.Z.emit("updated",{data:e,user:q,link:h.H.unitservice.employees.appointmentconfig.root(F),msg:"updated an appointment configuration ".concat(n.code)}),z.push(h.H.unitservice.employees.appointmentconfig.root(F))):(N.onTrue(),await f.ZP.post(f.Hv.tables.appointmentconfigs,e),j.Z.emit("created",{data:e,user:q,link:h.H.unitservice.employees.appointmentconfig.root(F),msg:"created an appointment config <strong>".concat(e.name_english,"</strong>")}),N.onFalse(),O(D("added successfully!")),z.push(h.H.unitservice.employees.appointmentconfig.root(F))),K.onFalse(),console.info("DATA",JSON.stringify(e,null,2))}catch(l){E("string"===typeof l?l:l.message),window.scrollTo({top:0,behavior:"smooth"}),j.Z.emit("error",{error:l,user:q,location:window.location.pathname}),N.onFalse(),K.onFalse(),O("string"===typeof l?l:l.message,{variant:"error"}),console.error(l)}}));return(0,o.useEffect)((()=>{Object.keys(le).length&&(E(Object.keys(le).map((e=>{var n;return null===le||void 0===le||null===(n=le[e])||void 0===n?void 0:n.message})).join("<br>")),window.scrollTo({top:0,behavior:"smooth"}))}),[le]),console.log("errorMsg",V),(0,o.useEffect)((()=>{var e,t,i,l,a,s,o;n&&ee.reset({unit_service:(null===n||void 0===n?void 0:n.unit_service)||(null===q||void 0===q||null===(e=q.employee)||void 0===e||null===(t=e.employee_engagements[null===q||void 0===q?void 0:q.employee.selected_engagement])||void 0===t?void 0:t.unit_service._id),department:(null===L||void 0===L||null===(i=L.department)||void 0===i?void 0:i._id)||(null===q||void 0===q||null===(l=q.employee.employee_engagements[null===q||void 0===q?void 0:q.employee.selected_engagement])||void 0===l||null===(a=l.department)||void 0===a?void 0:a._id),start_date:(null===n||void 0===n?void 0:n.start_date)||null,end_date:(null===n||void 0===n?void 0:n.end_date)||null,weekend:(null===n||void 0===n?void 0:n.weekend)||[],appointment_time:(null===n||void 0===n?void 0:n.appointment_time)||null,config_frequency:(null===n||void 0===n?void 0:n.config_frequency)||null,holidays:(null===n||void 0===n?void 0:n.holidays)||[{description:"",date:null}],long_holidays:(null===n||void 0===n?void 0:n.long_holidays)||[{description:"",start_date:null,end_date:null}],work_group:(null===(s=n.work_group)||void 0===s?void 0:s._id)||null,work_shift:(null===(o=n.work_shift)||void 0===o?void 0:o._id)||null,days_details:n.days_details||[{day:"",work_start_time:null,work_end_time:null,break_start_time:null,break_end_time:null,appointments:[]}]})}),[n,ee,q,null===L||void 0===L?void 0:L.department]),(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(u.Z,{maxWidth:"lg",children:(0,M.jsxs)(Z.ZP,{methods:ee,children:[!a&&(0,M.jsxs)(d.Z,{children:[!!V&&(0,M.jsx)(p.Z,{sx:{borderRadius:0},severity:"error",children:(0,M.jsxs)("div",{children:[" ",V," "]})}),(0,M.jsx)(W,{setAppointTime:A,appointmentConfigData:n}),(0,M.jsx)(B,{setErrorMsg:E,appointTime:H}),(0,M.jsx)(Q,{}),(0,M.jsx)(J,{})]}),(0,M.jsx)(c.Z,{justifyContent:"flex-end",direction:"row",spacing:2,sx:{mt:3},children:(0,M.jsx)(m.Z,{variant:"contained",loading:ie||R.value||N.value,onClick:ae,children:D("save")})})]})}),(0,M.jsx)(C.Q,{disabled:N.value,open:N.value||U.value,onClose:U.onFalse,title:N.value?"Creating appointments...":"Do you want to change your existance appointments?",content:N.value?(0,M.jsx)(M.Fragment,{children:(0,M.jsx)(s(),{options:{strings:["It might take several minutes..","We are getting appointments ready..","We are almost done.."],autoStart:!0,loop:!0,deleteSpeed:5,cursor:"",delay:20}})}):(0,M.jsxs)(M.Fragment,{children:[P?(0,M.jsxs)(v.Z,{variant:"body2",component:"p",sx:{mt:1,color:"text.disabled"},children:["\u0627\u0636\u063a\u0637 ",(0,M.jsx)("strong",{children:" \u0646\u0639\u0645 "})," \u0644\u062a\u063a\u064a\u064a\u0631 \u0627\u0644\u0645\u0648\u0627\u0639\u064a\u062f \u0627\u0644\u0645\u0646\u0634\u0623\u0629"]}):(0,M.jsxs)(v.Z,{variant:"body2",component:"p",sx:{mt:1,color:"text.disabled"},children:["press",(0,M.jsx)("strong",{children:" yes"})," to change existance appointments"]}),P?(0,M.jsxs)(v.Z,{variant:"body2",component:"p",sx:{mt:1,color:"text.disabled"},children:["\u0627\u0636\u063a\u0637 ",(0,M.jsx)("strong",{children:" \u0644\u0627 "})," \u0644\u062d\u0641\u0638 \u0627\u0644\u0627\u0639\u062f\u0627\u062f\u0627\u062a \u0644\u0644\u0628\u062f\u0621 \u0645\u0646 \u0627\u0644\u0645\u0648\u0627\u0639\u064a\u062f \u0627\u0644\u062a\u064a \u064a\u0631\u0627\u062f \u0625\u0646\u0634\u0627\u0626\u0647\u0627"]}):(0,M.jsxs)(v.Z,{variant:"body2",component:"p",sx:{mt:1,color:"text.disabled"},children:["press",(0,M.jsx)("strong",{children:" No"})," to start changing when creating new appointments"]})]}),action:(0,M.jsxs)(M.Fragment,{children:[N.value&&(0,M.jsx)(_.Z,{height:"40",sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,M.jsx)(x.Z,{size:24,color:"primary"})}),!N.value&&(0,M.jsx)(m.Z,{variant:"contained",loading:N.value,color:"warning",onClick:async()=>{N.onTrue();try{await f.ZP.patch("".concat(f.Hv.tables.appointmentconfigs,"/").concat(null===n||void 0===n?void 0:n._id),{...X,ImmediateEdit:!0}),j.Z.emit("updated",{user:q,link:h.H.unitservice.employees.appointmentconfig.root(F),msg:"updated an appointment configuration <strong>[ ".concat(n.code," ]</strong>")}),N.onFalse(),U.onFalse(),O(D("Updated successfully!")),z.push(h.H.unitservice.employees.appointmentconfig.root(F))}catch(e){E("string"===typeof e?e:e.message),window.scrollTo({top:0,behavior:"smooth"}),j.Z.emit("error",{error:e,user:q,location:window.location.pathname}),N.onFalse(),U.onFalse(),O("string"===typeof e?e:e.message,{variant:"error"}),console.error(e)}},children:D("yes")}),!N.value&&(0,M.jsx)(m.Z,{disabled:N.value,loading:R.value,variant:"contained",color:"success",onClick:async()=>{R.onTrue();try{await f.ZP.patch("".concat(f.Hv.tables.appointmentconfigs,"/").concat(null===n||void 0===n?void 0:n._id),{...X,ImmediateEdit:!1}),j.Z.emit("updated",{user:q,link:h.H.unitservice.employees.appointmentconfig.root(F),msg:"updated an appointment configuration <strong>[ ".concat(n.code," ]</strong>")}),O(D("updated successfully!")),R.onFalse(),U.onFalse(),z.push(h.H.unitservice.employees.appointmentconfig.root(F))}catch(e){j.Z.emit("error",{error:e,user:q,location:window.location.pathname}),E("string"===typeof e?e:e.message),window.scrollTo({top:0,behavior:"smooth"}),R.onFalse(),U.onFalse(),O("string"===typeof e?e:e.message,{variant:"error"}),console.error(e)}},children:D("no")})]})})]})}}}]);
//# sourceMappingURL=5401.418b926b.chunk.js.map