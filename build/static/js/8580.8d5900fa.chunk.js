(self.webpackChunk_minimal_kit_cra_js=self.webpackChunk_minimal_kit_cra_js||[]).push([[8580],{28580:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>K});var n=i(6907),s=i(27031),o=i(8007),l=i(72791),a=i(61134),r=i(44695),c=i(57621),d=i(53767),u=i(12258),x=i(38072),m=i(19208),h=i(22459),p=i(59493),v=i(87151),j=i.n(v),b=i(16029),g=i(13838),Z=i(94721),y=i(82626),f=i(4567),w=i(63466),C=i(55891),_=i(17070),k=i(40268),I=i(66630),S=i(8976),q=i(81164),D=i(80184);function T(){var e,t,i,n;const{currentLang:s}=(0,q.nt)(),{user:o}=(s.value,(0,S.E)()),{serviceTypesData:r}=(0,I.UL2)(null===o||void 0===o||null===(e=o.employee)||void 0===e||null===(t=e.employee_engagements)||void 0===t||null===(i=t[o.employee.selected_engagement])||void 0===i||null===(n=i.unit_service)||void 0===n?void 0:n._id),{control:c,setValue:u,watch:x,resetField:m}=(0,a.Gc)(),{fields:h,append:v,remove:T}=(0,a.Dq)({control:c,name:"items"}),A=x(),F=A.items.map((e=>e.total)),P=j()(F),z=P*((100-A.taxes)/100)-A.discount;(0,l.useEffect)((()=>{u("totalAmount",z)}),[u,z]);(0,l.useCallback)((e=>{m("items[".concat(e,"].quantity")),m("items[".concat(e,"].price")),m("items[".concat(e,"].subtotal")),m("items[".concat(e,"].tax")),m("items[".concat(e,"].total"))}),[m]);const N=(0,l.useCallback)(((e,t)=>{var i;const n=null===r||void 0===r?void 0:r.find((e=>e._id===t));u("items[".concat(e,"].price"),null===n||void 0===n?void 0:n.Price_per_unit),u("items[".concat(e,"].subtotal"),A.items.map((e=>e.quantity*e.price))[e]),u("items[".concat(e,"].tax"),(null===n||void 0===n||null===(i=n.tax)||void 0===i?void 0:i.percentage)||0),u("items[".concat(e,"].total"),A.items.map((e=>e.subtotal*((100-e.tax)/100)))[e])}),[u,A.items,r]),W=(0,l.useCallback)(((e,t)=>{u("items[".concat(t,"].quantity"),Number(e.target.value)),u("items[".concat(t,"].subtotal"),A.items.map((e=>e.quantity*e.price))[t]),u("items[".concat(t,"].total"),A.items.map((e=>e.subtotal*((100-e.tax)/100)))[t])}),[u,A.items]),L=(0,l.useCallback)(((e,t)=>{u("items[".concat(t,"].price"),Number(e.target.value)),u("items[".concat(t,"].subtotal"),A.items.map((e=>e.quantity*e.price))[t]),u("items[".concat(t,"].total"),A.items.map((e=>e.subtotal*((100-e.tax)/100)))[t])}),[u,A.items]),R=(0,D.jsxs)(d.Z,{spacing:2,alignItems:"flex-end",sx:{mt:3,textAlign:"right",typography:"body2"},children:[(0,D.jsxs)(d.Z,{direction:"row",children:[(0,D.jsx)(b.Z,{sx:{color:"text.secondary"},children:"Subtotal"}),(0,D.jsx)(b.Z,{sx:{width:160,typography:"subtitle2"},children:(0,_.e_)(P)||"-"})]}),(0,D.jsxs)(d.Z,{direction:"row",children:[(0,D.jsx)(b.Z,{sx:{color:"text.secondary"},children:"Discount"}),(0,D.jsx)(b.Z,{sx:{width:160,...A.discount&&{color:"error.main"}},children:A.discount?"- ".concat((0,_.e_)(A.discount)):"-"})]}),(0,D.jsxs)(d.Z,{direction:"row",children:[(0,D.jsx)(b.Z,{sx:{color:"text.secondary"},children:"Taxes"}),(0,D.jsx)(b.Z,{sx:{width:160,...A.taxes&&{color:"error.main"}},children:A.taxes?"- ".concat((0,_.e_)(P*(A.taxes/100))):"-"})]}),(0,D.jsxs)(d.Z,{direction:"row",sx:{typography:"subtitle1"},children:[(0,D.jsx)(b.Z,{children:"Total"}),(0,D.jsx)(b.Z,{sx:{width:160},children:(0,_.e_)(z)||"-"})]})]});return(0,D.jsxs)(b.Z,{sx:{p:3},children:[(0,D.jsx)(f.Z,{variant:"h6",sx:{color:"text.disabled",mb:3},children:"Details:"}),(0,D.jsx)(d.Z,{divider:(0,D.jsx)(Z.Z,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:2,children:h.map(((e,t)=>(0,D.jsx)(d.Z,{alignItems:"flex-end",spacing:1.5,children:(0,D.jsxs)(d.Z,{direction:{xs:"column",md:"row"},justifyContent:"center",spacing:2,sx:{width:1},children:[(0,D.jsx)(p.Cc,{name:"items[".concat(t,"].service"),size:"small",label:"Service",sx:{maxWidth:"450px"},InputLabelProps:{shrink:!0},children:null===r||void 0===r?void 0:r.map((e=>(0,D.jsx)(y.Z,{value:e._id,onClick:()=>N(t,e._id),children:e.name_english},e._id)))}),(0,D.jsx)(p.au,{size:"small",type:"number",name:"items[".concat(t,"].quantity"),label:"Quantity",placeholder:"0",onChange:e=>W(e,t),InputLabelProps:{shrink:!0},sx:{maxWidth:{md:150}}}),(0,D.jsx)(p.au,{size:"small",type:"number",name:"items[".concat(t,"].price"),label:"Price",placeholder:"0.00",onChange:e=>L(e,t),InputProps:{startAdornment:(0,D.jsx)(w.Z,{position:"start",children:(0,D.jsx)(b.Z,{sx:{typography:"subtitle2",color:"text.disabled"},children:"$"})})},sx:{maxWidth:{md:150}}}),(0,D.jsx)(p.au,{disabled:!0,size:"small",type:"number",name:"items[".concat(t,"].subtotal"),label:"Subtotal",placeholder:"0.00",value:0===A.items[t].subtotal?"":A.items[t].subtotal.toFixed(2),onChange:e=>L(e,t),InputProps:{startAdornment:(0,D.jsx)(w.Z,{position:"start",children:(0,D.jsx)(b.Z,{sx:{typography:"subtitle2",color:"text.disabled"},children:"$"})})},sx:{maxWidth:{md:150},["& .".concat(C.Z.input)]:{textAlign:{md:"right"}}}}),(0,D.jsx)(p.au,{disabled:!0,size:"small",type:"number",name:"items[".concat(t,"].tax"),label:"tax",placeholder:"00",InputProps:{startAdornment:(0,D.jsx)(w.Z,{position:"start",children:(0,D.jsx)(b.Z,{sx:{typography:"subtitle2",color:"text.disabled"},children:"%"})})},sx:{maxWidth:{md:150},["& .".concat(C.Z.input)]:{textAlign:{md:"right"}}}}),(0,D.jsx)(p.au,{disabled:!0,size:"small",type:"number",name:"items[".concat(t,"].total"),label:"Total",placeholder:"0.00",value:0===A.items[t].total?"":A.items[t].total.toFixed(2),InputProps:{startAdornment:(0,D.jsx)(w.Z,{position:"start",children:(0,D.jsx)(b.Z,{sx:{typography:"subtitle2",color:"text.disabled"},children:"$"})})},sx:{maxWidth:{md:150},["& .".concat(C.Z.input)]:{textAlign:{md:"right"}}}}),(0,D.jsx)(g.Z,{size:"small",color:"error",startIcon:(0,D.jsx)(k.Z,{icon:"solar:trash-bin-trash-bold"}),onClick:()=>(e=>{T(e)})(t),children:"Remove"})]})},e.id)))}),(0,D.jsx)(Z.Z,{sx:{my:3,borderStyle:"dashed"}}),(0,D.jsxs)(d.Z,{spacing:3,direction:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"},children:[(0,D.jsx)(g.Z,{size:"small",color:"primary",startIcon:(0,D.jsx)(k.Z,{icon:"mingcute:add-line"}),onClick:()=>{v({service:null,quantity:1,price:0,subtotal:0,tax:0,total:0})},sx:{flexShrink:0},children:"Add Item"}),(0,D.jsxs)(d.Z,{spacing:2,justifyContent:"flex-end",direction:{xs:"column",md:"row"},sx:{width:1},children:[(0,D.jsx)(p.au,{size:"small",label:"Discount",name:"discount",type:"number",sx:{maxWidth:{md:120}}}),(0,D.jsx)(p.au,{size:"small",label:"Taxes (%)",name:"taxes",type:"number",sx:{maxWidth:{md:120}}})]})]}),R]})}var A=i(13400),F=i(38887),P=i(84954);var z=i(5574),N=i(48550),W=i(76278),L=i(34065),R=i(72043);function G(e){let{title:t="Address Book",list:i,action:n,open:s,onClose:o,selected:a,onSelect:r}=e;const[c,u]=(0,l.useState)(""),x=function(e){let{inputData:t,query:i}=e;if(i)return t.filter((e=>-1!==e.name.toLowerCase().indexOf(i.toLowerCase())||-1!==e.fullAddress.toLowerCase().indexOf(i.toLowerCase())||-1!=="".concat(e.company).toLowerCase().indexOf(i.toLowerCase())));return t}({inputData:i,query:c}),m=!(null!==x&&void 0!==x&&x.length)&&!!c,h=(0,l.useCallback)((e=>{u(e.target.value)}),[]),p=(0,l.useCallback)((e=>{r(e),u(""),o()}),[o,r]),v=(0,D.jsx)(d.Z,{spacing:.5,sx:{p:.5,maxHeight:640,overflowX:"hidden"},children:null===x||void 0===x?void 0:x.map((e=>(0,D.jsxs)(d.Z,{spacing:.5,component:W.Z,selected:a("".concat(e.id)),onClick:()=>p(e),sx:{py:1,px:1.5,borderRadius:1,flexDirection:"column",alignItems:"flex-start",["&.".concat(L.Z.selected)]:{bgcolor:"action.selected","&:hover":{bgcolor:"action.selected"}}},children:[(0,D.jsxs)(d.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,D.jsx)(f.Z,{variant:"subtitle2",children:e.name}),e.primary&&(0,D.jsx)(P.Z,{color:"info",children:"Default"})]}),e.company&&(0,D.jsx)(b.Z,{sx:{color:"primary.main",typography:"caption"},children:e.company}),(0,D.jsx)(f.Z,{variant:"body2",sx:{color:"text.secondary"},children:e.fullAddress}),e.phoneNumber&&(0,D.jsx)(f.Z,{variant:"body2",sx:{color:"text.secondary"},children:e.phoneNumber})]},e.id)))});return(0,D.jsxs)(z.Z,{fullWidth:!0,maxWidth:"xs",open:s,onClose:o,children:[(0,D.jsxs)(d.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{p:3,pr:1.5},children:[(0,D.jsxs)(f.Z,{variant:"h6",children:[" ",t," "]}),n&&n]}),(0,D.jsx)(d.Z,{sx:{p:2,pt:0},children:(0,D.jsx)(N.Z,{value:c,onChange:h,placeholder:"Search...",InputProps:{startAdornment:(0,D.jsx)(w.Z,{position:"start",children:(0,D.jsx)(k.Z,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})}),m?(0,D.jsx)(R.Z,{query:c,sx:{px:3,pt:5,pb:10}}):v]})}function O(){var e,t;const{watch:i,setValue:n,formState:{errors:s}}=(0,a.Gc)(),{user:o}=(0,S.E)(),l=null===o||void 0===o||null===(e=o.employee)||void 0===e||null===(t=e.employee_engagements[null===o||void 0===o?void 0:o.employee.selected_engagement])||void 0===t?void 0:t.unit_service,r=(0,F.F)("up","md"),c=i(),{invoiceFrom:u,invoiceTo:x}=c,m=(0,h.k)(),p=(0,h.k)();return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)(d.Z,{spacing:{xs:3,md:5},direction:{xs:"column",md:"row"},divider:(0,D.jsx)(Z.Z,{flexItem:!0,orientation:r?"vertical":"horizontal",sx:{borderStyle:"dashed"}}),sx:{p:3},children:[(0,D.jsxs)(d.Z,{sx:{width:1},children:[(0,D.jsxs)(d.Z,{direction:"row",alignItems:"center",sx:{mb:1},children:[(0,D.jsx)(f.Z,{variant:"h6",sx:{color:"text.disabled",flexGrow:1},children:"From:"}),(0,D.jsx)(A.Z,{onClick:m.onTrue,children:(0,D.jsx)(k.Z,{icon:"solar:pen-bold"})})]}),(0,D.jsxs)(d.Z,{spacing:1,children:[(0,D.jsx)(f.Z,{variant:"subtitle2",children:null===u||void 0===u?void 0:u.name}),(0,D.jsx)(f.Z,{variant:"body2",children:null===u||void 0===u?void 0:u.fullAddress}),(0,D.jsxs)(f.Z,{variant:"body2",children:[" ",null===u||void 0===u?void 0:u.phoneNumber]})]})]}),(0,D.jsxs)(d.Z,{sx:{width:1},children:[(0,D.jsx)(d.Z,{direction:"row",alignItems:"center",sx:{mb:1},children:(0,D.jsx)(f.Z,{variant:"h6",sx:{color:"text.disabled",flexGrow:1},children:"To:"})}),(0,D.jsxs)(d.Z,{spacing:1,children:[(0,D.jsx)(f.Z,{variant:"subtitle2",children:(null===x||void 0===x?void 0:x.name_english)||l.name_english}),(0,D.jsx)(f.Z,{variant:"body2",children:(null===x||void 0===x?void 0:x.address)||l.address}),(0,D.jsxs)(f.Z,{variant:"body2",children:[" ",(null===x||void 0===x?void 0:x.phone)||l.phone]})]})]})]}),(0,D.jsx)(G,{title:"Customers",open:m.value,onClose:m.onFalse,selected:e=>(null===u||void 0===u?void 0:u.id)===e,onSelect:e=>n("invoiceFrom",e),action:(0,D.jsx)(g.Z,{size:"small",startIcon:(0,D.jsx)(k.Z,{icon:"mingcute:add-line"}),sx:{alignSelf:"flex-end"},children:"New"})}),(0,D.jsx)(G,{title:"Customers",open:p.value,onClose:p.onFalse,selected:e=>(null===x||void 0===x?void 0:x.id)===e,onSelect:e=>n("invoiceTo",e),action:(0,D.jsx)(g.Z,{size:"small",startIcon:(0,D.jsx)(k.Z,{icon:"mingcute:add-line"}),sx:{alignSelf:"flex-end"},children:"New"})})]})}var Q=i(17003);function V(){const{control:e,watch:t}=(0,a.Gc)(),i=t();return(0,D.jsxs)(d.Z,{spacing:2,direction:{xs:"column",sm:"row"},sx:{p:3,bgcolor:"background.neutral"},children:[(0,D.jsx)(p.au,{disabled:!0,name:"invoiceNumber",label:"Invoice number",value:i.invoiceNumber}),(0,D.jsx)(p.Cc,{fullWidth:!0,name:"status",label:"Status",InputLabelProps:{shrink:!0},PaperPropsSx:{textTransform:"capitalize"},children:["paid","pending","overdue","draft"].map((e=>(0,D.jsx)(y.Z,{value:e,children:e},e)))}),(0,D.jsx)(a.Qr,{name:"createDate",control:e,render:e=>{let{field:t,fieldState:{error:i}}=e;return(0,D.jsx)(Q.M,{label:"Date create",value:t.value,onChange:e=>{t.onChange(e)},slotProps:{textField:{fullWidth:!0,error:!!i,helperText:null===i||void 0===i?void 0:i.message}}})}}),(0,D.jsx)(a.Qr,{name:"dueDate",control:e,render:e=>{let{field:t,fieldState:{error:i}}=e;return(0,D.jsx)(Q.M,{label:"Due date",value:t.value,onChange:e=>{t.onChange(e)},slotProps:{textField:{fullWidth:!0,error:!!i,helperText:null===i||void 0===i?void 0:i.message}}})}})]})}function E(e){let{currentInvoice:t}=e;const i=(0,m.tv)(),n=(0,h.k)(),s=(0,h.k)(),v=o.Ry().shape({invoiceTo:o.nK().nullable().required("Invoice to is required"),createDate:o.nK().nullable().required("Create date is required"),dueDate:o.nK().required("Due date is required").test("date-min","Due date must be later than create date",((e,t)=>{let{parent:i}=t;return e.getTime()>i.createDate.getTime()})),items:o.Vo((()=>o.IX().of(o.Ry({title:o.Z_().required("Title is required"),service:o.Z_().required("Service is required"),quantity:o.Rx().required("Quantity is required").min(1,"Quantity must be more than 0")})))),taxes:o.Rx(),status:o.Z_(),discount:o.Rx(),shipping:o.Rx(),invoiceFrom:o.nK(),totalAmount:o.Rx(),invoiceNumber:o.Z_()}),j=(0,l.useMemo)((()=>({invoiceNumber:(null===t||void 0===t?void 0:t.invoiceNumber)||"INV-1990",createDate:(null===t||void 0===t?void 0:t.createDate)||new Date,dueDate:(null===t||void 0===t?void 0:t.dueDate)||null,taxes:(null===t||void 0===t?void 0:t.taxes)||0,shipping:(null===t||void 0===t?void 0:t.shipping)||0,status:(null===t||void 0===t?void 0:t.status)||"draft",discount:(null===t||void 0===t?void 0:t.discount)||0,invoiceFrom:(null===t||void 0===t?void 0:t.invoiceFrom)||"",invoiceTo:(null===t||void 0===t?void 0:t.invoiceTo)||null,items:(null===t||void 0===t?void 0:t.items)||[{service:null,quantity:1,price:0,subtotal:0,tax:0,total:0}],totalAmount:(null===t||void 0===t?void 0:t.totalAmount)||0})),[t]),b=(0,a.cI)({resolver:(0,r.X)(v),defaultValues:j}),{reset:g,handleSubmit:Z,formState:{isSubmitting:y}}=b,f=Z((async e=>{n.onTrue();try{await new Promise((e=>setTimeout(e,500))),g(),n.onFalse(),i.push(x.H.dashboard.invoice.root),console.info("DATA",JSON.stringify(e,null,2))}catch(t){console.error(t),n.onFalse()}})),w=Z((async e=>{s.onTrue();try{await new Promise((e=>setTimeout(e,500))),g(),s.onFalse(),i.push(x.H.dashboard.invoice.root),console.info("DATA",JSON.stringify(e,null,2))}catch(t){console.error(t),s.onFalse()}}));return(0,D.jsxs)(p.ZP,{methods:b,children:[(0,D.jsxs)(c.Z,{children:[(0,D.jsx)(O,{}),(0,D.jsx)(V,{}),(0,D.jsx)(T,{})]}),(0,D.jsxs)(d.Z,{justifyContent:"flex-end",direction:"row",spacing:2,sx:{mt:3},children:[(0,D.jsx)(u.Z,{color:"inherit",size:"large",variant:"outlined",loading:n.value&&y,onClick:f,children:"Save as Draft"}),(0,D.jsxs)(u.Z,{size:"large",variant:"contained",loading:s.value&&y,onClick:w,children:[t?"Update":"Create"," & Send"]})]})]})}function K(){return(0,D.jsxs)(s.Z,{category:"work_group",subcategory:"entrance_management",acl:"read",children:[(0,D.jsxs)(n.ql,{children:[(0,D.jsx)("title",{children:"Entrance Management Accounting"}),(0,D.jsx)("meta",{name:"description",content:"meta"})]}),(0,D.jsx)(E,{})]})}},58645:e=>{e.exports=function(e,t){for(var i,n=-1,s=e.length;++n<s;){var o=t(e[n]);void 0!==o&&(i=void 0===i?o:i+o)}return i}},87151:(e,t,i)=>{var n=i(58645),s=i(2100);e.exports=function(e){return e&&e.length?n(e,s):0}}}]);
//# sourceMappingURL=8580.8d5900fa.chunk.js.map