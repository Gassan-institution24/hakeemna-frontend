"use strict";(self.webpackChunk_minimal_kit_cra_js=self.webpackChunk_minimal_kit_cra_js||[]).push([[5401],{85401:(e,n,t)=>{t.d(n,{Z:()=>U});var l=t(8007),i=t(61134),o=t(6165),a=t.n(o),s=t(72791),d=t(44695),r=t(57621),m=t(36314),c=t(89164),u=t(12258),p=t(63515),v=t(4567),_=t(68870),x=t(13239),g=t(38072),y=t(19208),h=t(22459),f=t(66664),j=t(99116),b=t(8976),Z=t(66833),w=t(76932),k=t(26405),T=t(32869),S=t(77008),z=t(39454),I=t(94721),C=t(82626),D=t(63466),F=t(17003),q=t(30250),P=t(80184);function W(e){var n,t,l,o,a;let{appointmentConfigData:s,setAppointTime:d}=e;const{t:r}=(0,w.qM)(),{currentLang:c}=(0,w.nt)(),u="ar"===c.value,p=[{value:"saturday",label:r("Saturday")},{value:"sunday",label:r("Sunday")},{value:"monday",label:r("Monday")},{value:"tuesday",label:r("Tuesday")},{value:"wednesday",label:r("Wednesday")},{value:"thursday",label:r("Thursday")},{value:"friday",label:r("Friday")}],{control:x,watch:g,trigger:y}=(0,i.Gc)(),h=g(),{myunitTime:f}=(0,q.lf)(),{user:j}=(0,b.E)(),{workGroupsData:T}=(0,Z.njN)(null===j||void 0===j||null===(n=j.employee)||void 0===n||null===(t=n.employee_engagements)||void 0===t||null===(l=t[j.employee.selected_engagement])||void 0===l?void 0:l._id),{workShiftsData:S}=(0,Z.lLi)(null===j||void 0===j||null===(o=j.employee)||void 0===o||null===(a=o.employee_engagements[null===j||void 0===j?void 0:j.employee.selected_engagement])||void 0===a?void 0:a.unit_service._id);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(I.Z,{flexItem:!0,sx:{borderStyle:"solid"}}),(0,P.jsxs)(m.Z,{sx:{p:3},children:[(0,P.jsxs)(m.Z,{spacing:2,direction:{xs:"column",sm:"row"},sx:{p:3,width:{xs:"100%",md:"auto"}},children:[(0,P.jsx)(i.Qr,{name:"start_date",control:x,render:e=>{let{field:n,fieldState:{error:t}}=e;return(0,P.jsx)(F.M,{label:"".concat(r("start date")," *"),value:f(h.start_date),onChange:e=>{var t,l,i,o;const a=(0,z.Z)(e,(null===j||void 0===j||null===(t=j.employee)||void 0===t||null===(l=t.employee_engagements[null===j||void 0===j?void 0:j.employee.selected_engagement])||void 0===l||null===(i=l.unit_service)||void 0===i||null===(o=i.country)||void 0===o?void 0:o.time_zone)||Intl.DateTimeFormat().resolvedOptions().timeZone);n.onChange(a)},slotProps:{textField:{fullWidth:!0,error:!!t,helperText:null===t||void 0===t?void 0:t.message}}})}}),(0,P.jsx)(i.Qr,{name:"end_date",control:x,render:e=>{let{field:n,fieldState:{error:t}}=e;return(0,P.jsx)(F.M,{label:r("end date"),value:f(h.end_date),onChange:e=>{var t,l,i,o;const a=(0,z.Z)(e,(null===j||void 0===j||null===(t=j.employee)||void 0===t||null===(l=t.employee_engagements[null===j||void 0===j?void 0:j.employee.selected_engagement])||void 0===l||null===(i=l.unit_service)||void 0===i||null===(o=i.country)||void 0===o?void 0:o.time_zone)||Intl.DateTimeFormat().resolvedOptions().timeZone);n.onChange(a)},slotProps:{textField:{fullWidth:!0,error:!!t,helperText:null===t||void 0===t?void 0:t.message}}})}})]}),(0,P.jsxs)(m.Z,{spacing:2,direction:{xs:"column",sm:"row"},sx:{px:3,pb:3,width:{xs:"100%",md:"auto"}},children:[(0,P.jsx)(k.Cc,{size:"small",name:"work_shift",label:"".concat(r("work shift")," *"),InputLabelProps:{shrink:!0},PaperPropsSx:{textTransform:"capitalize"},disabled:Boolean(s),children:S.map((e=>(0,P.jsx)(C.Z,{value:e._id,children:u?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english},e._id)))}),(0,P.jsx)(k.Cc,{size:"small",name:"work_group",label:"".concat(r("work group")," *"),InputLabelProps:{shrink:!0},PaperPropsSx:{textTransform:"capitalize"},disabled:Boolean(s),children:T&&(null===T||void 0===T?void 0:T.map((e=>(0,P.jsx)(C.Z,{value:e._id,children:u?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english},e._id))))}),(0,P.jsx)(k.au,{fullWidth:!0,step:"5",name:"appointment_time",label:r("appointment duration time"),type:"number",lang:"ar",onBlur:e=>{d(e.target.value),y("appointment_time")},size:"small",InputLabelProps:{shrink:!0},InputProps:{endAdornment:(0,P.jsx)(D.Z,{position:"end",children:(0,P.jsx)(_.Z,{lang:"ar",sx:{fontSize:"0.8rem"},children:r("min")})})}}),(0,P.jsx)(k.au,{lang:"ar",size:"small",InputProps:{startAdornment:(0,P.jsx)(D.Z,{position:"start",children:(0,P.jsx)(_.Z,{sx:{fontSize:"0.8rem"},children:u?"\u0644\u0628\u0639\u062f":"for the next"})}),endAdornment:(0,P.jsx)(D.Z,{position:"end",children:(0,P.jsx)(_.Z,{sx:{fontSize:"0.8rem"},children:u?"\u0623\u064a\u0627\u0645":"days"})})},name:"config_frequency",label:r("configuration frequency"),type:"number",inputProps:{min:0,max:30,textAlign:"center"},InputLabelProps:{shrink:!0}})]}),(0,P.jsxs)(v.Z,{variant:"p",sx:{color:"text.secondary",mb:3,fontWeight:"700",textTransform:"capitalize"},children:[u?"\u0627\u0644\u0639\u0637\u0644 \u0627\u0644\u0623\u0633\u0628\u0648\u0639\u064a\u0629":"Weekly Days Off",":"]}),(0,P.jsx)(m.Z,{spacing:2,direction:{xs:"column",sm:"row"},sx:{p:3},children:(0,P.jsx)(k.s2,{size:"small",name:"weekend",options:p,sx:{display:"grid",gridTemplateColumns:{md:"repeat(7, 1fr)",sm:"repeat(4, 1fr)",xs:"repeat(2, 1fr)"}}})})]})]})}var M=t(13838),E=t(13400),L=t(40268);function O(){const{t:e}=(0,w.qM)(),{currentLang:n}=(0,w.nt)(),t="ar"===n.value,{myunitTime:l}=(0,q.lf)(),{user:o}=(0,b.E)(),{control:a,watch:s}=(0,i.Gc)(),{fields:d,append:r,remove:c}=(0,i.Dq)({control:a,name:"holidays"}),u=s();return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(I.Z,{flexItem:!0,sx:{borderStyle:"solid"}}),(0,P.jsxs)(_.Z,{sx:{p:3},children:[(0,P.jsxs)(v.Z,{variant:"p",sx:{color:"text.secondary",mb:3,fontWeight:"700",textTransform:"capitalize"},children:[t?"\u0627\u0644\u0639\u0637\u0644":"Holidays",":"]}),(0,P.jsx)(m.Z,{sx:{mt:3},divider:(0,P.jsx)(I.Z,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:2,children:d.map(((n,t)=>(0,P.jsx)(m.Z,{alignItems:"flex-start",spacing:1.5,sx:{width:{xs:"100%",md:"auto"}},children:(0,P.jsxs)(m.Z,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:{xs:"100%",md:"auto"}},children:[(0,P.jsx)(k.au,{lang:"ar",size:"small",name:"holidays[".concat(t,"].description"),label:e("description")}),(0,P.jsx)(i.Qr,{name:"holidays[".concat(t,"].date"),control:a,render:n=>{let{field:i,fieldState:{error:a}}=n;return(0,P.jsx)(F.M,{label:e("date"),value:l(u.holidays[t].date),onChange:e=>{var n,t,l,a;const s=(0,z.Z)(e,(null===o||void 0===o||null===(n=o.employee)||void 0===n||null===(t=n.employee_engagements[null===o||void 0===o?void 0:o.employee.selected_engagement])||void 0===t||null===(l=t.unit_service)||void 0===l||null===(a=l.country)||void 0===a?void 0:a.time_zone)||Intl.DateTimeFormat().resolvedOptions().timeZone);i.onChange(s)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!a,helperText:null===a||void 0===a?void 0:a.message}}})}}),(0,P.jsx)(E.Z,{sx:{justifySelf:"flex-end",alignSelf:"flex-end",width:35},size:"small",color:"error",onClick:()=>(e=>{c(e)})(t),children:(0,P.jsx)(L.Z,{icon:"solar:trash-bin-trash-bold"})})]})},t)))}),(0,P.jsx)(I.Z,{sx:{mt:3,mb:1,borderStyle:"dashed"}}),(0,P.jsx)(m.Z,{spacing:3,direction:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"},children:(0,P.jsx)(M.Z,{size:"small",color:"primary",startIcon:(0,P.jsx)(L.Z,{icon:"tdesign:plus"}),sx:{padding:1},onClick:()=>{r({date:null,description:""})},children:t?"\u0625\u0636\u0627\u0641\u0629 \u0623\u064a\u0627\u0645 \u0639\u0637\u0644":"add holiday"})})]})]})}var A=t(58406),H=t(13034),Q=t(62861),R=t(68096),X=t(47071),G=t(86778),N=t(56125);function V(e){let{ParentIndex:n,open:t,appointmenttypesData:l,serviceTypesData:o,setAppointmentsNum:a}=e;const{t:s}=(0,w.qM)(),{currentLang:d}=(0,w.nt)(),r="ar"===d.value,{myunitTime:c}=(0,q.lf)(),{user:u}=(0,b.E)(),{control:p,watch:x}=(0,i.Gc)(),{fields:g,append:y,remove:h}=(0,i.Dq)({control:p,name:"days_details[".concat(n,"].appointments")}),f=x(),j=e=>{const n=null===o||void 0===o?void 0:o.filter((n=>null===e||void 0===e?void 0:e.includes(n._id)));return null===n||void 0===n?void 0:n.map((e=>r?e.name_arabic:e.name_english)).join(", ")};return(0,P.jsx)(N.Z,{in:t,sx:{bgcolor:"background.neutral"},children:(0,P.jsxs)(_.Z,{sx:{px:2,pb:0},children:[f.days_details[n].appointments&&f.days_details[n].appointments.length>0&&(0,P.jsxs)(v.Z,{variant:"p",lang:"ar",sx:{color:"text.disabled",mb:3,fontSize:14},children:[s("appointments"),":"]}),(0,P.jsx)(m.Z,{sx:{mt:3},divider:(0,P.jsx)(I.Z,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:3,alignItems:"flex-end",children:g.map(((e,t)=>(0,P.jsx)(m.Z,{alignItems:"center",flexWrap:"wrap",spacing:1.5,sx:{width:"80%"},children:(0,P.jsxs)(m.Z,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:"100%"},children:[(0,P.jsx)(k.Cc,{size:"small",InputLabelProps:{shrink:!0},name:"days_details[".concat(n,"].appointments[").concat(t,"].appointment_type"),label:"".concat(s("appointment type")," *"),children:null===l||void 0===l?void 0:l.map((e=>(0,P.jsx)(C.Z,{value:e._id,children:r?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english})))}),(0,P.jsx)(i.Qr,{name:"days_details[".concat(n,"].appointments[").concat(t,"].start_time"),control:p,render:e=>{var l;let{field:i,fieldState:{error:o}}=e;return(0,P.jsx)(G.d,{lang:"ar",minutesStep:"5",label:s("start time"),value:c(null===(l=f.days_details[n].appointments[t])||void 0===l?void 0:l.start_time),onChange:e=>{var n,t,l,o;const a=(0,z.Z)(e,(null===u||void 0===u||null===(n=u.employee)||void 0===n||null===(t=n.employee_engagements[null===u||void 0===u?void 0:u.employee.selected_engagement])||void 0===t||null===(l=t.unit_service)||void 0===l||null===(o=l.country)||void 0===o?void 0:o.time_zone)||Intl.DateTimeFormat().resolvedOptions().timeZone);i.onChange(a)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!o,helperText:null===o||void 0===o?void 0:o.message}}})}}),(0,P.jsx)(i.Qr,{name:"days_details[".concat(n,"].appointments[").concat(t,"].service_types"),control:p,render:e=>{let{field:l,fieldState:{error:i}}=e;return(0,P.jsxs)(R.Z,{error:!!i,size:"small",sx:{width:"100%",shrink:!0},children:[(0,P.jsxs)(Q.Z,{shrink:!0,children:[" ",s("service types")," "]}),(0,P.jsx)(A.Z,{...l,multiple:!0,id:"multiple-days_details[".concat(n,"].appointments[").concat(t,"].service_types"),label:s("service types"),renderValue:j,children:null===o||void 0===o?void 0:o.map((e=>{var n;const t=null===l||void 0===l||null===(n=l.value)||void 0===n?void 0:n.includes(e._id);return(0,P.jsxs)(C.Z,{value:e._id,children:[(0,P.jsx)(H.Z,{size:"small",disableRipple:!0,checked:t}),r?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english]},e._id)}))}),!!i&&(0,P.jsx)(X.Z,{error:!!i,children:null===i||void 0===i?void 0:i.message})]})}}),(0,P.jsx)(k.jb,{size:"small",InputLabelProps:{shrink:!0},name:"days_details[".concat(n,"].appointments[").concat(t,"].online_available"),label:(0,P.jsx)(v.Z,{lang:"ar",sx:{fontSize:12},children:s("online avaliable")})}),(0,P.jsx)(E.Z,{size:"small",color:"error",sx:{justifySelf:{xs:"flex-end"},alignSelf:{xs:"flex-end"},width:35},onClick:()=>(e=>{h(e),a((e=>({...e,[n]:e[n]-1})))})(t),children:(0,P.jsx)(L.Z,{icon:"solar:trash-bin-trash-bold"})})]})},t)))}),(0,P.jsx)(I.Z,{sx:{mt:f.days_details[n].appointments&&f.days_details[n].appointments.length>0?3:0,mb:1,borderStyle:"dashed"}}),(0,P.jsx)(m.Z,{spacing:3,direction:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"},children:(0,P.jsx)(M.Z,{size:"small",color:"primary",startIcon:(0,P.jsx)(L.Z,{icon:"tdesign:plus"}),sx:{padding:1},onClick:()=>{const e=f.days_details[n].appointments?f.days_details[n].appointments[f.days_details[n].appointments.length-1]:null,t=new Date(e?null===e||void 0===e?void 0:e.start_time:f.days_details[n].work_start_time);e&&t.setMinutes(t.getMinutes()+f.appointment_time);const l={appointment_type:null,start_time:null,price:null,online_available:!0,service_types:[],...e,start_time:t};y(l),a((e=>({...e,[n]:e[n]+1})))},children:r?"\u0625\u0636\u0627\u0641\u0629 \u0645\u0648\u0627\u0639\u064a\u062f \u0628\u0627\u0644\u062a\u0641\u0635\u064a\u0644":"Add Detailed Appointment"})})]})})}function B(e){var n,t;let{setErrorMsg:l,appointTime:o}=e;const{t:a}=(0,w.qM)(),{currentLang:d}=(0,w.nt)(),r="ar"===d.value,{myunitTime:c}=(0,q.lf)(),u=[{value:"saturday",label:a("Saturday")},{value:"sunday",label:a("Sunday")},{value:"monday",label:a("Monday")},{value:"tuesday",label:a("Tuesday")},{value:"wednesday",label:a("Wednesday")},{value:"thursday",label:a("Thursday")},{value:"friday",label:a("Friday")}],{control:p,setValue:x,watch:g,setError:y,clearErrors:h}=(0,i.Gc)(),{fields:f,append:j,remove:T}=(0,i.Dq)({control:p,name:"days_details"}),S=g(),{user:D}=(0,b.E)(),[F,W]=(0,s.useState)({}),[O,N]=(0,s.useState)({}),{appointmenttypesData:B}=(0,Z.o5E)(),{serviceTypesData:K}=(0,Z.fOd)(null===D||void 0===D||null===(n=D.employee)||void 0===n||null===(t=n.employee_engagements[null===D||void 0===D?void 0:D.employee.selected_engagement])||void 0===t?void 0:t.unit_service._id);async function U(e){try{if(h(),!S.appointment_time)return x("days_details[".concat(e,"].appointments"),[]),void y("appointment_time");if(!S.days_details[e].work_start_time)return x("days_details[".concat(e,"].appointments"),[]),void y("days_details[".concat(e,"].work_start_time"));if(!S.days_details[e].work_end_time)return x("days_details[".concat(e,"].appointments"),[]),void y("days_details[".concat(e,"].work_end_time"));const n=[],t=60*S.appointment_time*1e3,l=S.days_details[e],i=new Date(l.work_start_time).getTime();let o=new Date(l.work_end_time).getTime(),a=l.break_start_time?new Date(l.break_start_time).getTime():null,s=l.break_end_time?new Date(l.break_end_time).getTime():null;i>=o&&(o+=864e5),a&&i>a&&(a+=864e5),a&&s&&a>s&&(s+=864e5);let d=i;for(;d+t<=o;)!a||!s||d+t<=a||d>=s?(n.push({appointment_type:l.appointment_type,start_time:d,online_available:!0,service_types:l.service_types}),d+=t):d+=t;x("days_details[".concat(e,"].appointments"),n),W({...F,[e]:!0})}catch(n){console.error(n),l(n.message),window.scrollTo({top:0,behavior:"smooth"})}}const J=e=>{const n=null===K||void 0===K?void 0:K.filter((n=>null===e||void 0===e?void 0:e.includes(null===n||void 0===n?void 0:n._id)));return null===n||void 0===n?void 0:n.map((e=>null===e||void 0===e?void 0:e.name_english)).join(", ")};function Y(e){const n=S.days_details[e];if(null!==n&&void 0!==n&&n.appointments.length)return null===n||void 0===n?void 0:n.appointments.length;const t=60*S.appointment_time*1e3,l=new Date(n.work_start_time).getTime();let i=new Date(n.work_end_time).getTime(),o=new Date(n.break_start_time).getTime(),a=new Date(n.break_end_time).getTime();return l>i&&(i+=864e5),l>o&&(o+=864e5),l>a&&(a+=864e5),l<a&&l<=o&&i>=a&&i>o?Math.floor((i-l-(a-o))/t)||0:l<a&&l<=o&&i<=a&&i>o?Math.floor((i-l-(i-o))/t)||0:Math.floor((i-l)/t)||0}return(0,s.useEffect)((()=>{if(o)for(let e=0;e<S.days_details.length;e++)U(e)}),[o]),(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(I.Z,{flexItem:!0,sx:{borderStyle:"solid"}}),(0,P.jsxs)(_.Z,{sx:{p:3},children:[(0,P.jsxs)(v.Z,{variant:"p",sx:{color:"text.secondary",mb:3,fontWeight:"700",textTransform:"capitalize"},children:[r?"\u062a\u0641\u0627\u0635\u064a\u0644 \u0627\u0644\u064a\u0648\u0645":"Days Details",":"]}),(0,P.jsx)(m.Z,{sx:{mt:3},divider:(0,P.jsx)(I.Z,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:3,children:f.map(((e,n)=>{var t,l;return(0,P.jsxs)(m.Z,{spacing:1.5,sx:{width:"100%"},children:[(0,P.jsxs)(m.Z,{direction:{xs:"column",md:"column"},spacing:2,sx:{width:"100%",mt:2},children:[(0,P.jsxs)(m.Z,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:"100%",mt:2},children:[(0,P.jsx)(k.Cc,{disabled:!(null!==S&&void 0!==S&&null!==(t=S.weekend)&&void 0!==t&&t.includes(null===(l=S.days_details[n])||void 0===l?void 0:l.day)),InputLabelProps:{shrink:!0},size:"small",name:"days_details[".concat(n,"].day"),label:a("day"),children:u.filter((e=>!S.weekend.includes(e.value)&&!S.days_details.some((t=>{var l;return t.day===e.value&&(null===(l=S.days_details[n])||void 0===l?void 0:l.day)!==e.value})))).map((e=>(0,P.jsx)(C.Z,{value:e.value,children:e.label})))}),(0,P.jsx)(k.Cc,{size:"small",InputLabelProps:{shrink:!0},name:"days_details[".concat(n,"].appointment_type"),onChange:e=>{x("days_details[".concat(n,"].appointment_type"),e.target.value),U(n)},label:"".concat(a("appointment type")," *"),children:null===B||void 0===B?void 0:B.map((e=>(0,P.jsx)(C.Z,{value:e._id,children:r?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english})))}),(0,P.jsx)(i.Qr,{name:"days_details[".concat(n,"].service_types"),control:p,render:e=>{let{field:t,fieldState:{error:l}}=e;return(0,P.jsxs)(R.Z,{error:!!l,size:"small",sx:{width:"100%",shrink:!0},children:[(0,P.jsxs)(Q.Z,{shrink:!0,children:[" ",a("service types")," "]}),(0,P.jsx)(A.Z,{...t,multiple:!0,id:"multiple-days_details[".concat(n,"].service_types"),label:a("service types"),onChange:e=>{x("days_details[".concat(n,"].service_types"),e.target.value),U(n)},renderValue:J,children:null===K||void 0===K?void 0:K.map((e=>{var n;const l=null===t||void 0===t||null===(n=t.value)||void 0===n?void 0:n.includes(e._id);return(0,P.jsxs)(C.Z,{value:e._id,children:[(0,P.jsx)(H.Z,{size:"small",disableRipple:!0,checked:l}),r?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english]},e._id)}))}),!!l&&(0,P.jsx)(X.Z,{error:!!l,children:null===l||void 0===l?void 0:l.message})]})}}),(0,P.jsx)(k.au,{lang:"ar",disabled:!0,size:"small",name:"days_details[".concat(n,"].appointment_number"),label:a("appointments number"),InputLabelProps:{shrink:!0},value:O[n]||Y(n)})]}),(0,P.jsxs)(m.Z,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:"100%",mt:2},children:[(0,P.jsx)(i.Qr,{name:"days_details[".concat(n,"].work_start_time"),control:p,render:e=>{var t;let{field:l,fieldState:{error:i}}=e;return(0,P.jsx)(G.d,{lang:"ar",minutesStep:"5",label:a("work start time"),value:c(null===(t=S.days_details[n])||void 0===t?void 0:t.work_start_time),onChange:e=>{var t,i,o,a;const s=(0,z.Z)(e,(null===D||void 0===D||null===(t=D.employee)||void 0===t||null===(i=t.employee_engagements[null===D||void 0===D?void 0:D.employee.selected_engagement])||void 0===i||null===(o=i.unit_service)||void 0===o||null===(a=o.country)||void 0===a?void 0:a.time_zone)||Intl.DateTimeFormat().resolvedOptions().timeZone);l.onChange(s),x("days_details[".concat(n,"].work_end_time"),null),U(n)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!i,helperText:null===i||void 0===i?void 0:i.message}}})}}),(0,P.jsx)(i.Qr,{name:"days_details[".concat(n,"].work_end_time"),control:p,render:e=>{var t;let{field:l,fieldState:{error:i}}=e;return(0,P.jsx)(G.d,{lang:"ar",minutesStep:"5",label:a("work end time"),value:c(null===(t=S.days_details[n])||void 0===t?void 0:t.work_end_time),onChange:e=>{var t,i,o,a;const s=(0,z.Z)(e,(null===D||void 0===D||null===(t=D.employee)||void 0===t||null===(i=t.employee_engagements[null===D||void 0===D?void 0:D.employee.selected_engagement])||void 0===i||null===(o=i.unit_service)||void 0===o||null===(a=o.country)||void 0===a?void 0:a.time_zone)||Intl.DateTimeFormat().resolvedOptions().timeZone);l.onChange(s),U(n)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!i,helperText:null===i||void 0===i?void 0:i.message}}})}}),(0,P.jsx)(i.Qr,{name:"days_details[".concat(n,"].break_start_time"),control:p,render:e=>{var t;let{field:l,fieldState:{error:i}}=e;return(0,P.jsx)(G.d,{lang:"ar",minutesStep:"5",label:a("break start time"),value:c(null===(t=S.days_details[n])||void 0===t?void 0:t.break_start_time),onChange:e=>{var t,i,o,a;const s=(0,z.Z)(e,(null===D||void 0===D||null===(t=D.employee)||void 0===t||null===(i=t.employee_engagements[null===D||void 0===D?void 0:D.employee.selected_engagement])||void 0===i||null===(o=i.unit_service)||void 0===o||null===(a=o.country)||void 0===a?void 0:a.time_zone)||Intl.DateTimeFormat().resolvedOptions().timeZone);x("days_details[".concat(n,"].break_end_time"),null),l.onChange(s),U(n)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!i,helperText:null===i||void 0===i?void 0:i.message}}})}}),(0,P.jsx)(i.Qr,{name:"days_details[".concat(n,"].break_end_time"),control:p,render:e=>{var t;let{field:l,fieldState:{error:i}}=e;return(0,P.jsx)(G.d,{lang:"ar",minutesStep:"5",label:a("break end time"),value:c(null===(t=S.days_details[n])||void 0===t?void 0:t.break_end_time),onChange:e=>{var t,i,o,a;const s=(0,z.Z)(e,(null===D||void 0===D||null===(t=D.employee)||void 0===t||null===(i=t.employee_engagements[null===D||void 0===D?void 0:D.employee.selected_engagement])||void 0===i||null===(o=i.unit_service)||void 0===o||null===(a=o.country)||void 0===a?void 0:a.time_zone)||Intl.DateTimeFormat().resolvedOptions().timeZone);l.onChange(s),U(n)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!i,helperText:null===i||void 0===i?void 0:i.message}}})}})]}),(0,P.jsxs)(m.Z,{direction:{xs:"column",md:"row"},spacing:.2,sx:{justifySelf:{xs:"flex-end"},alignSelf:{xs:"flex-end"}},children:[(0,P.jsx)(E.Z,{size:"small",color:"error",onClick:()=>(e=>{T(e)})(n),children:(0,P.jsx)(L.Z,{icon:"solar:trash-bin-trash-bold"})}),(0,P.jsx)(E.Z,{size:"small",onClick:()=>U(n),children:(0,P.jsx)(L.Z,{icon:"zondicons:refresh"})}),(0,P.jsx)(E.Z,{size:"small",onClick:()=>W({...F,[n]:!F[n]}),children:(0,P.jsx)(L.Z,{icon:F[n]?"eva:arrow-ios-upward-fill":"eva:arrow-ios-downward-fill"})})]})]}),(0,P.jsx)(V,{setAppointmentsNum:N,serviceTypesData:K,appointmenttypesData:B,open:F[n],ParentIndex:n})]},null===e||void 0===e?void 0:e.id)}))}),(0,P.jsx)(I.Z,{sx:{mt:3,mb:1,borderStyle:"dashed"}}),(0,P.jsx)(m.Z,{spacing:3,direction:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"},children:(0,P.jsx)(M.Z,{size:"small",color:"primary",startIcon:(0,P.jsx)(L.Z,{icon:"tdesign:plus"}),sx:{padding:1},onClick:()=>{try{var e;const n=null===(e=u.filter((e=>!S.weekend.includes(e.value)&&!S.days_details.some((n=>n.day===e.value))))[0])||void 0===e?void 0:e.value;if(!n)throw Error("No valid date to create");const t={day:"",work_start_time:null,work_end_time:null,break_start_time:null,break_end_time:null,appointments:[],service_types:[],appointment_type:null},l=S.days_details?S.days_details[S.days_details.length-1]:[],i={...t,...l,day:n};j(i)}catch(n){console.error(n),l(n.message),window.scrollTo({top:0,behavior:"smooth"})}},children:r?"\u0625\u0636\u0627\u0641\u0629 \u064a\u0648\u0645 \u062c\u062f\u064a\u062f":"add new day"})})]})]})}function K(){const{t:e}=(0,w.qM)(),{currentLang:n}=(0,w.nt)(),t="ar"===n.value,{myunitTime:l}=(0,q.lf)(),{user:o}=(0,b.E)(),{control:a,watch:s,setValue:d}=(0,i.Gc)(),{fields:r,append:c,remove:u}=(0,i.Dq)({control:a,name:"long_holidays"}),p=s();return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(I.Z,{flexItem:!0,sx:{borderStyle:"solid"}}),(0,P.jsxs)(_.Z,{sx:{p:3},children:[(0,P.jsxs)(v.Z,{variant:"p",sx:{color:"text.secondary",mb:3,fontWeight:"700",textTransform:"capitalize"},children:[t?"\u0639\u0637\u0644 \u0637\u0648\u064a\u0644\u0629":"Long Holidays",":"]}),(0,P.jsx)(m.Z,{sx:{mt:3},divider:(0,P.jsx)(I.Z,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:3,children:r.map(((n,t)=>(0,P.jsx)(m.Z,{alignItems:"flex-start",spacing:1.5,sx:{width:{xs:"100%",md:"auto"}},children:(0,P.jsxs)(m.Z,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:{xs:"100%",md:"auto"}},children:[(0,P.jsx)(k.au,{lang:"ar",size:"small",name:"long_holidays[".concat(t,"].description"),label:e("description")}),(0,P.jsx)(i.Qr,{name:"long_holidays[".concat(t,"].start_date"),control:a,render:n=>{let{field:i,fieldState:{error:a}}=n;return(0,P.jsx)(F.M,{label:e("start date"),value:l(p.long_holidays[t].start_date),onChange:e=>{var n,l,a,s;const r=(0,z.Z)(e,(null===o||void 0===o||null===(n=o.employee)||void 0===n||null===(l=n.employee_engagements[null===o||void 0===o?void 0:o.employee.selected_engagement])||void 0===l||null===(a=l.unit_service)||void 0===a||null===(s=a.country)||void 0===s?void 0:s.time_zone)||Intl.DateTimeFormat().resolvedOptions().timeZone);d("long_holidays[".concat(t,"].end_date"),r),i.onChange(r)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!a,helperText:null===a||void 0===a?void 0:a.message}}})}}),(0,P.jsx)(i.Qr,{name:"long_holidays[".concat(t,"].end_date"),control:a,render:n=>{let{field:i,fieldState:{error:a}}=n;return(0,P.jsx)(F.M,{label:e("end date"),value:l(p.long_holidays[t].end_date),onChange:e=>{var n,t,l,a;const s=(0,z.Z)(e,(null===o||void 0===o||null===(n=o.employee)||void 0===n||null===(t=n.employee_engagements[null===o||void 0===o?void 0:o.employee.selected_engagement])||void 0===t||null===(l=t.unit_service)||void 0===l||null===(a=l.country)||void 0===a?void 0:a.time_zone)||Intl.DateTimeFormat().resolvedOptions().timeZone);i.onChange(s)},slotProps:{textField:{size:"small",fullWidth:!0,error:!!a,helperText:null===a||void 0===a?void 0:a.message}}})}}),(0,P.jsx)(E.Z,{size:"small",color:"error",sx:{justifySelf:"flex-end",alignSelf:"flex-end",width:35},onClick:()=>(e=>{u(e)})(t),children:(0,P.jsx)(L.Z,{icon:"solar:trash-bin-trash-bold"})})]})},t)))}),(0,P.jsx)(I.Z,{sx:{mt:3,mb:1,borderStyle:"dashed"}}),(0,P.jsx)(m.Z,{spacing:1,direction:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"},children:(0,P.jsx)(M.Z,{size:"small",color:"primary",startIcon:(0,P.jsx)(L.Z,{icon:"tdesign:plus"}),sx:{padding:1},onClick:()=>{c({start_date:null,end_date:null,description:""})},children:t?"\u0625\u0636\u0627\u0641\u0629 \u0639\u0637\u0644 \u0637\u0648\u064a\u0644\u0629":"add long holiday"})})]})]})}function U(e){let{appointmentConfigData:n,refetch:t,loading:o}=e;const z=(0,y.tv)(),{t:I}=(0,w.qM)(),{currentLang:C}=(0,w.nt)(),D="ar"===C.value,{id:F}=(0,y.UO)(),{user:q}=(0,b.E)(),M=(0,Z.X79)(F).data,[E,L]=(0,s.useState)(0),[A,H]=(0,s.useState)(),[Q,R]=(0,s.useState)([]),{enqueueSnackbar:X}=(0,T.Ds)(),G=(0,h.k)(!1),N=(0,h.k)(!1),V=(0,h.k)(),U=(0,h.k)(),J=l.Ry().shape({weekend:l.IX(),start_date:l.hT().nullable(),end_date:l.hT().nullable(),appointment_time:l.Rx().required("Appointment Time is required").min(5,"Appointment Time must be at least 5").max(180,"Appointment Time must be at most 180"),config_frequency:l.Rx().required("Configuration Frequency is required").min(1,"must be at least 1").max(360,"must be at most 360"),holidays:l.IX(),long_holidays:l.IX().of(l.Ry().shape({start_date:l.hT().nullable(),end_date:l.hT().nullable().when("start_date",((e,n)=>e&&n.min(e,"End date must be after start date"))),description:l.Z_().nullable()})),work_group:l.Z_().required("Work Group is required"),work_shift:l.Z_().required("Work Shift is required"),days_details:l.IX().of(l.Ry().shape({day:l.Z_().required("Day is required"),work_start_time:l.nK().nullable().required("work start time is required"),work_end_time:l.nK().nullable().required("work end time is required"),appointments:l.IX(),service_types:l.IX(),appointment_type:l.Z_().nullable()}))}),Y=(0,s.useMemo)((()=>{var e,t,l,i,o,a,s,d;return{unit_service:(null===n||void 0===n?void 0:n.unit_service._id)||(null===q||void 0===q||null===(e=q.employee)||void 0===e||null===(t=e.employee_engagements[null===q||void 0===q?void 0:q.employee.selected_engagement])||void 0===t?void 0:t.unit_service._id),department:(null===M||void 0===M||null===(l=M.department)||void 0===l?void 0:l._id)||(null===q||void 0===q||null===(i=q.employee)||void 0===i||null===(o=i.employee_engagements[null===q||void 0===q?void 0:q.employee.selected_engagement])||void 0===o||null===(a=o.department)||void 0===a?void 0:a._id),start_date:(null===n||void 0===n?void 0:n.start_date)||null,end_date:(null===n||void 0===n?void 0:n.end_date)||null,weekend:(null===n||void 0===n?void 0:n.weekend)||[],appointment_time:(null===n||void 0===n?void 0:n.appointment_time)||null,config_frequency:(null===n||void 0===n?void 0:n.config_frequency)||null,holidays:(null===n||void 0===n?void 0:n.holidays)||[{description:"",date:null}],long_holidays:(null===n||void 0===n?void 0:n.long_holidays)||[{description:"",start_date:null,end_date:null}],work_group:(null===n||void 0===n||null===(s=n.work_group)||void 0===s?void 0:s._id)||null,work_shift:(null===n||void 0===n||null===(d=n.work_shift)||void 0===d?void 0:d._id)||null,days_details:(null===n||void 0===n?void 0:n.days_details)||[{day:"saturday",work_start_time:null,work_end_time:null,break_start_time:null,break_end_time:null,appointments:[],service_types:[],appointment_type:null}]}}),[n,null===q||void 0===q?void 0:q.employee,null===M||void 0===M?void 0:M.department]),$=(0,i.cI)({mode:"onTouched",resolver:(0,d.X)(J),defaultValues:Y}),{handleSubmit:ee,formState:{isSubmitting:ne,errors:te}}=$,le=ee((async e=>{U.onTrue();const t=new Date,l=new Date(t.getTime()+24*e.config_frequency*60*60*1e3);try{n?!e.start_date&&!e.end_date||new Date(e.end_date)>t&&(new Date(e.start_date)<=t||new Date(e.start_date)<l)?(R(e),V.onTrue()):(await f.ZP.patch("".concat(f.Hv.tables.appointmentconfigs,"/").concat(null===n||void 0===n?void 0:n._id),e),j.Z.emit("updated",{data:e,user:q,link:g.H.unitservice.employees.appointmentconfig.root(F),msg:"updated an appointment configuration ".concat(n.code||"")}),z.push(g.H.unitservice.employees.appointmentconfig.root(F))):(N.onTrue(),await f.ZP.post(f.Hv.tables.appointmentconfigs,e),j.Z.emit("created",{data:e,user:q,link:g.H.unitservice.employees.appointmentconfig.root(F),msg:"created an appointment config <strong>".concat(e.name_english||"","</strong>")}),N.onFalse(),X(I("added successfully!")),z.push(g.H.unitservice.employees.appointmentconfig.root(F))),U.onFalse(),console.info("DATA",JSON.stringify(e,null,2))}catch(i){H("string"===typeof i?i:i.message),window.scrollTo({top:0,behavior:"smooth"}),j.Z.emit("error",{error:i,user:q,location:window.location.pathname}),N.onFalse(),U.onFalse(),X("string"===typeof i?i:i.message,{variant:"error"}),console.error(i)}}));return(0,s.useEffect)((()=>{Object.keys(te).length&&H(Object.keys(te).map((e=>{var n;return null===te||void 0===te||null===(n=te[e])||void 0===n?void 0:n.message})).join("<br>"))}),[te]),console.log("errorMsg",A),(0,s.useEffect)((()=>{var e,t,l,i,o,a,s;n&&$.reset({unit_service:(null===n||void 0===n?void 0:n.unit_service)||(null===q||void 0===q||null===(e=q.employee)||void 0===e||null===(t=e.employee_engagements[null===q||void 0===q?void 0:q.employee.selected_engagement])||void 0===t?void 0:t.unit_service._id),department:(null===M||void 0===M||null===(l=M.department)||void 0===l?void 0:l._id)||(null===q||void 0===q||null===(i=q.employee.employee_engagements[null===q||void 0===q?void 0:q.employee.selected_engagement])||void 0===i||null===(o=i.department)||void 0===o?void 0:o._id),start_date:(null===n||void 0===n?void 0:n.start_date)||null,end_date:(null===n||void 0===n?void 0:n.end_date)||null,weekend:(null===n||void 0===n?void 0:n.weekend)||[],appointment_time:(null===n||void 0===n?void 0:n.appointment_time)||null,config_frequency:(null===n||void 0===n?void 0:n.config_frequency)||null,holidays:(null===n||void 0===n?void 0:n.holidays)||[{description:"",date:null}],long_holidays:(null===n||void 0===n?void 0:n.long_holidays)||[{description:"",start_date:null,end_date:null}],work_group:(null===(a=n.work_group)||void 0===a?void 0:a._id)||null,work_shift:(null===(s=n.work_shift)||void 0===s?void 0:s._id)||null,days_details:n.days_details||[{day:"",work_start_time:null,work_end_time:null,break_start_time:null,break_end_time:null,appointments:[]}]})}),[n,$,q,null===M||void 0===M?void 0:M.department]),(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(c.Z,{maxWidth:"lg",children:(0,P.jsxs)(k.ZP,{methods:$,children:[!o&&(0,P.jsxs)(r.Z,{children:[!!A&&(0,P.jsx)(p.Z,{sx:{borderRadius:0},severity:"error",children:(0,P.jsxs)("div",{children:[" ",A," "]})}),(0,P.jsx)(W,{setAppointTime:L,appointmentConfigData:n}),(0,P.jsx)(B,{setErrorMsg:H,appointTime:E}),(0,P.jsx)(O,{}),(0,P.jsx)(K,{})]}),(0,P.jsx)(m.Z,{justifyContent:"flex-end",direction:"row",spacing:2,sx:{mt:3},children:(0,P.jsx)(u.Z,{variant:"contained",loading:ne||G.value||N.value,onClick:le,children:I("save")})})]})}),(0,P.jsx)(S.Q,{disabled:N.value,open:N.value||V.value,onClose:V.onFalse,title:N.value?"Creating appointments...":"Do you want to change your existance appointments?",content:N.value?(0,P.jsx)(P.Fragment,{children:(0,P.jsx)(a(),{options:{strings:["It might take several minutes..","We are getting appointments ready..","We are almost done.."],autoStart:!0,loop:!0,deleteSpeed:5,cursor:"",delay:20}})}):(0,P.jsxs)(P.Fragment,{children:[D?(0,P.jsxs)(v.Z,{variant:"body2",component:"p",sx:{mt:1,color:"text.disabled"},children:["\u0627\u0636\u063a\u0637 ",(0,P.jsx)("strong",{children:" \u0646\u0639\u0645 "})," \u0644\u062a\u063a\u064a\u064a\u0631 \u0627\u0644\u0645\u0648\u0627\u0639\u064a\u062f \u0627\u0644\u0645\u0646\u0634\u0623\u0629"]}):(0,P.jsxs)(v.Z,{variant:"body2",component:"p",sx:{mt:1,color:"text.disabled"},children:["press",(0,P.jsx)("strong",{children:" yes"})," to change existance appointments"]}),D?(0,P.jsxs)(v.Z,{variant:"body2",component:"p",sx:{mt:1,color:"text.disabled"},children:["\u0627\u0636\u063a\u0637 ",(0,P.jsx)("strong",{children:" \u0644\u0627 "})," \u0644\u062d\u0641\u0638 \u0627\u0644\u0627\u0639\u062f\u0627\u062f\u0627\u062a \u0644\u0644\u0628\u062f\u0621 \u0645\u0646 \u0627\u0644\u0645\u0648\u0627\u0639\u064a\u062f \u0627\u0644\u062a\u064a \u064a\u0631\u0627\u062f \u0625\u0646\u0634\u0627\u0626\u0647\u0627"]}):(0,P.jsxs)(v.Z,{variant:"body2",component:"p",sx:{mt:1,color:"text.disabled"},children:["press",(0,P.jsx)("strong",{children:" No"})," to start changing when creating new appointments"]})]}),action:(0,P.jsxs)(P.Fragment,{children:[N.value&&(0,P.jsx)(_.Z,{height:"40",sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,P.jsx)(x.Z,{size:24,color:"primary"})}),!N.value&&(0,P.jsx)(u.Z,{variant:"contained",loading:N.value,color:"warning",onClick:async()=>{N.onTrue();try{await f.ZP.patch("".concat(f.Hv.tables.appointmentconfigs,"/").concat(null===n||void 0===n?void 0:n._id),{...Q,ImmediateEdit:!0}),j.Z.emit("updated",{user:q,link:g.H.unitservice.employees.appointmentconfig.root(F),msg:"updated an appointment configuration <strong>[ ".concat(n.code||""," ]</strong>")}),N.onFalse(),V.onFalse(),X(I("Updated successfully!")),z.push(g.H.unitservice.employees.appointmentconfig.root(F))}catch(e){H("string"===typeof e?e:e.message),window.scrollTo({top:0,behavior:"smooth"}),j.Z.emit("error",{error:e,user:q,location:window.location.pathname}),N.onFalse(),V.onFalse(),X("string"===typeof e?e:e.message,{variant:"error"}),console.error(e)}},children:I("yes")}),!N.value&&(0,P.jsx)(u.Z,{disabled:N.value,loading:G.value,variant:"contained",color:"success",onClick:async()=>{G.onTrue();try{await f.ZP.patch("".concat(f.Hv.tables.appointmentconfigs,"/").concat(null===n||void 0===n?void 0:n._id),{...Q,ImmediateEdit:!1}),j.Z.emit("updated",{user:q,link:g.H.unitservice.employees.appointmentconfig.root(F),msg:"updated an appointment configuration <strong>[ ".concat(n.code||""," ]</strong>")}),X(I("updated successfully!")),G.onFalse(),V.onFalse(),z.push(g.H.unitservice.employees.appointmentconfig.root(F))}catch(e){j.Z.emit("error",{error:e,user:q,location:window.location.pathname}),H("string"===typeof e?e:e.message),window.scrollTo({top:0,behavior:"smooth"}),G.onFalse(),V.onFalse(),X("string"===typeof e?e:e.message,{variant:"error"}),console.error(e)}},children:I("no")})]})})]})}}}]);
//# sourceMappingURL=5401.c6000687.chunk.js.map