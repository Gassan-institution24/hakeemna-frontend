(self.webpackChunk_minimal_kit_cra_js=self.webpackChunk_minimal_kit_cra_js||[]).push([[8580],{28580:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>N});var n=i(6907),s=i(27031),o=i(8007),l=i(72791),r=i(61134),a=i(44695),d=i(57621),c=i(53767),u=i(10266),x=i(12258),m=i(38072),h=i(19208),v=i(22459),p=i(59493),b=i(87151),j=i.n(b),g=i(16029),Z=i(13838),y=i(94721),f=i(82626),_=i(4567),w=i(63466),k=i(55891),q=i(17070),C=i(40268),D=i(19721),A=i(8976),T=i(80184);function I(){var e,t,i,n;const{user:s}=(0,A.E)(),{serviceTypesData:o}=(0,D.UL2)(null===s||void 0===s||null===(e=s.employee)||void 0===e||null===(t=e.employee_engagements)||void 0===t||null===(i=t[s.employee.selected_engagement])||void 0===i||null===(n=i.unit_service)||void 0===n?void 0:n._id),{control:a,setValue:d,watch:u}=(0,r.Gc)(),{fields:x,append:m,remove:h}=(0,r.Dq)({control:a,name:"items"}),v=u(),b=v.items.map((e=>e.subtotal)),I=v.items.map((e=>e.total)),P=j()(b),S=j()(I);(0,l.useEffect)((()=>{d("totalAmount",S)}),[d,S]),(0,l.useEffect)((()=>{var e,t,i;const n=null===(e=v.items)||void 0===e?void 0:e.reduce(((e,t)=>e+t.tax/100*t.subtotal),0);d("taxes",n);const s=null===(t=v.items)||void 0===t?void 0:t.reduce(((e,t)=>e+t.deduction/100*t.subtotal),0);d("deduction",s);const l=null===(i=v.items)||void 0===i?void 0:i.reduce(((e,t)=>{const i=null===o||void 0===o?void 0:o.find((e=>e._id===t.service));return t.price!==Number(null===i||void 0===i?void 0:i.Price_per_unit)&&i?e+(Number(i.Price_per_unit)-t.price)*t.quantity:e}),0);d("discount",l)}),[S,d,v.items,o]);const F=(0,l.useCallback)(((e,t)=>{var i,n;const s=null===o||void 0===o?void 0:o.find((e=>e._id===t));d("items[".concat(e,"].price"),null===s||void 0===s?void 0:s.Price_per_unit),d("items[".concat(e,"].subtotal"),v.items.map((e=>e.quantity*e.price))[e]),d("items[".concat(e,"].tax"),(null===s||void 0===s||null===(i=s.tax)||void 0===i?void 0:i.percentage)||0),d("items[".concat(e,"].deduction"),(null===s||void 0===s||null===(n=s.deduction)||void 0===n?void 0:n.percentage)||0),d("items[".concat(e,"].total"),v.items.map((e=>e.subtotal*((100+e.tax)/100)+e.subtotal*(e.deduction/100)))[e])}),[d,v.items,o]),z=(0,l.useCallback)(((e,t)=>{d("items[".concat(t,"].quantity"),Number(e.target.value)),d("items[".concat(t,"].subtotal"),v.items.map((e=>e.quantity*e.price))[t]),d("items[".concat(t,"].total"),v.items.map((e=>e.subtotal*((100+e.tax)/100)+e.subtotal*(e.deduction/100)))[t])}),[d,v.items]),N=(0,l.useCallback)(((e,t)=>{d("items[".concat(t,"].price"),Number(e.target.value)),d("items[".concat(t,"].subtotal"),v.items.map((e=>e.quantity*e.price))[t]),d("items[".concat(t,"].total"),v.items.map((e=>e.subtotal*((100+e.tax)/100)+e.subtotal*(e.deduction/100)))[t])}),[d,v.items]),W=(0,T.jsxs)(c.Z,{spacing:2,alignItems:"flex-end",sx:{mt:3,textAlign:"right",typography:"body2"},children:[(0,T.jsxs)(c.Z,{direction:"row",children:[(0,T.jsx)(g.Z,{sx:{color:"text.secondary"},children:"Discount"}),(0,T.jsx)(g.Z,{sx:{width:160,...v.discount&&{color:"error.main"}},children:v.discount?"- ".concat((0,q.e_)(v.discount)):"-"})]}),(0,T.jsxs)(c.Z,{direction:"row",children:[(0,T.jsx)(g.Z,{sx:{color:"text.secondary"},children:"Subtotal"}),(0,T.jsx)(g.Z,{sx:{width:160,typography:"subtitle2"},children:(0,q.e_)(P)||"-"})]}),(0,T.jsxs)(c.Z,{direction:"row",children:[(0,T.jsx)(g.Z,{sx:{color:"text.secondary"},children:"Taxes"}),(0,T.jsx)(g.Z,{sx:{width:160},children:v.taxes?(0,q.e_)(v.taxes):"-"})]}),(0,T.jsxs)(c.Z,{direction:"row",children:[(0,T.jsx)(g.Z,{sx:{color:"text.secondary"},children:"Deduction"}),(0,T.jsx)(g.Z,{sx:{width:160},children:v.deduction?(0,q.e_)(v.deduction):"-"})]}),(0,T.jsxs)(c.Z,{direction:"row",sx:{typography:"subtitle1"},children:[(0,T.jsx)(g.Z,{children:"Total"}),(0,T.jsx)(g.Z,{sx:{width:160},children:(0,q.e_)(S)||"-"})]})]});return(0,T.jsxs)(g.Z,{sx:{p:3},children:[(0,T.jsx)(_.Z,{variant:"h6",sx:{color:"text.disabled",mb:3},children:"Details:"}),(0,T.jsx)(c.Z,{divider:(0,T.jsx)(y.Z,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:2,children:x.map(((e,t)=>(0,T.jsx)(c.Z,{alignItems:"flex-end",spacing:1.5,children:(0,T.jsxs)(c.Z,{direction:{xs:"column",md:"row"},justifyContent:"center",spacing:2,sx:{width:1},children:[(0,T.jsx)(p.Cc,{name:"items[".concat(t,"].service"),size:"small",label:"Service",sx:{maxWidth:"450px"},InputLabelProps:{shrink:!0},children:null===o||void 0===o?void 0:o.map((e=>(0,T.jsx)(f.Z,{value:e._id,onClick:()=>F(t,e._id),children:e.name_english},e._id)))}),(0,T.jsx)(p.au,{size:"small",type:"number",name:"items[".concat(t,"].quantity"),label:"Quantity",placeholder:"0",onChange:e=>z(e,t),InputLabelProps:{shrink:!0},sx:{maxWidth:{md:150}}}),(0,T.jsx)(p.au,{size:"small",type:"number",name:"items[".concat(t,"].price"),label:"Price",placeholder:"0.00",onChange:e=>N(e,t),InputProps:{startAdornment:(0,T.jsx)(w.Z,{position:"start",children:(0,T.jsx)(g.Z,{sx:{typography:"subtitle2",color:"text.disabled"},children:"$"})})},sx:{maxWidth:{md:150}}}),(0,T.jsx)(p.au,{disabled:!0,size:"small",type:"number",name:"items[".concat(t,"].subtotal"),label:"Subtotal",placeholder:"0.00",value:0===v.items[t].subtotal?"":v.items[t].subtotal.toFixed(2),onChange:e=>N(e,t),InputProps:{startAdornment:(0,T.jsx)(w.Z,{position:"start",children:(0,T.jsx)(g.Z,{sx:{typography:"subtitle2",color:"text.disabled"},children:"$"})})},sx:{maxWidth:{md:150},["& .".concat(k.Z.input)]:{textAlign:{md:"right"}}}}),(0,T.jsx)(p.au,{disabled:!0,size:"small",type:"number",name:"items[".concat(t,"].tax"),label:"tax",placeholder:"00",InputProps:{startAdornment:(0,T.jsx)(w.Z,{position:"start",children:(0,T.jsx)(g.Z,{sx:{typography:"subtitle2",color:"text.disabled"},children:"%"})})},sx:{maxWidth:{md:150},["& .".concat(k.Z.input)]:{textAlign:{md:"right"}}}}),(0,T.jsx)(p.au,{disabled:!0,size:"small",type:"number",name:"items[".concat(t,"].deduction"),label:"deduction",placeholder:"00",InputProps:{startAdornment:(0,T.jsx)(w.Z,{position:"start",children:(0,T.jsx)(g.Z,{sx:{typography:"subtitle2",color:"text.disabled"},children:"%"})})},sx:{maxWidth:{md:150},["& .".concat(k.Z.input)]:{textAlign:{md:"right"}}}}),(0,T.jsx)(p.au,{disabled:!0,size:"small",type:"number",name:"items[".concat(t,"].total"),label:"Total",placeholder:"0.00",value:0===v.items[t].total?"":v.items[t].total.toFixed(2),InputProps:{startAdornment:(0,T.jsx)(w.Z,{position:"start",children:(0,T.jsx)(g.Z,{sx:{typography:"subtitle2",color:"text.disabled"},children:"$"})})},sx:{maxWidth:{md:150},["& .".concat(k.Z.input)]:{textAlign:{md:"right"}}}}),(0,T.jsx)(Z.Z,{size:"small",color:"error",onClick:()=>(e=>{h(e)})(t),children:(0,T.jsx)(C.Z,{icon:"solar:trash-bin-trash-bold"})})]})},e.id)))}),(0,T.jsx)(y.Z,{sx:{my:3,borderStyle:"dashed"}}),(0,T.jsx)(c.Z,{spacing:3,direction:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"},children:(0,T.jsx)(Z.Z,{size:"small",color:"primary",startIcon:(0,T.jsx)(C.Z,{icon:"mingcute:add-line"}),onClick:()=>{m({service:null,quantity:1,price:0,subtotal:0,tax:0,total:0})},sx:{flexShrink:0},children:"Add Item"})}),W]})}i(84954);i(72043);function P(){var e,t;const{watch:i,setValue:n}=(0,r.Gc)(),{user:s}=(0,A.E)(),o=null===s||void 0===s||null===(e=s.employee)||void 0===e||null===(t=e.employee_engagements[null===s||void 0===s?void 0:s.employee.selected_engagement])||void 0===t?void 0:t.unit_service,l=i(),{invoiceFrom:a,invoiceTo:d}=l;(0,v.k)(),(0,v.k)();return(0,T.jsx)(T.Fragment,{children:(0,T.jsxs)(c.Z,{spacing:{xs:3,md:5},sx:{p:3},children:[(0,T.jsx)(c.Z,{sx:{width:1},children:(0,T.jsxs)(c.Z,{spacing:1,children:[(0,T.jsx)(_.Z,{variant:"h4",children:(null===a||void 0===a?void 0:a.name)||o.name_english}),(0,T.jsx)(_.Z,{variant:"body2",children:(null===a||void 0===a?void 0:a.fullAddress)||o.address}),(0,T.jsxs)(_.Z,{variant:"body2",children:[" ",(null===a||void 0===a?void 0:a.phoneNumber)||o.phone]})]})}),(0,T.jsxs)(c.Z,{sx:{width:1},children:[(0,T.jsx)(c.Z,{direction:"row",alignItems:"center",sx:{mb:1},children:(0,T.jsx)(_.Z,{variant:"h6",sx:{color:"text.disabled",flexGrow:1},children:"To:"})}),(0,T.jsxs)(c.Z,{spacing:1,children:[(0,T.jsx)(_.Z,{variant:"subtitle2",children:null===d||void 0===d?void 0:d.name_english}),(0,T.jsx)(_.Z,{variant:"body2",children:null===d||void 0===d?void 0:d.address}),(0,T.jsxs)(_.Z,{variant:"body2",children:[" ",null===d||void 0===d?void 0:d.phone]})]})]})]})})}var S=i(17003);function F(){const{control:e}=(0,r.Gc)();return(0,T.jsxs)(c.Z,{spacing:2,direction:{xs:"column",sm:"row"},sx:{p:3,bgcolor:"background.neutral"},children:[(0,T.jsx)(p.Cc,{fullWidth:!0,name:"status",label:"Status",InputLabelProps:{shrink:!0},PaperPropsSx:{textTransform:"capitalize"},children:["paid","pending","overdue","draft"].map((e=>(0,T.jsx)(f.Z,{value:e,children:e},e)))}),(0,T.jsx)(r.Qr,{name:"createDate",control:e,render:e=>{let{field:t,fieldState:{error:i}}=e;return(0,T.jsx)(S.M,{label:"Date create",value:t.value,onChange:e=>{t.onChange(e)},slotProps:{textField:{fullWidth:!0,error:!!i,helperText:null===i||void 0===i?void 0:i.message}}})}}),(0,T.jsx)(r.Qr,{name:"dueDate",control:e,render:e=>{let{field:t,fieldState:{error:i}}=e;return(0,T.jsx)(S.M,{label:"Due date",value:t.value,onChange:e=>{t.onChange(e)},slotProps:{textField:{fullWidth:!0,error:!!i,helperText:null===i||void 0===i?void 0:i.message}}})}})]})}function z(e){let{currentInvoice:t}=e;const i=(0,h.tv)(),n=(0,v.k)(),s=(0,v.k)(),b=o.Ry().shape({invoiceTo:o.nK().nullable().required("Invoice to is required"),createDate:o.nK().nullable().required("Create date is required"),dueDate:o.nK().required("Due date is required").test("date-min","Due date must be later than create date",((e,t)=>{let{parent:i}=t;return e.getTime()>i.createDate.getTime()})),items:o.Vo((()=>o.IX().of(o.Ry({title:o.Z_().required("Title is required"),service:o.Z_().required("Service is required"),quantity:o.Rx().required("Quantity is required").min(1,"Quantity must be more than 0")})))),taxes:o.Rx(),deduction:o.Rx(),status:o.Z_(),discount:o.Rx(),shipping:o.Rx(),invoiceFrom:o.nK(),totalAmount:o.Rx(),invoiceNumber:o.Z_()}),j=(0,l.useMemo)((()=>({invoiceNumber:(null===t||void 0===t?void 0:t.invoiceNumber)||"INV-1990",createDate:(null===t||void 0===t?void 0:t.createDate)||new Date,dueDate:(null===t||void 0===t?void 0:t.dueDate)||null,taxes:(null===t||void 0===t?void 0:t.taxes)||0,deduction:(null===t||void 0===t?void 0:t.deduction)||0,shipping:(null===t||void 0===t?void 0:t.shipping)||0,status:(null===t||void 0===t?void 0:t.status)||"draft",discount:(null===t||void 0===t?void 0:t.discount)||0,invoiceFrom:(null===t||void 0===t?void 0:t.invoiceFrom)||"",invoiceTo:(null===t||void 0===t?void 0:t.invoiceTo)||null,items:(null===t||void 0===t?void 0:t.items)||[{service:null,quantity:1,price:0,subtotal:0,tax:0,total:0}],totalAmount:(null===t||void 0===t?void 0:t.totalAmount)||0})),[t]),g=(0,r.cI)({resolver:(0,a.X)(b),defaultValues:j}),{reset:Z,handleSubmit:y,formState:{isSubmitting:f}}=g,_=y((async e=>{n.onTrue();try{await new Promise((e=>setTimeout(e,500))),Z(),n.onFalse(),i.push(m.H.dashboard.invoice.root),console.info("DATA",JSON.stringify(e,null,2))}catch(t){console.error(t),n.onFalse()}})),w=y((async e=>{s.onTrue();try{await new Promise((e=>setTimeout(e,500))),Z(),s.onFalse(),i.push(m.H.dashboard.invoice.root),console.info("DATA",JSON.stringify(e,null,2))}catch(t){console.error(t),s.onFalse()}}));return(0,T.jsx)(u.Z,{maxWidth:"xl",children:(0,T.jsxs)(p.ZP,{methods:g,children:[(0,T.jsxs)(d.Z,{children:[(0,T.jsx)(P,{}),(0,T.jsx)(F,{}),(0,T.jsx)(I,{})]}),(0,T.jsxs)(c.Z,{justifyContent:"flex-end",direction:"row",spacing:2,sx:{mt:3},children:[(0,T.jsx)(x.Z,{color:"inherit",size:"large",variant:"outlined",loading:n.value&&f,onClick:_,children:"Save as Draft"}),(0,T.jsxs)(x.Z,{size:"large",variant:"contained",loading:s.value&&f,onClick:w,children:[t?"Update":"Create"," & Send"]})]})]})})}function N(){return(0,T.jsxs)(s.Z,{category:"work_group",subcategory:"entrance_management",acl:"read",children:[(0,T.jsxs)(n.ql,{children:[(0,T.jsx)("title",{children:"Entrance Management Accounting"}),(0,T.jsx)("meta",{name:"description",content:"meta"})]}),(0,T.jsx)(z,{})]})}},58645:e=>{e.exports=function(e,t){for(var i,n=-1,s=e.length;++n<s;){var o=t(e[n]);void 0!==o&&(i=void 0===i?o:i+o)}return i}},87151:(e,t,i)=>{var n=i(58645),s=i(2100);e.exports=function(e){return e&&e.length?n(e,s):0}}}]);
//# sourceMappingURL=8580.6c6ad240.chunk.js.map