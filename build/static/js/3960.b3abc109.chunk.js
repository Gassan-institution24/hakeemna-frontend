"use strict";(self.webpackChunk_minimal_kit_cra_js=self.webpackChunk_minimal_kit_cra_js||[]).push([[3960],{43960:(e,n,a)=>{a.r(n),a.d(n,{default:()=>me});var t=a(6907),i=a(27031),l=a(8007),o=a(18111),r=a.n(o),s=a(58406),d=a(94721),c=a(10266),m=a(4567),u=a(62861),p=a(68096),h=a(86778),g=a(77196),x=a(38072),v=a(8976),b=a(81164),_=a(66630),j=a(61134),y=a(44695),Z=a(72791),f=a(12258),w=a(57621),S=a(16029),k=a(82626),C=a(13400),D=a(53767),P=a(19208),T=a(13493),q=a(9145),A=a(66664),R=a(40268),F=a(32869),E=a(73379),L=a(82007),z=a(24461),B=a(90811),I=a(9585),M=a(48550),W=a(49900),G=a(96474),H=a(38887),O=a(27499),$=a(94791),N=a(80184);function Y(e){let{selected:n,AppointDates:a,setSelected:t,selectedDate:i,setSelectedDate:l,list:o,loading:r}=e;const{t:s}=(0,b.qM)(),[c,u]=(0,Z.useState)(),p=(0,H.F)("up","md"),h=(0,$.vr)({adaptiveHeight:!0,initialSlide:!r&&((()=>{let e=0;return o.forEach(((a,t)=>{a._id===n&&(e=t)})),e})()||0)});(0,Z.useEffect)((()=>{var e,a;if(!r.value)if(n)if(o.some((e=>e._id===n)))o.forEach(((e,a)=>{var i,l;e._id===n&&(h.onTogo(a),t(null===o||void 0===o||null===(i=o[a])||void 0===i?void 0:i._id),u(null===o||void 0===o||null===(l=o[a])||void 0===l?void 0:l._id))}));else{var i,l;t(null===o||void 0===o||null===(i=o[0])||void 0===i?void 0:i._id),u(null===o||void 0===o||null===(l=o[0])||void 0===l?void 0:l._id),h.onTogo(0)}else t(null===o||void 0===o||null===(e=o[0])||void 0===e?void 0:e._id),u(null===o||void 0===o||null===(a=o[0])||void 0===a?void 0:a._id),h.onTogo(0)}),[o,r.value]);const g=e=>{var n,a;let i=h.currentIndex;"next"===e&&(h.onNext(),i===o.length-1?i=0:i+=1),"prev"===e&&(h.onPrev(),0===i?i=o.length-1:i-=1),t(null===(n=o[i])||void 0===n?void 0:n._id),u(null===(a=o[i])||void 0===a?void 0:a._id)};return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(D.Z,{direction:p?"row":"column",justifyContent:"space-around",children:[(0,N.jsx)(G.w,{localeText:!1,sx:{width:"100%",flexGrow:1,flexShrink:.4},orientation:p?"landscape":"",shouldDisableDate:e=>!a.some((n=>{const a=new Date(n),t=new Date(e);return a.getFullYear()===t.getFullYear()&&a.getMonth()===t.getMonth()&&a.getDate()===t.getDate()})),slots:{toolbar:"test"},slotProps:{actionBar:{actions:[]}},value:new Date(i),onChange:e=>l(e)}),(0,N.jsx)(D.Z,{sx:{width:"100%",height:"100%",flexGrow:1,flexShrink:.6,px:3},children:(0,N.jsx)(O.Z,{list:o,onChange:e=>{t(e),u(e),o.forEach(((n,a)=>{n._id===e&&h.onTogo(a)}))},value:c})})]}),(0,N.jsx)(d.Z,{sx:{borderStyle:"dashed"}}),n&&(0,N.jsx)(I.Z,{title:(0,N.jsx)(m.Z,{sx:{py:2,fontWeight:700},variant:"caption",color:"text.secondary",textTransform:"uppercase",children:s("Appointment details")}),action:(0,N.jsx)($.i5,{onNext:()=>g("next"),onPrev:()=>g("prev")})}),(0,N.jsx)($.ZP,{style:{dir:"rtl"},ref:h.carouselRef,...h.carouselSettings,children:o.map((e=>(0,N.jsx)(U,{item:e},e._id)))}),(0,N.jsx)(d.Z,{sx:{borderStyle:"dashed",mb:3}})]})}function U(e){var n,a;let{item:t}=e;const{_id:i,work_group:l,appointment_type:o,unit_service:r,start_time:s,service_types:d,online_available:c}=t,{t:m}=(0,b.qM)(),{currentLang:u}=(0,b.nt)(),p="ar"===u.value,{enqueueSnackbar:h}=(0,F.useSnackbar)(),{appointmenttypesData:g}=(0,_.o5E)(),[x,v]=(0,Z.useState)(null===o||void 0===o?void 0:o._id),j=(0,H.F)("up","md");return(0,N.jsx)(D.Z,{dir:p?"rtl":"ltr",spacing:2,sx:{p:3,position:"relative"},children:(0,N.jsxs)(D.Z,{direction:j?"row":"column",alignItems:"center",spacing:2,children:[(0,N.jsx)(W.Z,{primary:(0,B.Z)(new Date(s))&&new Date(s).toLocaleTimeString(m("en-US"),{timeZone:null===r||void 0===r||null===(n=r.country)||void 0===n?void 0:n.time_zone,hour:"2-digit",minute:"2-digit"}),secondary:(0,B.Z)(new Date(s))&&new Date(s).toLocaleDateString(m("en-US"),{timeZone:(null===r||void 0===r||null===(a=r.country)||void 0===a?void 0:a.time_zone)||Intl.DateTimeFormat().resolvedOptions().timeZone}),primaryTypographyProps:{typography:"subtitle1",noWrap:!0},secondaryTypographyProps:{typography:"body2",component:"span",mt:.5,color:"text.disabled"}}),[{label:(0,N.jsx)(M.Z,{variant:"standard",select:!0,size:"small",sx:{width:"170px",mx:2},value:x,onChange:e=>{try{A.ZP.patch(A.Hv.appointments.one(i),{appointment_type:e.target.value}),v(e.target.value),h(m("updated successfully"))}catch(n){console.log(n),h(p&&"".concat(n.arabic_message)||"".concat(n.message),{variant:"error"})}},placeholder:m("appointment type"),children:null===g||void 0===g?void 0:g.map(((e,n)=>(0,N.jsx)(k.Z,{selected:x===e._id,value:e._id,children:p?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english},n)))}),icon:(0,N.jsx)(R.Z,{icon:"streamline:waiting-appointments-calendar"})},{label:p?null===l||void 0===l?void 0:l.name_arabic:null===l||void 0===l?void 0:l.name_english,icon:(0,N.jsx)(R.Z,{icon:"ri:group-line"})},{label:d.length?null===d||void 0===d?void 0:d.reduce(((e,n)=>e+n.Price_per_unit||0),0):0,icon:(0,N.jsx)(R.Z,{icon:"solar:tag-price-bold"})},{label:m("available online"),icon:(0,N.jsx)(R.Z,{icon:c?"typcn:tick-outline":"mdi:close-outline",sx:{color:c?"success.main":"error.main"}})}].map(((e,n)=>(0,N.jsxs)(D.Z,{spacing:.5,direction:"row",children:[e.icon,(0,N.jsx)(W.Z,{primary:e.label,secondary:(0,N.jsx)("span",{dir:"\u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062a\u0641"===e.label?"ltr":"auto",children:e.value}),primaryTypographyProps:{typography:"body2",color:"text.secondary",mb:.5},secondaryTypographyProps:{typography:"subtitle2",color:"text.primary",component:"span",textTransform:"none"}})]},n)))]})})}var K=a(79836),V=a(13967),J=a(53382),Q=a(90618),X=a(53507),ee=a(10261),ne=a(38062),ae=a(9195),te=a(68745),ie=a(13838),le=a(22459),oe=a(77008);function re(e){let{row:n,note:a,setNote:t,selected:i,onEmploymentRow:l,SelectedAppointment:o}=e;const{sequence_number:r,name_english:s,name_arabic:d,nationality:c,birth_date:u,identification_num:p,email:h,mobile_num1:g,mobile_num2:x}=n,{t:v}=(0,b.qM)(),{currentLang:_}=(0,b.nt)(),j="ar"===_.value,y=(0,le.k)(),Z=(0,N.jsxs)(ae.Z,{hover:!0,selected:i,children:[(0,N.jsx)(te.Z,{align:"center",children:(0,N.jsxs)(S.Z,{children:[String(c.code).padStart(3,"0"),"-",r]})}),(0,N.jsx)(te.Z,{align:"center",children:s}),(0,N.jsx)(te.Z,{align:"center",children:d}),(0,N.jsx)(te.Z,{align:"center",children:g}),(0,N.jsx)(te.Z,{align:"center",children:x}),(0,N.jsx)(te.Z,{align:"center",sx:{textTransform:"none"},children:h}),(0,N.jsx)(te.Z,{align:"center",children:p}),(0,N.jsx)(te.Z,{align:"center",children:j?null===c||void 0===c?void 0:c.name_arabic:null===c||void 0===c?void 0:c.name_english}),(0,N.jsx)(te.Z,{align:"center",children:u}),(0,N.jsx)(te.Z,{align:"center",sx:{px:1,whiteSpace:"nowrap"},children:(0,N.jsx)(C.Z,{onClick:y.onToggle,children:(0,N.jsx)(R.Z,{width:"27px",color:"info.main",icon:"mdi:book-add"})})})]});return(0,N.jsxs)(N.Fragment,{children:[Z,(0,N.jsx)(oe.Q,{open:y.value,onClose:y.onFalse,title:v("confirm checking information"),content:(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(m.Z,{children:[" ",v("Do you confirm checking patient data and check at least three values if they are true?")]}),(0,N.jsxs)(w.Z,{sx:{p:2,m:2},children:[(0,N.jsxs)(m.Z,{children:[v("patient")," : ",j?d:s]}),(0,N.jsxs)(m.Z,{children:[v("appoitment")," : ",(0,q.zM)(o.start_time)]})]}),(0,N.jsx)(M.Z,{multiline:!0,fullWidth:!0,label:v("note"),rows:2,sx:{my:2},onChange:e=>t(e.target.value),value:a})]}),action:(0,N.jsx)(ie.Z,{variant:"contained",color:"info",onClick:l,children:v("confirm")})})]})}function se(e){let{SelectedAppointment:n,reset:a,selected:t,oldPatients:i}=e;const{t:l}=(0,b.qM)(),{currentLang:o}=(0,b.nt)(),r="ar"===o.value,s=[{id:"code",label:l("code")},{id:"name_english",label:l("name in english")},{id:"name_arabic",label:l("name in arabic")},{id:"mobile_num1",label:l("mobile number")},{id:"mobile_num2",label:l("alternative mobile number")},{id:"email",label:l("email")},{id:"identification_num",label:l("ID number")},{id:"nationality",label:l("nationality")},{id:"birth_date",label:l("birth date")},{id:"book",width:88}],{enqueueSnackbar:d}=(0,F.useSnackbar)(),c=(0,ne.x6)({defaultRowsPerPage:10}),[m,u]=(0,Z.useState)(),p=(0,V.Z)(),{dense:h,page:g,order:x,orderBy:v,rowsPerPage:_,onSort:j,onChangeDense:y,onChangePage:f,onChangeRowsPerPage:w}=c;return(0,N.jsxs)(ee.Z,{children:[(0,N.jsxs)(K.Z,{size:h?"small":"medium",sx:{minWidth:960,borderCollapse:"separate",borderSpacing:"0 16px"},children:[(0,N.jsx)(ne.K,{order:x,orderBy:v,headLabel:s,onSort:j,sx:{["& .".concat(Q.Z.head)]:{"&:first-of-type":{borderTopLeftRadius:12,borderBottomLeftRadius:12},"&:last-of-type":{borderTopRightRadius:12,borderBottomRightRadius:12}}}}),(0,N.jsxs)(J.Z,{children:[i.slice(g*_,g*_+_).map(((e,i,o)=>(0,N.jsx)(re,{row:e,note:m,setNote:u,SelectedAppointment:n,onEmploymentRow:()=>(async e=>{try{await A.ZP.patch(A.Hv.appointments.book(t),{patient:e._id,note:m}),await(0,T.a)(n),d(l("booked successfully!")),a()}catch(i){d(r&&"".concat(i.arabic_message)||"".concat(i.message),{variant:"error"}),window.location.reload(),console.error(i)}})(e)},o))),(0,N.jsx)(ne.et,{notFound:0===i.length,sx:{m:-2,borderRadius:1.5,border:"dashed 1px ".concat(p.palette.divider)}})]})]}),(0,N.jsx)(ne.S_,{count:i.length,page:g,rowsPerPage:_,onPageChange:f,onRowsPerPageChange:w,dense:h,onChangeDense:y,sx:{["& .".concat(X.Z.toolbar)]:{borderTopColor:"transparent"}}})]})}const de={status:"available",work_group:null,startTime:null,endTime:null};function ce(){var e,n,a,t,i;const{user:o}=(0,v.E)(),{t:B}=(0,b.qM)(),{currentLang:I}=(0,b.nt)(),M="ar"===I.value,{countriesData:W}=(0,_.Rpj)(),{myunitTime:G}=(0,q.lf)(),[H,O]=(0,Z.useState)(de),$=!r()(H,de),U=(0,P.lr)(),K=U.get("appointment"),V=U.get("day"),[J,Q]=(0,Z.useState)(V?new Date(V):new Date),{appointmentsData:X,AppointDates:ee,loading:ne,refetch:ae}=(0,_.DoJ)({id:null===o||void 0===o||null===(e=o.employee)||void 0===e||null===(n=e.employee_engagements[null===o||void 0===o?void 0:o.employee.selected_engagement])||void 0===n||null===(a=n.unit_service)||void 0===a?void 0:a._id,filters:{...H,startDate:J}});(0,Z.useEffect)((()=>{ne||X.length||!ee.length||Q(ee[0])}),[ne,X.length,ee]);const[te,ie]=(0,Z.useState)(K),{workGroupsData:le}=(0,_.Sue)(null===o||void 0===o||null===(t=o.employee)||void 0===t||null===(i=t.employee_engagements[null===o||void 0===o?void 0:o.employee.selected_engagement])||void 0===i?void 0:i._id),{enqueueSnackbar:oe}=(0,F.useSnackbar)(),re=l.Ry().shape({sequence_number:l.Z_(),name_english:l.Z_(),name_arabic:l.Z_(),email:l.Z_(),identification_num:l.Z_(),birth_date:l.nK().nullable(),marital_status:l.Z_().nullable(),nationality:l.Z_().required(B("required field")),country:l.Z_().nullable(),city:l.Z_().nullable(),mobile_num1:l.Z_(),mobile_num2:l.Z_(),gender:l.Z_(),note:l.Z_()}),ce=(0,Z.useMemo)((()=>({sequence_number:"",name_english:"",name_arabic:"",email:"",identification_num:"",birth_date:null,marital_status:"",nationality:null,country:null,city:null,mobile_num1:"",mobile_num2:"",gender:"",note:""})),[]),me=(0,j.cI)({mode:"onTouched",resolver:(0,y.X)(re),defaultValues:ce}),{reset:ue,handleSubmit:pe,watch:he,setValue:ge,formState:{isSubmitting:xe,errors:ve}}=me;(0,Z.useEffect)((()=>{Object.keys(ve).length&&Object.keys(ve).forEach(((e,n)=>{var a;return oe("".concat(e,": ").concat((null===ve||void 0===ve||null===(a=ve[e])||void 0===a?void 0:a.message)||"error"),{variant:"error"})}))}),[ve,oe]);const be=he(),{tableData:_e}=(0,_.s_U)(be.country),{existPatients:je}=(0,_.E$b)({sequence_number:be.sequence_number,name_english:be.name_english,name_arabic:be.name_arabic,email:be.email.toLowerCase(),identification_num:be.identification_num,mobile_num1:be.mobile_num1,mobile_num2:be.mobile_num2}),ye=pe((async e=>{try{await A.ZP.patch(A.Hv.appointments.patient.createPatientAndBookAppoint(te),e);const n=X.find((e=>e._id===te));await(0,T.a)(n),oe(B("created successfully!")),ue()}catch(n){oe(M&&"".concat(n.arabic_message)||"".concat(n.message),{variant:"error"}),ae(),console.error(n)}})),Ze=e=>{/^[a-zA-Z0-9\s,@#$!*_\-&^%.()]*$/.test(e.target.value)&&ge(e.target.name,e.target.value)},fe=(0,Z.useCallback)((()=>{O(de)}),[]);return(0,N.jsxs)(c.Z,{maxWidth:"xl",children:[(0,N.jsx)(E.Z,{heading:B("Book Appointment"),links:[{name:B("dashboard"),href:x.H.employee.root},{name:B("appointments"),href:x.H.employee.appointments.root},{name:B("book")}],sx:{mb:{xs:3,md:5}}}),(0,N.jsx)(L.Z,{methods:me,onSubmit:ye,children:(0,N.jsxs)(w.Z,{sx:{px:3,pb:3},children:[(0,N.jsxs)(S.Z,{sx:{m:3},rowGap:3,columnGap:2,display:"flex",children:[(0,N.jsxs)(p.Z,{sx:{width:{xs:1,md:200}},children:[(0,N.jsx)(u.Z,{shrink:!0,children:"".concat(B("work group"))}),(0,N.jsx)(s.Z,{value:H.group,onChange:e=>O((n=>({...n,group:e.target.value}))),size:"small",input:(0,N.jsx)(g.Z,{label:B("work group")}),children:le.map(((e,n)=>(0,N.jsx)(k.Z,{lang:"ar",value:e._id,children:M?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english},n)))})]}),(0,N.jsx)(h.d,{closeOnSelect:!0,slots:{actionBar:"cancel"},minutesStep:"5",label:B("from time"),value:G(H.startTime),onChange:e=>{const n=G(e);O((e=>({...e,startTime:n})))},slotProps:{textField:{fullWidth:!0,size:"small"}},sx:{width:{xs:1,md:200}}}),(0,N.jsx)(h.d,{closeOnSelect:!0,slots:{actionBar:"cancel"},minutesStep:"5",label:B("to time"),value:G(H.endTime),onChange:e=>{const n=G(e);O((e=>({...e,endTime:n})))},slotProps:{textField:{fullWidth:!0,size:"small"}},sx:{width:{xs:1,md:200}}}),$&&(0,N.jsx)(C.Z,{sx:{color:"error.main"},onClick:fe,children:(0,N.jsx)(R.Z,{icon:"solar:trash-bin-trash-bold"})})]}),(0,N.jsx)(d.Z,{sx:{borderStyle:"dashed"}}),!ne&&(0,N.jsx)(Y,{selected:te,AppointDates:ee,loading:ne,setSelected:ie,selectedDate:J,setSelectedDate:Q,list:X}),(0,N.jsx)(m.Z,{sx:{py:2,fontWeight:700},variant:"caption",color:"text.secondary",textTransform:"uppercase",children:B("patient information")}),(0,N.jsx)("br",{}),(0,N.jsx)("br",{}),(0,N.jsx)(z.au,{InputLabelProps:{shrink:!0},inputProps:{style:{textAlign:"center"}},sx:{width:"200px",mb:3,textAlign:"center"},size:"small",name:"sequence_number",onChange:e=>{const{value:n}=e.target,a=n.replace(/\D/g,"");a.length<=3?ge(e.target.name,a):a.length>=4&&"-"===a.charAt(3)?ge(e.target.name,a.slice(0,3)):a.length>=4&&"-"!==a.charAt(3)?ge(e.target.name,"".concat(a.slice(0,3),"-").concat(a.slice(3))):ge(e.target.name,a)},placeholder:"001-22",label:B("patient-code")}),(0,N.jsxs)(S.Z,{sx:{mb:3},rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(3, 1fr)"},children:[(0,N.jsx)(z.au,{onChange:Ze,name:"name_english",label:B("patient name in english")}),(0,N.jsx)(z.au,{onChange:e=>{/^[\u0600-\u06FF0-9\s!@#$%^&*_\-()]*$/.test(e.target.value)&&ge(e.target.name,e.target.value)},name:"name_arabic",label:B("patient name in arabic")}),(0,N.jsx)(z.au,{type:"email",name:"email",label:B("email address")}),(0,N.jsx)(z.au,{onChange:Ze,name:"identification_num",label:B("ID number")}),(0,N.jsx)(z.Y_,{name:"mobile_num1",label:B("mobile number")}),(0,N.jsx)(z.Y_,{name:"mobile_num2",label:B("alternative mobile number")}),(0,N.jsx)(z.C5,{name:"birth_date",label:B("birth date")}),(0,N.jsx)(z.Cc,{name:"nationality",label:B("nationality"),children:W.map(((e,n)=>(0,N.jsx)(k.Z,{lang:"ar",value:e._id,children:M?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english},n)))}),(0,N.jsx)(z.Cc,{name:"country",label:B("country of residence"),children:W.map(((e,n)=>(0,N.jsx)(k.Z,{lang:"ar",value:e._id,children:M?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english},n)))}),(0,N.jsx)(z.Cc,{name:"city",label:B("city of residence"),children:_e.map(((e,n)=>(0,N.jsx)(k.Z,{lang:"ar",value:e._id,children:M?null===e||void 0===e?void 0:e.name_arabic:null===e||void 0===e?void 0:e.name_english},n)))}),(0,N.jsxs)(z.Cc,{name:"marital_status",label:B("marital status"),children:[(0,N.jsx)(k.Z,{lang:"ar",value:"single",children:B("single")}),(0,N.jsx)(k.Z,{lang:"ar",value:"married",children:B("married")}),(0,N.jsx)(k.Z,{lang:"ar",value:"widowed",children:B("widowed")}),(0,N.jsx)(k.Z,{lang:"ar",value:"separated",children:B("separated")}),(0,N.jsx)(k.Z,{lang:"ar",value:"divorced",children:B("divorced")})]}),(0,N.jsxs)(z.Cc,{name:"gender",label:B("gender"),children:[(0,N.jsx)(k.Z,{lang:"ar",value:"male",children:B("male")}),(0,N.jsx)(k.Z,{lang:"ar",value:"female",children:B("female")})]})]}),(0,N.jsx)(z.au,{multiline:!0,rows:2,name:"note",label:B("note")}),(0,N.jsx)(D.Z,{alignItems:"flex-end",sx:{mt:3},children:(0,N.jsx)(f.Z,{type:"submit",tabIndex:-1,variant:"contained",loading:xe,children:B("create new patient and book")})}),je.length>0&&(0,N.jsx)(se,{SelectedAppointment:X.find((e=>e._id===te)),selected:te,reset:ue,oldPatients:je})]})})]})}function me(){return(0,N.jsxs)(i.Z,{category:"unit_service",subcategory:"appointments",acl:"read",children:[(0,N.jsxs)(t.ql,{children:[(0,N.jsx)("title",{children:" Book Appointment "}),(0,N.jsx)("meta",{name:"description",content:"meta"})]}),(0,N.jsx)(ce,{})]})}}}]);
//# sourceMappingURL=3960.b3abc109.chunk.js.map